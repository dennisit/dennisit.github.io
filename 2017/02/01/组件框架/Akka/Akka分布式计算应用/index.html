<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-tw">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="kFp8mZ25PsFpJW_ipN268gzlsa4pfBk-LYkLTBR2jQc">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,Akka,">





  <link rel="alternate" href="/atom.xml" title="花辭" type="application/atom+xml">





<script>
    (function(){
        if(''){
            if (prompt('该文章被加密, 输入访问口令!') !== ''){
                alert('密码错误！');
                //history.go(-1);
                history.back();
            }
        }
    })();
</script>

<meta name="description" content="介绍Akka-Cluster前 需要先说一下Akka-Remoting.  Akka-Remoting一种ActorSystem之间Actor对Actor点对点的沟通协议.通过Akka-Remoting来实现一个ActorSystem中的一个Actor与另一个ActorSystem中的另一个Actor之间的沟通.在Remoting功能之后,Akka又发展了集群Cluster功能.Akka-Clus">
<meta name="keywords" content="Java,Akka">
<meta property="og:type" content="article">
<meta property="og:title" content="Akka分布式计算应用">
<meta property="og:url" content="http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka分布式计算应用/index.html">
<meta property="og:site_name" content="花辭">
<meta property="og:description" content="介绍Akka-Cluster前 需要先说一下Akka-Remoting.  Akka-Remoting一种ActorSystem之间Actor对Actor点对点的沟通协议.通过Akka-Remoting来实现一个ActorSystem中的一个Actor与另一个ActorSystem中的另一个Actor之间的沟通.在Remoting功能之后,Akka又发展了集群Cluster功能.Akka-Clus">
<meta property="og:locale" content="zh-tw">
<meta property="og:updated_time" content="2018-12-12T00:08:46.498Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Akka分布式计算应用">
<meta name="twitter:description" content="介绍Akka-Cluster前 需要先说一下Akka-Remoting.  Akka-Remoting一种ActorSystem之间Actor对Actor点对点的沟通协议.通过Akka-Remoting来实现一个ActorSystem中的一个Actor与另一个ActorSystem中的另一个Actor之间的沟通.在Remoting功能之后,Akka又发展了集群Cluster功能.Akka-Clus">



<script type="text/javascript" id="hexo.configurations">
  document.oncontextmenu= function(){return false;}
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka分布式计算应用/">





  <title>Akka分布式计算应用 | 花辭</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?57443a2926e41ae04a903a8093e16326";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-tw">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">花辭</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">風月不瘦,雖以千年後。</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            關於
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            標籤
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站點地圖
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka分布式计算应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="蘇若年">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/havatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花辭">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Akka分布式计算应用</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-02-01T19:57:53+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/入门教程/" itemprop="url" rel="index">
                    <span itemprop="name">入门教程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/01/组件框架/Akka/Akka分布式计算应用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2017/02/01/组件框架/Akka/Akka分布式计算应用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/02/01/组件框架/Akka/Akka分布式计算应用/" class="leancloud_visitors" data-flag-title="Akka分布式计算应用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">閱讀次數&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>介绍<code>Akka-Cluster</code>前 需要先说一下<code>Akka-Remoting</code>.</p>
<blockquote>
<p><code>Akka-Remoting</code>一种ActorSystem之间Actor对Actor点对点的沟通协议.通过Akka-Remoting来实现一个ActorSystem中的一个Actor与另一个ActorSystem中的另一个Actor之间的沟通.在Remoting功能之后,Akka又发展了集群Cluster功能.<br><code>Akka-Cluster</code>是基于Akka-Remoting之上的新一代分布式运算环境,所以Remoting已经成为了Akka-Cluster的内部支持功能,在生产环境中的分布式运算应该尽量使用Akka-Cluster; Akka-Cluster可以在一部物理机或一组网络连接的服务器上搭建部署.</p>
</blockquote>
<p>简单来说Akka-Cluster将多个JVM连接整合起来,实现消息地址的透明化和统一化使用管理,集成一体化的消息驱动系统.最终目的是能够把一个大型程序分割成多个子程序,然后部署到很多JVM上去实现程序的分布式并行运算.更重要的是：Cluster的构建过程与Actor编程没有牵连,当Cluster把多个ActorSystem集合成一个统一系统后,我们可以用在单一ActorSystem里编程的习惯方式编写分布式运算程序.由于在单一机器上就可以配置多个节点形成一个集群,我们开发的分布式程序可以在单机或多机群上运行,不同的只是如何部署和配置集群环境.</p>
<a id="more"></a>
<h3 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost akka-task ]$ tree akka-task</span><br><span class="line">akka-task</span><br><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   └── main</span><br><span class="line">│       ├── java</span><br><span class="line">│       │   └── com</span><br><span class="line">│       │       └── elonsu</span><br><span class="line">│       │           └── cluster</span><br><span class="line">│       │               └── akka</span><br><span class="line">│       │                   ├── Message.java</span><br><span class="line">│       │                   ├── client</span><br><span class="line">│       │                   │   ├── DispatchActor.java</span><br><span class="line">│       │                   │   └── TaskClusterClient.java</span><br><span class="line">│       │                   └── server</span><br><span class="line">│       │                       ├── TaskActor.java</span><br><span class="line">│       │                       ├── TaskClusterServer1.java</span><br><span class="line">│       │                       ├── TaskClusterServer2.java</span><br><span class="line">│       │                       └── TaskClusterServer3.java</span><br><span class="line">│       └── resources</span><br><span class="line">│           ├── akka-client.conf</span><br><span class="line">│           ├── akka-node1.conf</span><br><span class="line">│           ├── akka-node2.conf</span><br><span class="line">│           └── akka-node3.conf</span><br></pre></td></tr></table></figure>
<h3 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-cluster_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-remote_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明"></a>模块说明</h3><p>消息相关</p>
<ul>
<li>Message: 示例中客户端和服务端通讯的消息定义</li>
</ul>
<p>服务端相关</p>
<ul>
<li>TaskActor: 服务端事件处理类</li>
<li>TaskClusterServer* : 服务端实例主类(示例中定义了3台实例)</li>
<li>akka-node*.conf : 服务端配置</li>
</ul>
<p>客户端相关</p>
<ul>
<li>DispatchActor: 消息投递转发类, 用于对于服务端节点进行选取和消息投递</li>
<li>TaskClusterClient: 客户端示例主类</li>
<li>akka-client.conf : 客户端配置</li>
</ul>
<h3 id="代码示例-服务端"><a href="#代码示例-服务端" class="headerlink" title="代码示例(服务端)"></a>代码示例(服务端)</h3><p>示例中定义的服务端端端口分别为:2551、2552、2553</p>
<h4 id="消息定义"><a href="#消息定义" class="headerlink" title="消息定义"></a>消息定义</h4><p>说明: 消息定义必须实现序列化接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span>  taskId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> taskId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String result;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h4><p><code>akka-node1.conf</code>配置内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2551</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["server"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>akka-node2.conf</code>配置内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2552</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["server"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>akka-node3.conf</code>配置内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2553</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["server"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务端Actor"><a href="#服务端Actor" class="headerlink" title="服务端Actor"></a>服务端Actor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 集群监听</span></span><br><span class="line">    <span class="keyword">private</span> Cluster cluster = Cluster.get(getContext().system());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//subscribe to cluster changes</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//#subscribe</span></span><br><span class="line">        cluster.subscribe(getSelf(), ClusterEvent.initialStateAsEvents(),</span><br><span class="line">                ClusterEvent.MemberEvent.class, ClusterEvent.UnreachableMember.class);</span><br><span class="line">        <span class="comment">//#subscribe</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//re-subscribe when restart</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cluster.unsubscribe(getSelf());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x-&gt; &#123;</span><br><span class="line">                            log().info(<span class="string">"[接收消息]:&#123;&#125;, Actor:&#123;&#125;, Thread:&#123;&#125;"</span>, x, getSelf().path(), Thread.currentThread().getName());</span><br><span class="line">                            getSender().tell(<span class="keyword">new</span> Message.Result(x.getTaskId(), x.getContent() + <span class="string">"处理完成"</span>), self());</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberUp.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member is Up: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.CurrentClusterState.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Cluster State: &#123;&#125;"</span>, x.getMembers())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.UnreachableMember.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member detected as unreachable: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberRemoved.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member is Removed: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberEvent.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"ignore"</span>)</span><br><span class="line">                )</span><br><span class="line">                .matchAny(</span><br><span class="line">                        x -&gt; unhandled(x)</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务端主类"><a href="#服务端主类" class="headerlink" title="服务端主类"></a>服务端主类</h4><p>这里只列出Node1上的主类, 服务端节点中每个示例的内容基本一样,不同的是各自加载的配置文件<code>&quot;akka-node*.conf&quot;</code>与实例对应.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskClusterServer1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"simpleAkkaCluster"</span>, ConfigFactory.load(<span class="string">"akka-node1.conf"</span>));</span><br><span class="line">        ActorRef taskActor = system.actorOf(Props.create(TaskActor.class), <span class="string">"taskActor"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Akka Cluster Node1 启动完成"</span> + taskActor.path());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="集群状态监听"><a href="#集群状态监听" class="headerlink" title="集群状态监听"></a>集群状态监听</h3><p>示例场景: 分别启动服务端节点Node1、Node2、Node3、然后关停Node2、再重新启动,观察集群状态日志</p>
<h4 id="Node1日志"><a href="#Node1日志" class="headerlink" title="Node1日志"></a>Node1日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:45:06.365] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:45:06.565] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 11:45:06.567] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 11:45:06.578] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:45:06.728] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:45:06.728] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:45:06.765] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.862] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.862] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2552</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.863] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.863] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-0] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]] Caused by: [Connection refused: /172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:06.867] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:06.867] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:07.782] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:07.782] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:08.783] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:08.783] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:09.781] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:09.781] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:10.783] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:10.783] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:11.792] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:11.802] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:11.806] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.616] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-138411316]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.616] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-138411316]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.662] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.664] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.770] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.771] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.523] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.523] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.770] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.771] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:45.977] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:47.769] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Exiting]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:47.771] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:48.776] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Exiting confirmed [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.798] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-0/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] -&gt; [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.798] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-6] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/endpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-2] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:50.771] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is removing confirmed Exiting node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:50.772] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Removed)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.358] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.358] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.769] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.770] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br></pre></td></tr></table></figure>
<h4 id="Node2日志"><a href="#Node2日志" class="headerlink" title="Node2日志"></a>Node2日志</h4><p>首次加入集群</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:45:12.982] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:45:13.249] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:45:13.251] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:45:13.267] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:45:13.401] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:45:13.401] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:45:13.433] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:13.532] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:13.536] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.540] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/joinSeedNodeProcess-1#-138411316] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.770] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.779] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.779] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.811] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.780] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.803] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#-1800037640] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.372] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon] Message [akka.cluster.GossipEnvelope] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon#-2084557458] to Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon#-53996821] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.776] [simpleAkkaCluster-akka.actor.default-dispatcher-25] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br></pre></td></tr></table></figure>
<p>断开后再次加入集群</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:46:56.861] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:46:57.054] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:46:57.055] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:46:57.069] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:46:57.184] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:46:57.184] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:46:57.210] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.375] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.378] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.379] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.379] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:58.227] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br></pre></td></tr></table></figure>
<h4 id="Node3日志"><a href="#Node3日志" class="headerlink" title="Node3日志"></a>Node3日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:45:17.020] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:45:17.213] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 11:45:17.215] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 11:45:17.226] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:45:17.332] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:45:17.332] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:45:17.359] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.544] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.549] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.550] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.551] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:19.381] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:46.368] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:48.777] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Exiting confirmed [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:48.779] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.806] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-13] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/endpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-3] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.806] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-1/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] -&gt; [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:49.365] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.GossipStatus] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon#-53996821] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:49.563] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#1010718345] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:50.573] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#1010718345] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:51.378] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Removed)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.366] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.772] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br></pre></td></tr></table></figure>
<p>通过日志示例和服务端代码可以看到集群事件是通过MemberEvent传递的,这个其实就是每个成员所可能拥有的events,一个成员在它的生命周期中有以下的events:</p>
<ul>
<li>ClusterEvent.MemberJoined - 新的节点加入集群,此时的状态是Joining；</li>
<li>ClusterEvent.MemberUp - 新的节点加入集群,此时的状态是Up；</li>
<li>ClusterEvent.MemberExited - 节点正在离开集群,此时的状态是Exiting；</li>
<li>ClusterEvent.MemberRemoved - 节点已经离开集群,此时的状态是Removed；</li>
<li>ClusterEvent.UnreachableMember - 节点被标记为不可触达；</li>
<li>ClusterEvent.ReachableMember - 节点被标记为可触达；</li>
</ul>
<p>状态说明：</p>
<ul>
<li>Joining: 加入集群的瞬间状态</li>
<li>Up: 正常服务状态</li>
<li>Leaving / Exiting: 正常移出中状态</li>
<li>Down: 被标记为停机（不再是集群决策的一部分）</li>
<li>Removed: 已从集群中移除</li>
</ul>
<h3 id="代码示例-客户端"><a href="#代码示例-客户端" class="headerlink" title="代码示例(客户端)"></a>代码示例(客户端)</h3><p>示例中定义的客户端端口为:2600</p>
<h4 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2600</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["router", "client"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端消息转发"><a href="#客户端消息转发" class="headerlink" title="客户端消息转发"></a>客户端消息转发</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatchActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务路径</span></span><br><span class="line">    <span class="keyword">private</span> String actorPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务集合</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ActorRef&gt; servers = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 集群监听</span></span><br><span class="line">    <span class="keyword">private</span> Cluster cluster = Cluster.get(context().system());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务地址统计</span></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DispatchActor</span><span class="params">(String actorPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.actorPath = actorPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cluster.subscribe(self(), ClusterEvent.MemberEvent.class, ClusterEvent.ReachabilityEvent.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cluster.unsubscribe(self());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x -&gt; servers.isEmpty(),</span><br><span class="line">                        x -&gt; sender().tell(<span class="keyword">new</span> Message.Result(-<span class="number">1L</span>, <span class="string">"服务暂不可用"</span>), sender())</span><br><span class="line">                )</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x -&gt; &#123;</span><br><span class="line">                            log().info(<span class="string">"[Dispatcher] [消息转发] 集群节点数量:&#123;&#125;, 待处理任务:&#123;&#125;"</span>, servers.size(), x.getTaskId());</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">int</span> index = count.incrementAndGet() % servers.size();</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;servers.size(); i++)&#123;</span><br><span class="line">                                System.out.println(<span class="string">"[Dispatcher][服务选取] 选中["</span> + (i == index)+<span class="string">"] 地址: "</span> + servers.get(i).path());</span><br><span class="line">                            &#125;</span><br><span class="line">                            System.out.println();</span><br><span class="line"></span><br><span class="line">                            servers.get(index).forward(x, getContext());</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                .match(Terminated.class,</span><br><span class="line">                        x -&gt; unRegister(x.getActor())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.CurrentClusterState.class, state -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 当前节点在刚刚加入集群时,会收到CurrentClusterState消息,从中可以解析出集群中的所有前端节点</span></span><br><span class="line">                    servers.clear();</span><br><span class="line">                    <span class="keyword">for</span> (Member member : state.getMembers()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (member.status().equals(MemberStatus.up())) &#123;</span><br><span class="line">                            register(member);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .match(ClusterEvent.MemberUp.class,</span><br><span class="line">                        x -&gt; register(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberEvent.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.UnreachableMember.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.ReachableMember.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != member &amp;&amp; member.hasRole(<span class="string">"server"</span>))&#123;</span><br><span class="line">            register(getContext().actorFor(member.address() + <span class="string">"/user/"</span> + <span class="keyword">this</span>.actorPath));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != member &amp;&amp; member.hasRole(<span class="string">"server"</span>))&#123;</span><br><span class="line">            unRegister(getContext().actorFor(member.address() + <span class="string">"/user/"</span> + <span class="keyword">this</span>.actorPath));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(ActorRef actorRef)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != actorRef)&#123;</span><br><span class="line">            servers.add(actorRef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(ActorRef actorRef)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != actorRef)&#123;</span><br><span class="line">            servers.remove(actorRef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端主类"><a href="#客户端主类" class="headerlink" title="客户端主类"></a>客户端主类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskClusterClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"simpleAkkaCluster"</span>, ConfigFactory.load(<span class="string">"akka-client.conf"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 单节点处理</span></span><br><span class="line">        directorClient(system);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 集群处理</span></span><br><span class="line">        clusterClient(system);</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        system.terminate();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接指定特定节点处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">directorClient</span><span class="params">(ActorSystem system)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ActorRef directClient = system.actorFor(<span class="string">"akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Akka Direct Client 启动完成. "</span> + directClient.path());</span><br><span class="line">        remoteInvoke(<span class="string">"[指定处理]"</span>, directClient);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定集群处理(集群节点选组由Dispatcher处理)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clusterClient</span><span class="params">(ActorSystem system)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ActorRef clusterClient = system.actorOf(Props.create(DispatchActor.class, <span class="string">"taskActor"</span>), <span class="string">"clientActor"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Akka Cluster Client 启动完成. "</span> + clusterClient.path());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++)&#123;</span><br><span class="line">            System.out.println();</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            remoteInvoke(<span class="string">"[集群处理]"</span>, clusterClient);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 和远程端进行数据交互并获取处理结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> depict 交互类型描述</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endpoint 服务节点地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remoteInvoke</span><span class="params">(String depict, ActorRef endpoint)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Future&lt;Object&gt;&gt; futures = Lists.newArrayList();</span><br><span class="line">        Timeout timeout = <span class="keyword">new</span> Timeout(Duration.create(<span class="number">10</span>, TimeUnit.SECONDS));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">            String text = depict + <span class="string">"消息"</span> + i + UUID.randomUUID().toString();</span><br><span class="line">            Future&lt;Object&gt; future = Patterns.ask(endpoint, <span class="keyword">new</span> Message.Task(<span class="number">100L</span> +i, text), timeout);</span><br><span class="line">            futures.add(future);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Future&lt;Object&gt; future: futures)&#123;</span><br><span class="line">            Message.Result result = (Message.Result) Await.result(future, timeout.duration());</span><br><span class="line">            System.out.println(<span class="string">"服务端返回:"</span> + result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端分别演示了指定节点处理和基于集群处理.</p>
<h3 id="分布式计算"><a href="#分布式计算" class="headerlink" title="分布式计算"></a>分布式计算</h3><p>启动服务端: 分别启动服务端节点(Node1、Node2、Node3)、<br>启动客户端: 启动客户端主类模拟调用</p>
<h4 id="服务端日志"><a href="#服务端日志" class="headerlink" title="服务端日志"></a>服务端日志</h4><p>Node1日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:09:28.361] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:09:28.528] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 12:09:28.530] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 12:09:28.541] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:09:28.658] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:09:28.658] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:09:28.684] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.775] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2552</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.775] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.777] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.777] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-0] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]] Caused by: [Connection refused: /172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:28.780] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:28.780] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:29.707] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:29.707] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:30.697] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:30.697] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:31.695] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:31.696] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:32.707] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:32.708] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:33.715] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:33.722] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:33.726] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.312] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-987896376]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.312] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-987896376]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.353] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.354] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.696] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.696] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.491] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.491] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.703] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:49.694] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:49.696] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.697] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:23.693] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:23.694] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.653] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息2fe9b091d-dbca-4a43-bb8f-4e11fa7db348","taskId":102&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-3</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:24.654] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Result] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息071a6714d-94af-47e2-b3e2-e298ca60e6f7","taskId":100&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息34ce25577-f548-4836-8f86-a7e789f3284f","taskId":103&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 12:10:27.698] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-4/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:31.694] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/cluster/core/daemon] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Marking node(s) as UNREACHABLE [Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)]. Node roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.696] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member detected as unreachable: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.727] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.728] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:36.711] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is auto-downing unreachable node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]. Don'</span>t use auto-down feature of Akka Cluster <span class="keyword">in</span> production. See <span class="string">'Auto-downing (DO NOT USE)'</span> section of Akka Cluster documentation.</span><br><span class="line">[INFO] [01/31/2018 12:10:36.712] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Marking unreachable node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] as [Down]</span><br><span class="line">[WARN] [01/31/2018 12:10:38.727] [New I/O boss <span class="comment">#3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line">[WARN] [01/31/2018 12:10:38.727] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated <span class="keyword">for</span> [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:39.684] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is removing unreachable node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:39.686] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Removed)</span><br></pre></td></tr></table></figure>
<p>Node2日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:09:38.816] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:09:38.986] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 12:09:38.988] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 12:09:39.009] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:09:39.126] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:09:39.126] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:09:39.150] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:39.236] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:39.237] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-6] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.240] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/joinSeedNodeProcess-1#-987896376] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.431] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.434] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.434] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.707] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.492] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.492] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.520] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.521] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:49.700] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.330] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] is JOINING, roles [router, client, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.331] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.651] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息0d5dbe1b1-5d5d-48cb-8279-7afc9d013633","taskId":100&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-19</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.652] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息338f8e10b-ac1a-4714-9642-8ee64cb4c31f","taskId":103&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-19</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:24.652] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Result] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:25.169] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息1104806a5-2a35-4328-ae7d-8d39052c5cf4","taskId":101&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-20</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.667] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息4113e1b57-d258-4ac4-96da-2dcdc531f823","taskId":104&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-23</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 12:10:27.695] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-7] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-4/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:28.450] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:29.453] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:30.452] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.452] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.162] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Marking node(s) as UNREACHABLE [Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)]. Node roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:32.164] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member detected as unreachable: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:32.451] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.457] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.457] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:33.458] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:34.451] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:35.450] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:36.450] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.455] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.457] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:40.168] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Removed)</span></span><br></pre></td></tr></table></figure>
<p>Node3日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:09:48.069] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:09:48.226] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 12:09:48.227] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 12:09:48.238] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:09:48.338] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:09:48.338] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:09:48.361] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.537] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.541] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.541] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.541] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:50.169] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.320] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.321] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.428] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息0185c0218-8792-44a3-9bbe-c79fd5d1fe5e","taskId":100&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息1572b5e48-16dd-4137-92b8-604d92e1fe0e","taskId":101&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息2defa8129-a316-434d-a749-7081a5b11a50","taskId":102&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息375821f49-51e7-4530-8728-c05e96f334fc","taskId":103&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息4764d693f-b803-4b6c-87db-a6c8dcd9ce68","taskId":104&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.430] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:22.430] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-13] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Result] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.373] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.571] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息15cbfbf9d-323d-428a-bbd5-dc66dec9b3e3","taskId":101&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.572] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息4f65324da-5eee-4815-9c3d-6541cfc09446","taskId":104&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息2320bd63b-9911-49bb-a58a-2cc12eac733f","taskId":102&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 12:10:27.706] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-4/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:28.558] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:29.558] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:30.558] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.369] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.GossipStatus] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon#-1409330530] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.558] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.708] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member detected as unreachable: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.371] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Marking node(s) as UNREACHABLE [Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)]. Node roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:32.557] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.565] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.565] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:33.566] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:34.558] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:35.557] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:36.558] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.561] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.562] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-13] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:39.694] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Removed)</span></span><br></pre></td></tr></table></figure>
<h4 id="客户端日志"><a href="#客户端日志" class="headerlink" title="客户端日志"></a>客户端日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:10:21.847] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:10:22.021] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:22.022] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:22.036] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:10:22.148] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:10:22.148] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Started up successfully</span><br><span class="line">Akka Direct Client 启动完成. akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:10:22.179] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:22.288] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Task] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.351] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息0185c0218-8792-44a3-9bbe-c79fd5d1fe5e处理完成","taskId":100&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息1572b5e48-16dd-4137-92b8-604d92e1fe0e处理完成","taskId":101&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息2defa8129-a316-434d-a749-7081a5b11a50处理完成","taskId":102&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息375821f49-51e7-4530-8728-c05e96f334fc处理完成","taskId":103&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息4764d693f-b803-4b6c-87db-a6c8dcd9ce68处理完成","taskId":104&#125;</span></span><br><span class="line"><span class="string">Akka Cluster Client 启动完成. akka://simpleAkkaCluster/user/clientActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.567] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:100</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.568] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:101</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.568] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:102</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.568] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:103</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.569] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:104</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息0d5dbe1b1-5d5d-48cb-8279-7afc9d013633处理完成","taskId":100&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息15cbfbf9d-323d-428a-bbd5-dc66dec9b3e3处理完成","taskId":101&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息2fe9b091d-dbca-4a43-bb8f-4e11fa7db348处理完成","taskId":102&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息338f8e10b-ac1a-4714-9642-8ee64cb4c31f处理完成","taskId":103&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息4f65324da-5eee-4815-9c3d-6541cfc09446处理完成","taskId":104&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.662] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:100</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.662] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:101</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.662] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:102</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.663] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:103</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.663] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:104</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息071a6714d-94af-47e2-b3e2-e298ca60e6f7处理完成","taskId":100&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息1104806a5-2a35-4328-ae7d-8d39052c5cf4处理完成","taskId":101&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息2320bd63b-9911-49bb-a58a-2cc12eac733f处理完成","taskId":102&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息34ce25577-f548-4836-8f86-a7e789f3284f处理完成","taskId":103&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息4113e1b57-d258-4ac4-96da-2dcdc531f823处理完成","taskId":104&#125;</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.683] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/remoting-terminator] Shutting down remote daemon.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.684] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/remoting-terminator] Remote daemon shut down; proceeding with flushing remote transports.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.710] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.remote.Remoting] Remoting shut down</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.711] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/remoting-terminator] Remoting shut down.</span></span><br></pre></td></tr></table></figure>
<h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><ul>
<li><a href="http://www.cnblogs.com/tiger-xc/p/7082905.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiger-xc/p/7082905.html</a></li>
<li><a href="http://blog.csdn.net/tiger_xc/article/details/72857967" target="_blank" rel="noopener">http://blog.csdn.net/tiger_xc/article/details/72857967</a></li>
<li><a href="http://blog.csdn.net/zhanglh046/article/details/78621376" target="_blank" rel="noopener">http://blog.csdn.net/zhanglh046/article/details/78621376</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Akka/" rel="tag"># Akka</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        
          <div class="wp_rating">
            <div id="wpac-rating"></div>
          </div>
        

        

        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/01/组件框架/Akka/Akka与Spring整合应用/" rel="next" title="Akka与Spring整合应用">
                <i class="fa fa-chevron-left"></i> Akka与Spring整合应用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/01/组件框架/Akka/Akka介绍与入门示例/" rel="prev" title="Akka介绍与入门示例">
                Akka介绍与入门示例 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>

  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  




        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/havatar.png" alt="蘇若年">
            
              <p class="site-author-name" itemprop="name">蘇若年</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">文章</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分類</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">標籤</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#工程结构"><span class="nav-number">1.</span> <span class="nav-text">工程结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Maven依赖"><span class="nav-number">2.</span> <span class="nav-text">Maven依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块说明"><span class="nav-number">3.</span> <span class="nav-text">模块说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码示例-服务端"><span class="nav-number">4.</span> <span class="nav-text">代码示例(服务端)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#消息定义"><span class="nav-number">4.1.</span> <span class="nav-text">消息定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端配置"><span class="nav-number">4.2.</span> <span class="nav-text">服务端配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端Actor"><span class="nav-number">4.3.</span> <span class="nav-text">服务端Actor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端主类"><span class="nav-number">4.4.</span> <span class="nav-text">服务端主类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集群状态监听"><span class="nav-number">5.</span> <span class="nav-text">集群状态监听</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Node1日志"><span class="nav-number">5.1.</span> <span class="nav-text">Node1日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node2日志"><span class="nav-number">5.2.</span> <span class="nav-text">Node2日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node3日志"><span class="nav-number">5.3.</span> <span class="nav-text">Node3日志</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码示例-客户端"><span class="nav-number">6.</span> <span class="nav-text">代码示例(客户端)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端配置"><span class="nav-number">6.1.</span> <span class="nav-text">客户端配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端消息转发"><span class="nav-number">6.2.</span> <span class="nav-text">客户端消息转发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端主类"><span class="nav-number">6.3.</span> <span class="nav-text">客户端主类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分布式计算"><span class="nav-number">7.</span> <span class="nav-text">分布式计算</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端日志"><span class="nav-number">7.1.</span> <span class="nav-text">服务端日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端日志"><span class="nav-number">7.2.</span> <span class="nav-text">客户端日志</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#相关文档"><span class="nav-number">8.</span> <span class="nav-text">相关文档</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HuntsWork</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=66129992";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'KWPKbpyuekKLatvOFnCpz9dF-gzGzoHsz',
        appKey: 'pYydnhaL1ddP6c3fPWRnj9AO',
        placeholder: '天青色等烟雨 而我 在等你 ...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("KWPKbpyuekKLatvOFnCpz9dF-gzGzoHsz", "pYydnhaL1ddP6c3fPWRnj9AO");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  <script type="text/javascript">
  wpac_init = window.wpac_init || [];
  wpac_init.push({widget: 'Rating', id: 15497,
    el: 'wpac-rating',
    color: 'fc6423'
  });
  (function() {
    if ('WIDGETPACK_LOADED' in window) return;
    WIDGETPACK_LOADED = true;
    var mc = document.createElement('script');
    mc.type = 'text/javascript';
    mc.async = true;
    mc.src = '//embed.widgetpack.com/widget.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
  })();
  </script>


  

  

  

</body>
</html>
