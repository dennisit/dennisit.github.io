<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>花辭</title>
  
  <subtitle>風月不瘦,雖以千年後。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://dennisit.github.io/"/>
  <updated>2019-02-13T00:13:06.938Z</updated>
  <id>http://dennisit.github.io/</id>
  
  <author>
    <name>蘇若年</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>乐理理论基础</title>
    <link href="http://dennisit.github.io/2018/02/11/%E7%94%9F%E6%B4%BB%E5%A8%B1%E4%B9%90/%E4%B9%90%E7%90%86%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80/"/>
    <id>http://dennisit.github.io/2018/02/11/生活娱乐/乐理理论基础/</id>
    <published>2018-02-11T11:40:53.000Z</published>
    <updated>2019-02-13T00:13:06.938Z</updated>
    
    <content type="html"><![CDATA[<h2 id="五线谱"><a href="#五线谱" class="headerlink" title="五线谱"></a>五线谱</h2><p>大谱表: 高音谱表和低音谱表合并起来就是大谱表.</p><p><img src="/images/大谱表.jpg" width="600px"></p><h2 id="音符"><a href="#音符" class="headerlink" title="音符"></a>音符</h2><p>音符是用来记录不同长短的音的进行符号. 音符包括三个组成部分: 符头和符干和符尾.</p><p>常见的音符有: 全音符、二分音符、四分音符、八分音符、十六分音符、三十二分音符等.</p><a id="more"></a><p><img src="/images/音符.jpg" width="600px"></p><h2 id="自然音调"><a href="#自然音调" class="headerlink" title="自然音调"></a>自然音调</h2><p>一般所说的音调指自然大小调, 一共有24个; </p><p>从钢琴上小字一组的C(中央C)向上数一个八度,到小字二组的C黑白键加起来一共12个键(1、#1、 2、 #2、 3、 4、 #4、 5、 #5、 6、 #6、 7 )就是所谓12平均律;</p><p>以每个音为启始都可以有一对大小调.下图为大谱表和钢琴键盘对照表(箭头所示为中央C的位置)</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413016431737.jpg" alt></p><h2 id="调性类型"><a href="#调性类型" class="headerlink" title="调性类型"></a>调性类型</h2><h3 id="大调调性"><a href="#大调调性" class="headerlink" title="大调调性"></a>大调调性</h3><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413002097519.jpg" alt></p><h3 id="小调调性"><a href="#小调调性" class="headerlink" title="小调调性"></a>小调调性</h3><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413003289710.jpg" alt></p><p>如下图所示</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413015338728.jpg" alt></p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413015472963.jpg" alt></p><h2 id="五声音阶"><a href="#五声音阶" class="headerlink" title="五声音阶"></a>五声音阶</h2><p>五声音阶是在自然大调的基础上,省去第4级音和第7级音.</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413015810554.jpg" alt></p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413015975429.jpg" alt></p><h2 id="音阶规律"><a href="#音阶规律" class="headerlink" title="音阶规律"></a>音阶规律</h2><p>上面介绍了自然大调、自然小调以及衍生出的和声、旋律调, 以及五声音阶. 这里介绍音阶规律, 因为对应的调都是基于自然大调衍生出来的, 所以我们掌握了自然大调后, 其它的调根据规律变换即可.</p><h3 id="大调规律"><a href="#大调规律" class="headerlink" title="大调规律"></a>大调规律</h3><p>升号调(口诀: 4-1-5-2-6-3-7)</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413011767062.jpg" alt></p><blockquote><p>说明: 如果有n个#号,调号则比第n个#所对应的音高一个全音。</p></blockquote><p>降号调(口诀: 7-3-6-2-5-1-4)</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413013345819.jpg" alt></p><p>如下图:</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413029965291.jpg" alt></p><h3 id="五度圈"><a href="#五度圈" class="headerlink" title="五度圈"></a>五度圈</h3><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/music/15413013903092.jpg" alt></p><h2 id="流行钢琴教程"><a href="#流行钢琴教程" class="headerlink" title="流行钢琴教程"></a>流行钢琴教程</h2><blockquote><p>本教程适用于流行钢琴兴趣爱好者,古典钢琴是以技术练习为重点，是将谱子上定好的音符弹出来，类似于照本朗读。它有大量练习曲，目的并不是好听，而是以高强度训练来习得非常复杂的技术，因此一般都枯燥无味。作为成年人学习钢琴，不要从古典练习曲拜厄、加农等开始，要直接学习现代即兴伴奏的体系，从喜欢的歌曲入手。即兴伴奏体系非常简单灵活，强调创新灵感，类似于随性聊天。学了以后立即可以进行弹唱，自娱娱人都十分有用。</p></blockquote><h3 id="1-优酷《数字灵感钢琴课程——精华十二课》"><a href="#1-优酷《数字灵感钢琴课程——精华十二课》" class="headerlink" title="1. 优酷《数字灵感钢琴课程——精华十二课》"></a>1. 优酷《数字灵感钢琴课程——精华十二课》</h3><blockquote><p>这个教程是我看到的最简易高效、最生动的钢琴速成课程。它不仅告诉我们如何弹奏，还教会我们如何零基础作曲。我觉得作者小帅是一个学习的大师，有非常深刻的思想，让人脑洞大开。</p></blockquote><h3 id="2-《蓝调小生司琴即兴伴奏一点通》"><a href="#2-《蓝调小生司琴即兴伴奏一点通》" class="headerlink" title="2.《蓝调小生司琴即兴伴奏一点通》"></a>2.《蓝调小生司琴即兴伴奏一点通》</h3><blockquote><p>微信和百度一搜都有，这是最系统但不失通俗的一套教程。比起数字灵感钢琴课程要更全面和细致些。每集不到10分钟；掌握一集水平就高一截。</p></blockquote><h3 id="3-优酷《教你快速识简谱》"><a href="#3-优酷《教你快速识简谱》" class="headerlink" title="3. 优酷《教你快速识简谱》"></a>3. 优酷《教你快速识简谱》</h3><blockquote><p>共九集，共1.5小时长度。可以跳着看，大概半小时可以搞定简谱。简谱一搞定，弹任何流行歌曲都没有问题了。不一定要学五线谱。</p></blockquote><h3 id="4-优酷《教会键盘速成教材（基础）之快速入门基本的指法（右手和左手基本指法）》"><a href="#4-优酷《教会键盘速成教材（基础）之快速入门基本的指法（右手和左手基本指法）》" class="headerlink" title="4. 优酷《教会键盘速成教材（基础）之快速入门基本的指法（右手和左手基本指法）》"></a>4. 优酷《教会键盘速成教材（基础）之快速入门基本的指法（右手和左手基本指法）》</h3><blockquote><p>共12集，每集10到20分钟。非常通俗易懂。作者佟显生.</p></blockquote><h3 id="5-优酷《林文信流行键盘12小时》和《宋老师教音乐》"><a href="#5-优酷《林文信流行键盘12小时》和《宋老师教音乐》" class="headerlink" title="5. 优酷《林文信流行键盘12小时》和《宋老师教音乐》"></a>5. 优酷《林文信流行键盘12小时》和《宋老师教音乐》</h3><blockquote><p>两个都是系统而实用的教程。林文信的东西在掌握了基本乐理后再看，会发现讲得很透彻通俗。其中第3集的第39分钟讲基本指法可以先看。不过这两个视频教程一集有接近一个小时，零基础的看了会觉得太长。虽然是速成课程，但讲得还是比较复杂。可以在达到一定水平再看。</p></blockquote><h3 id="6-优酷《主内钢琴学校的自频道》"><a href="#6-优酷《主内钢琴学校的自频道》" class="headerlink" title="6. 优酷《主内钢琴学校的自频道》"></a>6. 优酷《主内钢琴学校的自频道》</h3><blockquote><p>有丰富内容，让你对其他视频看不懂的术语加深了解。</p></blockquote><h3 id="7-优酷《钢琴弹唱的秘密》"><a href="#7-优酷《钢琴弹唱的秘密》" class="headerlink" title="7. 优酷《钢琴弹唱的秘密》"></a>7. 优酷《钢琴弹唱的秘密》</h3><blockquote><p>了解了基本的乐理知识后可以看。虽然讲话很小声还带台湾腔，不过可以迅速明白弹唱的原理，。而且可以直观看到大量歌曲是如何伴奏的。作者是台湾的陈俊宇。</p></blockquote><h3 id="8-优酷《-琴之缘电子琴和弦指法》"><a href="#8-优酷《-琴之缘电子琴和弦指法》" class="headerlink" title="8. 优酷《 琴之缘电子琴和弦指法》"></a>8. 优酷《 琴之缘电子琴和弦指法》</h3><blockquote><p>其中有对常用指法的通俗易懂的介绍。3分钟可学会顺指法、穿指法、跨指法、缩指法和扩指法等基本指法。</p></blockquote><h3 id="9-优酷《大卫音乐》"><a href="#9-优酷《大卫音乐》" class="headerlink" title="9. 优酷《大卫音乐》"></a>9. 优酷《大卫音乐》</h3><blockquote><p>他有独门记忆和弦的方法。首先看他的《大卫音乐:钢琴即兴伴奏之菜鸟6分钟学会7个大和弦》，6分钟用几个口诀记住钢琴键盘基本结构和大和弦，是超快入门的好素材。他的《大卫音乐:2分钟学会弹唱《征服》》超清晰帮助我们2分钟明白无伴奏和弦弹奏的本质。《大卫音乐:实用乐理》3分钟明白一张谱子的全部</p></blockquote><h2 id="推荐文章"><a href="#推荐文章" class="headerlink" title="推荐文章"></a>推荐文章</h2><ul><li><a href="https://www.jianshu.com/p/1bd753f06587" target="_blank" rel="noopener">https://www.jianshu.com/p/1bd753f06587</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;五线谱&quot;&gt;&lt;a href=&quot;#五线谱&quot; class=&quot;headerlink&quot; title=&quot;五线谱&quot;&gt;&lt;/a&gt;五线谱&lt;/h2&gt;&lt;p&gt;大谱表: 高音谱表和低音谱表合并起来就是大谱表.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/大谱表.jpg&quot; width=&quot;600px&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;音符&quot;&gt;&lt;a href=&quot;#音符&quot; class=&quot;headerlink&quot; title=&quot;音符&quot;&gt;&lt;/a&gt;音符&lt;/h2&gt;&lt;p&gt;音符是用来记录不同长短的音的进行符号. 音符包括三个组成部分: 符头和符干和符尾.&lt;/p&gt;
&lt;p&gt;常见的音符有: 全音符、二分音符、四分音符、八分音符、十六分音符、三十二分音符等.&lt;/p&gt;
    
    </summary>
    
      <category term="生活娱乐" scheme="http://dennisit.github.io/categories/%E7%94%9F%E6%B4%BB%E5%A8%B1%E4%B9%90/"/>
    
    
      <category term="Music" scheme="http://dennisit.github.io/tags/Music/"/>
    
  </entry>
  
  <entry>
    <title>Elastic实战自动补全</title>
    <link href="http://dennisit.github.io/2017/11/01/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Elastic/Elastic%E5%AE%9E%E6%88%98%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8/"/>
    <id>http://dennisit.github.io/2017/11/01/组件框架/Elastic/Elastic实战自动补全/</id>
    <published>2017-11-01T08:23:15.000Z</published>
    <updated>2018-12-12T00:12:28.395Z</updated>
    
    <content type="html"><![CDATA[<h3 id="自动补全-中文"><a href="#自动补全-中文" class="headerlink" title="自动补全(中文)"></a>自动补全(中文)</h3><h4 id="定义索引"><a href="#定义索引" class="headerlink" title="定义索引"></a>定义索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPUT "http://192.168.0.103:9200/index_test?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"index"</span>: &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"number_of_replicas"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="定义类型"><a href="#定义类型" class="headerlink" title="定义类型"></a>定义类型</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/product/_mapping?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"properties"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span>,</span><br><span class="line">      <span class="string">"search_analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"tag"</span>: &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span>,</span><br><span class="line">      <span class="string">"search_analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"tag_suggest"</span>: &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"completion"</span>,</span><br><span class="line">      <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span>,</span><br><span class="line">      <span class="string">"search_analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XGET "http://192.168.0.103:9200/index_test?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123;</span><br><span class="line">      <span class="string">"product"</span> : &#123;</span><br><span class="line">        <span class="string">"properties"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tag"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tag_suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span>,</span><br><span class="line">            <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"max_input_length"</span> : 50</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tagsuggest"</span> : &#123;</span><br><span class="line">            <span class="string">"properties"</span> : &#123;</span><br><span class="line">              <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"properties"</span> : &#123;</span><br><span class="line">                  <span class="string">"field"</span> : &#123;</span><br><span class="line">                    <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                    <span class="string">"fields"</span> : &#123;</span><br><span class="line">                      <span class="string">"keyword"</span> : &#123;</span><br><span class="line">                        <span class="string">"type"</span> : <span class="string">"keyword"</span>,</span><br><span class="line">                        <span class="string">"ignore_above"</span> : 256</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="string">"size"</span> : &#123;</span><br><span class="line">                    <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"text"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"fields"</span> : &#123;</span><br><span class="line">                  <span class="string">"keyword"</span> : &#123;</span><br><span class="line">                    <span class="string">"type"</span> : <span class="string">"keyword"</span>,</span><br><span class="line">                    <span class="string">"ignore_above"</span> : 256</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1513327157579"</span>,</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"QRHKXGpRSPen2l9u1zWJyw"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"index_test"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="索引数据"><a href="#索引数据" class="headerlink" title="索引数据"></a>索引数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/product/1?pretty=true" -H 'Content-Type: application/json' -d'&#123;</span></span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"花花公子男士修身冬季青年潮流羽绒服"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"羽绒服, 青年, 潮流"</span>,</span><br><span class="line">  <span class="string">"tag_suggest"</span>: <span class="string">"羽绒服, 青年, 潮流"</span></span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]# curl -XPOST "http://192.168.0.103:9200/index_test/product/2?pretty=true" -H '</span>Content-Type: application/json<span class="string">' -d'</span>&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"波司登中老年爸爸加厚保暖男士羽绒服"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"羽绒服, 保暖, 加厚, 中老年"</span>,</span><br><span class="line">  <span class="string">"tag_suggest"</span>: <span class="string">"羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]#  curl -XPOST "http://192.168.0.103:9200/index_test/product/3?pretty=true" -H '</span>Content-Type: application/json<span class="string">' -d'</span>&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"真皮进口头层牛皮立领修身中年皮夹克"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"羽毛, 中年, 绒, 修身, 羽绒"</span>,</span><br><span class="line">  <span class="string">"tag_suggest"</span>: <span class="string">"羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="搜索示例"><a href="#搜索示例" class="headerlink" title="搜索示例"></a>搜索示例</h4><h5 id="简单自动补全示例"><a href="#简单自动补全示例" class="headerlink" title="简单自动补全示例"></a>简单自动补全示例</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"prefix"</span> : <span class="string">"羽绒"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 6,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 1,</span></span><br><span class="line"><span class="string">    "successful" : 1,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "羽绒",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 2,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "name" : "波司登中老年爸爸加厚保暖男士羽绒服",</span></span><br><span class="line"><span class="string">              "tag" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "name" : "花花公子男士修身冬季青年潮流羽绒服",</span></span><br><span class="line"><span class="string">              "tag" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="指定返回特定列"><a href="#指定返回特定列" class="headerlink" title="指定返回特定列"></a>指定返回特定列</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"prefix"</span> : <span class="string">"羽绒"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 6,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 1,</span></span><br><span class="line"><span class="string">    "successful" : 1,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "羽绒",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 2,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="模糊搜索"><a href="#模糊搜索" class="headerlink" title="模糊搜索"></a>模糊搜索</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"羽类"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"fuzzy"</span> : &#123;</span><br><span class="line">                    <span class="string">"fuzziness"</span> : 2</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 9,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 1,</span></span><br><span class="line"><span class="string">    "successful" : 1,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "羽类",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 2,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 3.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "name" : "波司登中老年爸爸加厚保暖男士羽绒服",</span></span><br><span class="line"><span class="string">              "tag" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 3.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "name" : "花花公子男士修身冬季青年潮流羽绒服",</span></span><br><span class="line"><span class="string">              "tag" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="指定推荐数量"><a href="#指定推荐数量" class="headerlink" title="指定推荐数量"></a>指定推荐数量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"羽"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 5,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 1,</span></span><br><span class="line"><span class="string">    "successful" : 1,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "羽",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 1,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽毛, 中年, 绒, 修身, 羽绒",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "3",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]# curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H '</span>Content-Type: application/json<span class="string">' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"羽"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"size"</span>: 2</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 3,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 1,</span></span><br><span class="line"><span class="string">    "successful" : 1,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "羽",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 1,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽毛, 中年, 绒, 修身, 羽绒",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "3",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="拼音搜索推荐"><a href="#拼音搜索推荐" class="headerlink" title="拼音搜索推荐"></a>拼音搜索推荐</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"yu"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"size"</span>: 2</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">' </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 2,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 1,</span></span><br><span class="line"><span class="string">    "successful" : 1,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "yu",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 2,</span></span><br><span class="line"><span class="string">        "options" : [ ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>可以看到拼音搜索并不能得到友好的推荐词,所以需要结合拼音分词进行再一次优化.</p><h3 id="自动补全-中文-拼音"><a href="#自动补全-中文-拼音" class="headerlink" title="自动补全(中文+拼音)"></a>自动补全(中文+拼音)</h3><h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XDELETE "http://192.168.0.103:9200/index_test*?pretty=true"</span></span><br></pre></td></tr></table></figure><h4 id="定义索引-1"><a href="#定义索引-1" class="headerlink" title="定义索引"></a>定义索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPUT <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123; </span></span><br><span class="line"><span class="string">    "index" : &#123;</span></span><br><span class="line"><span class="string">        "analysis": &#123;</span></span><br><span class="line"><span class="string">              "analyzer": &#123;</span></span><br><span class="line"><span class="string">                "default" : &#123;</span></span><br><span class="line"><span class="string">                   "tokenizer" : "ik_smart"</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                "ik_pinyin_analyzer": &#123;</span></span><br><span class="line"><span class="string">                  "tokenizer": "ik_smart",</span></span><br><span class="line"><span class="string">                  "filter": [</span></span><br><span class="line"><span class="string">                    "mix_pinyin",</span></span><br><span class="line"><span class="string">                    "word_delimiter"</span></span><br><span class="line"><span class="string">                  ]</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              "filter": &#123;</span></span><br><span class="line"><span class="string">                "mix_pinyin": &#123;</span></span><br><span class="line"><span class="string">                  "type": "pinyin",</span></span><br><span class="line"><span class="string">                  "keep_full_pinyin" : true,</span></span><br><span class="line"><span class="string">                  "lowercase" : true,</span></span><br><span class="line"><span class="string">                  "first_letter": "prefix",</span></span><br><span class="line"><span class="string">                  "padding_char": " "</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "number_of_shards": "3",</span></span><br><span class="line"><span class="string">    "number_of_replicas": "1"</span></span><br><span class="line"><span class="string">&#125;'</span></span><br></pre></td></tr></table></figure><h4 id="定义类型-1"><a href="#定义类型-1" class="headerlink" title="定义类型"></a>定义类型</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/product/_mapping?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"properties"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span>,</span><br><span class="line">      <span class="string">"search_analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"tag"</span>: &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span>,</span><br><span class="line">      <span class="string">"search_analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"tag_suggest"</span>: &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"completion"</span>,</span><br><span class="line">      <span class="string">"analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span>,</span><br><span class="line">      <span class="string">"search_analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span>,</span><br><span class="line">      <span class="string">"preserve_separators"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/product/1?pretty=true" -H 'Content-Type: application/json' -d'&#123;</span></span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"花花公子男士修身冬季青年潮流羽绒服"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"羽绒服, 青年, 潮流"</span>,</span><br><span class="line">  <span class="string">"tag_suggest"</span>: <span class="string">"羽绒服, 青年, 潮流"</span></span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]# curl -XPOST "http://192.168.0.103:9200/index_test/product/2?pretty=true" -H '</span>Content-Type: application/json<span class="string">' -d'</span>&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"波司登中老年爸爸加厚保暖男士羽绒服"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"羽绒服, 保暖, 加厚, 中老年"</span>,</span><br><span class="line">  <span class="string">"tag_suggest"</span>: <span class="string">"羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]#  curl -XPOST "http://192.168.0.103:9200/index_test/product/3?pretty=true" -H '</span>Content-Type: application/json<span class="string">' -d'</span>&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"真皮进口头层牛皮立领修身中年皮夹克"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"羽毛, 中年, 绒, 修身, 羽绒"</span>,</span><br><span class="line">  <span class="string">"tag_suggest"</span>: <span class="string">"羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="补全搜索-拼音"><a href="#补全搜索-拼音" class="headerlink" title="补全搜索(拼音)"></a>补全搜索(拼音)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"yumao"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"size"</span>: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">' </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 17,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 3,</span></span><br><span class="line"><span class="string">    "successful" : 3,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "yumao",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 5,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽毛, 中年, 绒, 修身, 羽绒",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "3",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="模糊搜索-拼音"><a href="#模糊搜索-拼音" class="headerlink" title="模糊搜索(拼音)"></a>模糊搜索(拼音)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"yumao"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"fuzzy"</span> : &#123;</span><br><span class="line">                    <span class="string">"fuzziness"</span> : 2</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"size"</span>: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">' </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 18,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 3,</span></span><br><span class="line"><span class="string">    "successful" : 3,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "yumao",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 5,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽毛, 中年, 绒, 修身, 羽绒",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "3",</span></span><br><span class="line"><span class="string">            "_score" : 3.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 2.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 2.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]# curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H '</span>Content-Type: application/json<span class="string">' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"yu毛"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"fuzzy"</span> : &#123;</span><br><span class="line">                    <span class="string">"fuzziness"</span> : 2</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"size"</span>: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">' </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 11,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 3,</span></span><br><span class="line"><span class="string">    "successful" : 3,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "yu毛",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 3,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽毛, 中年, 绒, 修身, 羽绒",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "3",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 1.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]# curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H '</span>Content-Type: application/json<span class="string">' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_source"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"羽毛"</span>,</span><br><span class="line">            <span class="string">"completion"</span> : &#123;</span><br><span class="line">                <span class="string">"field"</span> : <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"fuzzy"</span> : &#123;</span><br><span class="line">                    <span class="string">"fuzziness"</span> : 2</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"size"</span>: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">' </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "took" : 13,</span></span><br><span class="line"><span class="string">  "timed_out" : false,</span></span><br><span class="line"><span class="string">  "_shards" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 3,</span></span><br><span class="line"><span class="string">    "successful" : 3,</span></span><br><span class="line"><span class="string">    "skipped" : 0,</span></span><br><span class="line"><span class="string">    "failed" : 0</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "hits" : &#123;</span></span><br><span class="line"><span class="string">    "total" : 0,</span></span><br><span class="line"><span class="string">    "max_score" : 0.0,</span></span><br><span class="line"><span class="string">    "hits" : [ ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "suggest" : &#123;</span></span><br><span class="line"><span class="string">    "product-suggest" : [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "text" : "羽毛",</span></span><br><span class="line"><span class="string">        "offset" : 0,</span></span><br><span class="line"><span class="string">        "length" : 2,</span></span><br><span class="line"><span class="string">        "options" : [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽毛, 中年, 绒, 修身, 羽绒",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "3",</span></span><br><span class="line"><span class="string">            "_score" : 3.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽毛, 中年, 绒, 修身, 羽绒"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 保暖, 加厚, 中老年",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "2",</span></span><br><span class="line"><span class="string">            "_score" : 2.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 保暖, 加厚, 中老年"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "text" : "羽绒服, 青年, 潮流",</span></span><br><span class="line"><span class="string">            "_index" : "index_test",</span></span><br><span class="line"><span class="string">            "_type" : "product",</span></span><br><span class="line"><span class="string">            "_id" : "1",</span></span><br><span class="line"><span class="string">            "_score" : 2.0,</span></span><br><span class="line"><span class="string">            "_source" : &#123;</span></span><br><span class="line"><span class="string">              "tag_suggest" : "羽绒服, 青年, 潮流"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@icloud-store ~]# curl -XPOST "http://192.168.0.103:9200/index_test/_search?pretty" -H '</span>Content-Type: application/json<span class="string">' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"suggest"</span>: &#123;</span><br><span class="line">        <span class="string">"product-suggest"</span> : &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"yu毛"</span>,</span><br><span class="line">            <span class="string">"completion"</span>: &#123;</span><br><span class="line">                <span class="string">"field"</span>: <span class="string">"tag_suggest"</span>,</span><br><span class="line">                <span class="string">"highlight"</span>: &#123;</span><br><span class="line">                  <span class="string">"pre_tag"</span>: <span class="string">"&lt;em&gt;"</span>,</span><br><span class="line">                  <span class="string">"post_tag"</span>: <span class="string">"&lt;/em&gt;"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"size"</span>: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;自动补全-中文&quot;&gt;&lt;a href=&quot;#自动补全-中文&quot; class=&quot;headerlink&quot; title=&quot;自动补全(中文)&quot;&gt;&lt;/a&gt;自动补全(中文)&lt;/h3&gt;&lt;h4 id=&quot;定义索引&quot;&gt;&lt;a href=&quot;#定义索引&quot; class=&quot;headerlink&quot; title=&quot;定义索引&quot;&gt;&lt;/a&gt;定义索引&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@icloud-store ~]&lt;span class=&quot;comment&quot;&gt;# curl -XPUT &quot;http://192.168.0.103:9200/index_test?pretty=true&quot; -H &#39;Content-Type: application/json&#39; -d&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;index&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;number_of_shards&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;number_of_replicas&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;string&quot;&gt;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;定义类型&quot;&gt;&lt;a href=&quot;#定义类型&quot; class=&quot;headerlink&quot; title=&quot;定义类型&quot;&gt;&lt;/a&gt;定义类型&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@icloud-store ~]&lt;span class=&quot;comment&quot;&gt;# curl -XPOST &quot;http://192.168.0.103:9200/index_test/product/_mapping?pretty=true&quot; -H &#39;Content-Type: application/json&#39; -d&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;properties&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;search_analyzer&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;search_analyzer&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;tag_suggest&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;search_analyzer&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;string&quot;&gt;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Elastic" scheme="http://dennisit.github.io/tags/Elastic/"/>
    
  </entry>
  
  <entry>
    <title>Elastic索引定义应用</title>
    <link href="http://dennisit.github.io/2017/10/11/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Elastic/Elastic%E7%B4%A2%E5%BC%95%E5%AE%9A%E4%B9%89%E5%BA%94%E7%94%A8/"/>
    <id>http://dennisit.github.io/2017/10/11/组件框架/Elastic/Elastic索引定义应用/</id>
    <published>2017-10-11T08:23:15.000Z</published>
    <updated>2018-12-12T00:12:31.506Z</updated>
    
    <content type="html"><![CDATA[<h3 id="数据索引"><a href="#数据索引" class="headerlink" title="数据索引"></a>数据索引</h3><h4 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h4><p>Elastic数据类型和数据库字段类型映射关系</p><table><thead><tr><th>数据库类型</th><th>Elastic类型</th><th>说明</th></tr></thead><tbody><tr><td>String/Varchar</td><td>keyword</td><td>该field不做分词</td></tr><tr><td>String/Varchar/Text</td><td>text</td><td>该field会经过分词处理</td></tr><tr><td>Integer</td><td>integer</td><td>int类型(32bit)</td></tr><tr><td>Long</td><td>long</td><td>long类型(64bit)</td></tr><tr><td>float</td><td>float</td><td>浮点类型(32bit)</td></tr><tr><td>double</td><td>double</td><td>浮点类型(64bit)</td></tr><tr><td>boolean</td><td>boolean</td><td>布尔类型: true或者false</td></tr><tr><td>date/datetime</td><td>date</td><td>日期类型: 2015-10-11, 2015-10-11T22:21:10</td></tr><tr><td>bytes/binary</td><td>binary</td><td>二进制类型, 用于存储文件或者字节流</td></tr></tbody></table><a id="more"></a><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># curl -XPUT "http://127.0.0.1:9200/db_test?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index"</span>: &#123;</span><br><span class="line">    <span class="string">"analysis"</span>: &#123;</span><br><span class="line">      <span class="string">"filter"</span>: &#123;</span><br><span class="line">        <span class="string">"mix_pinyin"</span>: &#123;</span><br><span class="line">          <span class="string">"lowercase"</span>: <span class="string">"true"</span>,</span><br><span class="line">          <span class="string">"padding_char"</span>: <span class="string">" "</span>,</span><br><span class="line">          <span class="string">"first_letter"</span>: <span class="string">"prefix"</span>,</span><br><span class="line">          <span class="string">"keep_original"</span>: <span class="string">"true"</span>,</span><br><span class="line">          <span class="string">"remove_duplicated_term"</span>: <span class="string">"true"</span>,</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"pinyin"</span>,</span><br><span class="line">          <span class="string">"keep_full_pinyin"</span>: <span class="string">"true"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"analyzer"</span>: &#123;</span><br><span class="line">        <span class="string">"ik_pinyin_analyzer"</span>: &#123;</span><br><span class="line">          <span class="string">"filter"</span>: [</span><br><span class="line">            <span class="string">"mix_pinyin"</span>,</span><br><span class="line">            <span class="string">"word_delimiter"</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"custom"</span>,</span><br><span class="line">          <span class="string">"tokenizer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"default"</span>: &#123;</span><br><span class="line">          <span class="string">"tokenizer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"number_of_shards"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"number_of_replicas"</span>: <span class="string">"1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="定义类型"><a href="#定义类型" class="headerlink" title="定义类型"></a>定义类型</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># curl -XPOST "http://127.0.0.1:9200/db_test/tb_opus/_mapping?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">"properties"</span>: &#123;</span><br><span class="line">   <span class="string">"aliasName"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">     <span class="string">"fields"</span>: &#123;</span><br><span class="line">       <span class="string">"origin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"pinyin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">         <span class="string">"term_vector"</span>: <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"suggest"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"completion"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">         <span class="string">"preserve_separators"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"preserve_position_increments"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"max_input_length"</span>: 50</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"appId"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"author"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">     <span class="string">"fields"</span>: &#123;</span><br><span class="line">       <span class="string">"origin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"pinyin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">         <span class="string">"term_vector"</span>: <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"suggest"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"completion"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">         <span class="string">"preserve_separators"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"preserve_position_increments"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"max_input_length"</span>: 50</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"createTime"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"date"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"enabled"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"favoriteTotal"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"fingerprint"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"id"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"images"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"introduce"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">     <span class="string">"fields"</span>: &#123;</span><br><span class="line">       <span class="string">"pinyin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">         <span class="string">"boost"</span>: 10.0,</span><br><span class="line">         <span class="string">"term_vector"</span>: <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"issueTime"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"opusName"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">     <span class="string">"fields"</span>: &#123;</span><br><span class="line">       <span class="string">"origin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"pinyin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">         <span class="string">"term_vector"</span>: <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"suggest"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"completion"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">         <span class="string">"preserve_separators"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"preserve_position_increments"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"max_input_length"</span>: 50</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"sort"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"tags"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">     <span class="string">"fields"</span>: &#123;</span><br><span class="line">       <span class="string">"origin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"pinyin"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">         <span class="string">"term_vector"</span>: <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"suggest"</span>: &#123;</span><br><span class="line">         <span class="string">"type"</span>: <span class="string">"completion"</span>,</span><br><span class="line">         <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">         <span class="string">"preserve_separators"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"preserve_position_increments"</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="string">"max_input_length"</span>: 50</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"type"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"integer"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"score"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"double"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"updateTime"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"date"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"userId"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"uuid"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"viewTotal"</span>: &#123;</span><br><span class="line">     <span class="string">"type"</span>: <span class="string">"long"</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h3 id="查看索引信息"><a href="#查看索引信息" class="headerlink" title="查看索引信息"></a>查看索引信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XGET <span class="string">"http://127.0.0.1:9200/db_test?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"db_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123;</span><br><span class="line">      <span class="string">"tb_opus"</span> : &#123;</span><br><span class="line">        <span class="string">"properties"</span> : &#123;</span><br><span class="line">          <span class="string">"aliasName"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"appId"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"author"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"createTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"date"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"enabled"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"favoriteTotal"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"fingerprint"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"id"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"images"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"introduce"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"boost"</span> : 10.0,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"issueTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"opusName"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"score"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"double"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"sort"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tags"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"type"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"updateTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"date"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"userId"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"uuid"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"viewTotal"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1514353694378"</span>,</span><br><span class="line">        <span class="string">"analysis"</span> : &#123;</span><br><span class="line">          <span class="string">"filter"</span> : &#123;</span><br><span class="line">            <span class="string">"mix_pinyin"</span> : &#123;</span><br><span class="line">              <span class="string">"lowercase"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"padding_char"</span> : <span class="string">" "</span>,</span><br><span class="line">              <span class="string">"first_letter"</span> : <span class="string">"prefix"</span>,</span><br><span class="line">              <span class="string">"keep_original"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"remove_duplicated_term"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"pinyin"</span>,</span><br><span class="line">              <span class="string">"keep_full_pinyin"</span> : <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"analyzer"</span> : &#123;</span><br><span class="line">            <span class="string">"ik_pinyin_analyzer"</span> : &#123;</span><br><span class="line">              <span class="string">"filter"</span> : [</span><br><span class="line">                <span class="string">"mix_pinyin"</span>,</span><br><span class="line">                <span class="string">"word_delimiter"</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"custom"</span>,</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"default"</span> : &#123;</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"seg7yr55R121l8tRW3r7uA"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;数据索引&quot;&gt;&lt;a href=&quot;#数据索引&quot; class=&quot;headerlink&quot; title=&quot;数据索引&quot;&gt;&lt;/a&gt;数据索引&lt;/h3&gt;&lt;h4 id=&quot;字段类型&quot;&gt;&lt;a href=&quot;#字段类型&quot; class=&quot;headerlink&quot; title=&quot;字段类型&quot;&gt;&lt;/a&gt;字段类型&lt;/h4&gt;&lt;p&gt;Elastic数据类型和数据库字段类型映射关系&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;数据库类型&lt;/th&gt;
&lt;th&gt;Elastic类型&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;String/Varchar&lt;/td&gt;
&lt;td&gt;keyword&lt;/td&gt;
&lt;td&gt;该field不做分词&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;String/Varchar/Text&lt;/td&gt;
&lt;td&gt;text&lt;/td&gt;
&lt;td&gt;该field会经过分词处理&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Integer&lt;/td&gt;
&lt;td&gt;integer&lt;/td&gt;
&lt;td&gt;int类型(32bit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Long&lt;/td&gt;
&lt;td&gt;long&lt;/td&gt;
&lt;td&gt;long类型(64bit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;float&lt;/td&gt;
&lt;td&gt;float&lt;/td&gt;
&lt;td&gt;浮点类型(32bit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;double&lt;/td&gt;
&lt;td&gt;double&lt;/td&gt;
&lt;td&gt;浮点类型(64bit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;boolean&lt;/td&gt;
&lt;td&gt;boolean&lt;/td&gt;
&lt;td&gt;布尔类型: true或者false&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;date/datetime&lt;/td&gt;
&lt;td&gt;date&lt;/td&gt;
&lt;td&gt;日期类型: 2015-10-11, 2015-10-11T22:21:10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bytes/binary&lt;/td&gt;
&lt;td&gt;binary&lt;/td&gt;
&lt;td&gt;二进制类型, 用于存储文件或者字节流&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Elastic" scheme="http://dennisit.github.io/tags/Elastic/"/>
    
  </entry>
  
  <entry>
    <title>Elastic分词插件介绍</title>
    <link href="http://dennisit.github.io/2017/10/11/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Elastic/Elastic%E5%88%86%E8%AF%8D%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D/"/>
    <id>http://dennisit.github.io/2017/10/11/组件框架/Elastic/Elastic分词插件介绍/</id>
    <published>2017-10-11T08:23:15.000Z</published>
    <updated>2019-01-30T15:40:27.238Z</updated>
    
    <content type="html"><![CDATA[<h3 id="IK分词插件"><a href="#IK分词插件" class="headerlink" title="IK分词插件"></a>IK分词插件</h3><h4 id="插件主页"><a href="#插件主页" class="headerlink" title="插件主页"></a>插件主页</h4><p><a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik</a></p><h4 id="查看插件"><a href="#查看插件" class="headerlink" title="查看插件"></a>查看插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ bin/elasticsearch-plugin list</span><br><span class="line">analysis-ik</span><br><span class="line">analysis-pinyin</span><br><span class="line">analysis-stconvert</span><br></pre></td></tr></table></figure><h3 id="分词测试"><a href="#分词测试" class="headerlink" title="分词测试"></a>分词测试</h3><h3 id="创建测试索引"><a href="#创建测试索引" class="headerlink" title="创建测试索引"></a>创建测试索引</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store logs]<span class="comment"># curl -XPUT "http://192.168.0.103:9200/index_test?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"shards_acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"index"</span> : <span class="string">"index_test"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="测试分词效果"><a href="#测试分词效果" class="headerlink" title="测试分词效果"></a>测试分词效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store logs]<span class="comment"># curl 'http://192.168.0.103:9200/index_test/_analyze?pretty=true' -H 'Content-Type: application/json' -d '&#123; "analyzer":"ik_max_word", "text":"元旦火车票开售."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"元旦"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 2,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"火车票"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 2,</span><br><span class="line">      <span class="string">"end_offset"</span> : 5,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"火车"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 2,</span><br><span class="line">      <span class="string">"end_offset"</span> : 4,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"车票"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 3,</span><br><span class="line">      <span class="string">"end_offset"</span> : 5,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"开售"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 5,</span><br><span class="line">      <span class="string">"end_offset"</span> : 7,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[elon@icloud-store logs]<span class="comment"># curl 'http://192.168.0.103:9200/index_test/_analyze?pretty=true' -H 'Content-Type: application/json' -d '&#123; "analyzer":"ik_smart", "text":"元旦火车 票开售."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"元旦"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 2,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"火车票"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 2,</span><br><span class="line">      <span class="string">"end_offset"</span> : 5,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"开售"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 5,</span><br><span class="line">      <span class="string">"end_offset"</span> : 7,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过对中文串的分词结果可以明显看到, ik_smart和ik_max_word两种模式的分词结果上的差异.</p><ul><li>ik_max_word: 会将文本做最细粒度的拆分，比如会将“元旦火车票开售”拆分为“元旦,火车票,火车,车票,开售”，会穷尽各种可能的组合；</li><li>ik_smart: 会做最粗粒度的拆分，比如会将“元旦火车票开售”拆分为“元旦,火车票,开售”;</li></ul><h3 id="应用示例"><a href="#应用示例" class="headerlink" title="应用示例"></a>应用示例</h3><h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[wuyu@icloud-store elasticsearch-6.0.0]$ curl -XDELETE <span class="string">"http://192.168.0.103:9200/index_test*?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store logs]<span class="comment"># curl -XPUT "http://192.168.0.103:9200/index_test?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"index"</span>: &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"number_of_replicas"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "acknowledged" : true,</span></span><br><span class="line"><span class="string">  "shards_acknowledged" : true,</span></span><br><span class="line"><span class="string">  "index" : "index_test"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET "http://192.168.0.103:9200/index_test?pretty=true"</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "index_test" : &#123;</span></span><br><span class="line"><span class="string">    "aliases" : &#123; &#125;,</span></span><br><span class="line"><span class="string">    "mappings" : &#123; &#125;,</span></span><br><span class="line"><span class="string">    "settings" : &#123;</span></span><br><span class="line"><span class="string">      "index" : &#123;</span></span><br><span class="line"><span class="string">        "creation_date" : "1512990681578",</span></span><br><span class="line"><span class="string">        "number_of_shards" : "1",</span></span><br><span class="line"><span class="string">        "number_of_replicas" : "1",</span></span><br><span class="line"><span class="string">        "uuid" : "tXNLl-JERiuIxn-g4Ip3Og",</span></span><br><span class="line"><span class="string">        "version" : &#123;</span></span><br><span class="line"><span class="string">          "created" : "6000099"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        "provided_name" : "index_test"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="创建类型"><a href="#创建类型" class="headerlink" title="创建类型"></a>创建类型</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/person/_mapping?pretty=true"</span>  -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "properties": &#123;</span></span><br><span class="line"><span class="string">        "name": &#123;</span></span><br><span class="line"><span class="string">            "type": "text",</span></span><br><span class="line"><span class="string">            "analyzer": "ik_max_word",</span></span><br><span class="line"><span class="string">            "search_analyzer": "ik_max_word"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"acknowledged"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123;</span><br><span class="line">      <span class="string">"person"</span> : &#123;</span><br><span class="line">        <span class="string">"properties"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1512990681578"</span>,</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"tXNLl-JERiuIxn-g4Ip3Og"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"index_test"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="索引数据"><a href="#索引数据" class="headerlink" title="索引数据"></a>索引数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/person/1?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦火车票开售."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 0,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/person/2?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦节是公历新一年的第一天."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 1,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/person?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"使用ES默认ID机制创建唯一键"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"psZNRWABuJTmkY1Rwcoe"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 2,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/person/2?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦节是每年1月1号"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 1,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询数据-主键"><a href="#查询数据-主键" class="headerlink" title="查询数据(主键)"></a>查询数据(主键)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test/person/2?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"元旦节是公历新一年的第一天."</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test/person/psZNRWABuJTmkY1Rwcoe?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"psZNRWABuJTmkY1Rwcoe"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"使用ES默认ID机制创建唯一键"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/person/2?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦节是每年1月1号"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 2,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"updated"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 4,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test/person/2?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 2,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"元旦节是每年1月1号"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询数据-关键词、分页、高量"><a href="#查询数据-关键词、分页、高量" class="headerlink" title="查询数据(关键词、分页、高量)"></a>查询数据(关键词、分页、高量)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"192.168.0.103:9200/index_test/person/_search?pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "from" : 0, </span></span><br><span class="line"><span class="string">  "size" : 10,</span></span><br><span class="line"><span class="string">  "query": &#123; </span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">      "name": "元旦"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "highlight": &#123;</span></span><br><span class="line"><span class="string">    "fields": &#123;</span></span><br><span class="line"><span class="string">      "name": &#123;&#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 14,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.5551721,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.5551721,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦火车票开售."</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦&lt;/em&gt;火车票开售."</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"person"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.4471386,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是每年1月1号"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦&lt;/em&gt;节是每年1月1号"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Pinyin分词插件"><a href="#Pinyin分词插件" class="headerlink" title="Pinyin分词插件"></a>Pinyin分词插件</h3><h4 id="插件主页-1"><a href="#插件主页-1" class="headerlink" title="插件主页"></a>插件主页</h4><p><a href="https://github.com/medcl/elasticsearch-analysis-pinyin" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-pinyin</a></p><h4 id="查看插件-1"><a href="#查看插件-1" class="headerlink" title="查看插件"></a>查看插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ bin/elasticsearch-plugin list</span><br><span class="line">analysis-ik</span><br><span class="line">analysis-pinyin</span><br><span class="line">analysis-stconvert</span><br></pre></td></tr></table></figure><h3 id="分词测试-1"><a href="#分词测试-1" class="headerlink" title="分词测试"></a>分词测试</h3><h4 id="创建测试索引-1"><a href="#创建测试索引-1" class="headerlink" title="创建测试索引"></a>创建测试索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPUT <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123; </span></span><br><span class="line"><span class="string">    "index" : &#123;</span></span><br><span class="line"><span class="string">        "analysis" : &#123;</span></span><br><span class="line"><span class="string">            "analyzer" : &#123;</span></span><br><span class="line"><span class="string">                "pinyin_analyzer" : &#123;</span></span><br><span class="line"><span class="string">                    "tokenizer" : "mix_pinyin"</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            "tokenizer" : &#123;</span></span><br><span class="line"><span class="string">                "mix_pinyin" : &#123;</span></span><br><span class="line"><span class="string">                    "type" : "pinyin",</span></span><br><span class="line"><span class="string">                    "keep_separate_first_letter" : false,</span></span><br><span class="line"><span class="string">                    "keep_full_pinyin" : true,</span></span><br><span class="line"><span class="string">                    "keep_original" : true,</span></span><br><span class="line"><span class="string">                    "limit_first_letter_length" : 16,</span></span><br><span class="line"><span class="string">                    "lowercase" : true,</span></span><br><span class="line"><span class="string">                    "remove_duplicated_term" : true</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "number_of_shards": "3",</span></span><br><span class="line"><span class="string">    "number_of_replicas": "1"</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"shards_acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"index"</span> : <span class="string">"index_test"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1513148861791"</span>,</span><br><span class="line">        <span class="string">"analysis"</span> : &#123;</span><br><span class="line">          <span class="string">"analyzer"</span> : &#123;</span><br><span class="line">            <span class="string">"pinyin_analyzer"</span> : &#123;</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"mix_pinyin"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tokenizer"</span> : &#123;</span><br><span class="line">            <span class="string">"mix_pinyin"</span> : &#123;</span><br><span class="line">              <span class="string">"lowercase"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"keep_original"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"remove_duplicated_term"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"keep_separate_first_letter"</span> : <span class="string">"false"</span>,</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"pinyin"</span>,</span><br><span class="line">              <span class="string">"limit_first_letter_length"</span> : <span class="string">"16"</span>,</span><br><span class="line">              <span class="string">"keep_full_pinyin"</span> : <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"uIW8o_bGTkefLEVL5mTw7w"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试分词效果-1"><a href="#测试分词效果-1" class="headerlink" title="测试分词效果"></a>测试分词效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl <span class="string">"http://192.168.0.103:9200/index_test/_analyze?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123; "analyzer":"pinyin_analyzer", "text":"元旦火车票开售."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"yuan"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 1,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"元旦火车票开售."</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 8,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"ydhcpks"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 7,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"dan"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 1,</span><br><span class="line">      <span class="string">"end_offset"</span> : 2,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"huo"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 2,</span><br><span class="line">      <span class="string">"end_offset"</span> : 3,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"che"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 3,</span><br><span class="line">      <span class="string">"end_offset"</span> : 4,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"piao"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 4,</span><br><span class="line">      <span class="string">"end_offset"</span> : 5,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"kai"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 5,</span><br><span class="line">      <span class="string">"end_offset"</span> : 6,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"shou"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 6,</span><br><span class="line">      <span class="string">"end_offset"</span> : 7,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"word"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 6</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="应用示例-Ik-Pinyin"><a href="#应用示例-Ik-Pinyin" class="headerlink" title="应用示例(Ik+Pinyin)"></a>应用示例(Ik+Pinyin)</h3><p>应用示例展示IK+Pinyin集成的索引分词效果</p><h4 id="删除索引-1"><a href="#删除索引-1" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XDELETE <span class="string">"http://192.168.0.103:9200/index_test*?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建索引-1"><a href="#创建索引-1" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPUT <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123; </span></span><br><span class="line"><span class="string">    "index" : &#123;</span></span><br><span class="line"><span class="string">        "analysis": &#123;</span></span><br><span class="line"><span class="string">          "analyzer": &#123;</span></span><br><span class="line"><span class="string">            "default" : &#123;</span></span><br><span class="line"><span class="string">               "tokenizer" : "ik_smart"</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            "ik_pinyin_analyzer": &#123;</span></span><br><span class="line"><span class="string">              "type": "custom",</span></span><br><span class="line"><span class="string">              "tokenizer": "ik_smart",</span></span><br><span class="line"><span class="string">              "filter": [</span></span><br><span class="line"><span class="string">                "mix_pinyin",</span></span><br><span class="line"><span class="string">                "word_delimiter"</span></span><br><span class="line"><span class="string">              ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          "filter": &#123;</span></span><br><span class="line"><span class="string">            "mix_pinyin": &#123;</span></span><br><span class="line"><span class="string">              "type": "pinyin",</span></span><br><span class="line"><span class="string">              "first_letter": "prefix",</span></span><br><span class="line"><span class="string">              "padding_char": " "</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "number_of_shards": "3",</span></span><br><span class="line"><span class="string">    "number_of_replicas": "1"</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"shards_acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"index"</span> : <span class="string">"index_test"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1513155447722"</span>,</span><br><span class="line">        <span class="string">"analysis"</span> : &#123;</span><br><span class="line">          <span class="string">"filter"</span> : &#123;</span><br><span class="line">            <span class="string">"mix_pinyin"</span> : &#123;</span><br><span class="line">              <span class="string">"padding_char"</span> : <span class="string">" "</span>,</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"pinyin"</span>,</span><br><span class="line">              <span class="string">"first_letter"</span> : <span class="string">"prefix"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"analyzer"</span> : &#123;</span><br><span class="line">            <span class="string">"ik_pinyin_analyzer"</span> : &#123;</span><br><span class="line">              <span class="string">"filter"</span> : [</span><br><span class="line">                <span class="string">"mix_pinyin"</span>,</span><br><span class="line">                <span class="string">"word_delimiter"</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"custom"</span>,</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"default"</span> : &#123;</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"JiyIMwnlS7mpMB1T-3MmOQ"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试分词效果-2"><a href="#测试分词效果-2" class="headerlink" title="测试分词效果"></a>测试分词效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl <span class="string">"http://192.168.0.103:9200/index_test/_analyze?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123; "analyzer":"ik_pinyin_analyzer", "text":"元旦节是公历新一年的第一天."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"tokens"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"yuan"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 3,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"dan"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 3,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"jie"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 3,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"ydj"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 0,</span><br><span class="line">      <span class="string">"end_offset"</span> : 3,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"shi"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 3,</span><br><span class="line">      <span class="string">"end_offset"</span> : 4,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"s"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 3,</span><br><span class="line">      <span class="string">"end_offset"</span> : 4,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"gong"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 4,</span><br><span class="line">      <span class="string">"end_offset"</span> : 6,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"li"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 4,</span><br><span class="line">      <span class="string">"end_offset"</span> : 6,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"gl"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 4,</span><br><span class="line">      <span class="string">"end_offset"</span> : 6,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"xin"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 6,</span><br><span class="line">      <span class="string">"end_offset"</span> : 7,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"x"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 6,</span><br><span class="line">      <span class="string">"end_offset"</span> : 7,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"yi"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 7,</span><br><span class="line">      <span class="string">"end_offset"</span> : 9,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"nian"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 7,</span><br><span class="line">      <span class="string">"end_offset"</span> : 9,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"yn"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 7,</span><br><span class="line">      <span class="string">"end_offset"</span> : 9,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"de"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 9,</span><br><span class="line">      <span class="string">"end_offset"</span> : 10,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"d"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 9,</span><br><span class="line">      <span class="string">"end_offset"</span> : 10,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_CHAR"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"di"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 10,</span><br><span class="line">      <span class="string">"end_offset"</span> : 13,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"yi"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 10,</span><br><span class="line">      <span class="string">"end_offset"</span> : 13,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"tian"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 10,</span><br><span class="line">      <span class="string">"end_offset"</span> : 13,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"token"</span> : <span class="string">"dyt"</span>,</span><br><span class="line">      <span class="string">"start_offset"</span> : 10,</span><br><span class="line">      <span class="string">"end_offset"</span> : 13,</span><br><span class="line">      <span class="string">"type"</span> : <span class="string">"CN_WORD"</span>,</span><br><span class="line">      <span class="string">"position"</span> : 12</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建类型-1"><a href="#创建类型-1" class="headerlink" title="创建类型"></a>创建类型</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl <span class="string">"http://192.168.0.103:9200/index_test/article/_mapping?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "properties": &#123;</span></span><br><span class="line"><span class="string">        "name": &#123;</span></span><br><span class="line"><span class="string">            "type" : "text",</span></span><br><span class="line"><span class="string">            "analyzer" : "ik_smart",</span></span><br><span class="line"><span class="string">            "fields" : &#123;</span></span><br><span class="line"><span class="string">                "pinyin" : &#123;</span></span><br><span class="line"><span class="string">                    "type" : "text",</span></span><br><span class="line"><span class="string">                    "term_vector" : "with_positions_offsets",</span></span><br><span class="line"><span class="string">                    "analyzer" : "ik_pinyin_analyzer",</span></span><br><span class="line"><span class="string">                    "boost" : 10.0</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test?pretty=true"</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"index_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123;</span><br><span class="line">      <span class="string">"article"</span> : &#123;</span><br><span class="line">        <span class="string">"properties"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"boost"</span> : 10.0,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1513155447722"</span>,</span><br><span class="line">        <span class="string">"analysis"</span> : &#123;</span><br><span class="line">          <span class="string">"filter"</span> : &#123;</span><br><span class="line">            <span class="string">"mix_pinyin"</span> : &#123;</span><br><span class="line">              <span class="string">"padding_char"</span> : <span class="string">" "</span>,</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"pinyin"</span>,</span><br><span class="line">              <span class="string">"first_letter"</span> : <span class="string">"prefix"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"analyzer"</span> : &#123;</span><br><span class="line">            <span class="string">"ik_pinyin_analyzer"</span> : &#123;</span><br><span class="line">              <span class="string">"filter"</span> : [</span><br><span class="line">                <span class="string">"mix_pinyin"</span>,</span><br><span class="line">                <span class="string">"word_delimiter"</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"custom"</span>,</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"default"</span> : &#123;</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"JiyIMwnlS7mpMB1T-3MmOQ"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="索引数据-1"><a href="#索引数据-1" class="headerlink" title="索引数据"></a>索引数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/article/1?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦火车票 开售."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 0,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/article/2?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦节是公历新一年的第一天."&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 0,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/article/3?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"name":"元旦节是每年1月1号"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 1,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询数据-主键-1"><a href="#查询数据-主键-1" class="headerlink" title="查询数据(主键)"></a>查询数据(主键)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XGET <span class="string">"http://192.168.0.103:9200/index_test/article/2?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"元旦节是公历新一年的第一天."</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询数据-中文"><a href="#查询数据-中文" class="headerlink" title="查询数据(中文)"></a>查询数据(中文)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/article/_search?pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "from" : 0, </span></span><br><span class="line"><span class="string">  "size" : 10,</span></span><br><span class="line"><span class="string">  "query": &#123; </span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">      "name": "元旦节"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "highlight": &#123;</span></span><br><span class="line"><span class="string">    "fields": &#123;</span></span><br><span class="line"><span class="string">      "name": &#123;&#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 9,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"successful"</span> : 3,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.6288345,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.6288345,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是每年1月1号"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦节&lt;/em&gt;是每年1月1号"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.2876821,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是公历新一年的第一天."</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦节&lt;/em&gt;是公历新一年的第一天."</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询数据-拼音"><a href="#查询数据-拼音" class="headerlink" title="查询数据(拼音)"></a>查询数据(拼音)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/article/_search?pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "from" : 0, </span></span><br><span class="line"><span class="string">  "size" : 10,</span></span><br><span class="line"><span class="string">  "query": &#123; </span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">      "name.pinyin": "ydj"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "highlight": &#123;</span></span><br><span class="line"><span class="string">    "fields": &#123;</span></span><br><span class="line"><span class="string">      "name.pinyin": &#123;&#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 7,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"successful"</span> : 3,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"max_score"</span> : 7.5108185,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 7.5108185,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是每年1月1号"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name.pinyin"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦节&lt;/em&gt;是每年1&lt;em&gt;月&lt;/em&gt;1号"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 3.693319,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是公历新一年的第一天."</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name.pinyin"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦节&lt;/em&gt;是公历新一年&lt;em&gt;的&lt;/em&gt;第一天."</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ curl -XPOST <span class="string">"http://192.168.0.103:9200/index_test/article/_search?pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "from" : 0, </span></span><br><span class="line"><span class="string">  "size" : 10,</span></span><br><span class="line"><span class="string">  "query": &#123; </span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">      "name.pinyin": "元旦j"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "highlight": &#123;</span></span><br><span class="line"><span class="string">    "fields": &#123;</span></span><br><span class="line"><span class="string">      "name.pinyin": &#123;&#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 16,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"successful"</span> : 3,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"max_score"</span> : 3.693319,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 3.693319,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是公历新一年的第一天."</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name.pinyin"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦节&lt;/em&gt;是公历新一年的第一天."</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 2.560377,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦火车票 开售."</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name.pinyin"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦&lt;/em&gt;火车票 开售."</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"article"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.9756038,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"元旦节是每年1月1号"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"name.pinyin"</span> : [</span><br><span class="line">            <span class="string">"&lt;em&gt;元旦节&lt;/em&gt;是每年1月1号"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;IK分词插件&quot;&gt;&lt;a href=&quot;#IK分词插件&quot; class=&quot;headerlink&quot; title=&quot;IK分词插件&quot;&gt;&lt;/a&gt;IK分词插件&lt;/h3&gt;&lt;h4 id=&quot;插件主页&quot;&gt;&lt;a href=&quot;#插件主页&quot; class=&quot;headerlink&quot; title=&quot;插件主页&quot;&gt;&lt;/a&gt;插件主页&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/medcl/elasticsearch-analysis-ik&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/medcl/elasticsearch-analysis-ik&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;查看插件&quot;&gt;&lt;a href=&quot;#查看插件&quot; class=&quot;headerlink&quot; title=&quot;查看插件&quot;&gt;&lt;/a&gt;查看插件&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elon@icloud-store elasticsearch-6.0.0]$ bin/elasticsearch-plugin list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;analysis-ik&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;analysis-pinyin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;analysis-stconvert&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;分词测试&quot;&gt;&lt;a href=&quot;#分词测试&quot; class=&quot;headerlink&quot; title=&quot;分词测试&quot;&gt;&lt;/a&gt;分词测试&lt;/h3&gt;&lt;h3 id=&quot;创建测试索引&quot;&gt;&lt;a href=&quot;#创建测试索引&quot; class=&quot;headerlink&quot; title=&quot;创建测试索引&quot;&gt;&lt;/a&gt;创建测试索引&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elon@icloud-store logs]&lt;span class=&quot;comment&quot;&gt;# curl -XPUT &quot;http://192.168.0.103:9200/index_test?pretty=true&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;acknowledged&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;shards_acknowledged&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;index&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;index_test&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Elastic" scheme="http://dennisit.github.io/tags/Elastic/"/>
    
  </entry>
  
  <entry>
    <title>Elastic安装配置说明</title>
    <link href="http://dennisit.github.io/2017/10/10/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Elastic/Elastic%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E/"/>
    <id>http://dennisit.github.io/2017/10/10/组件框架/Elastic/Elastic安装配置说明/</id>
    <published>2017-10-10T08:23:15.000Z</published>
    <updated>2019-01-30T15:40:34.197Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Elastic下载安装"><a href="#Elastic下载安装" class="headerlink" title="Elastic下载安装"></a>Elastic下载安装</h3><h4 id="下载Elastic"><a href="#下载Elastic" class="headerlink" title="下载Elastic"></a>下载Elastic</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elonsu cloud]<span class="comment"># wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.0.tar.gz</span></span><br><span class="line">[root@elonsu cloud]<span class="comment"># tar -zxvf elasticsearch-5.6.0.tar.gz </span></span><br><span class="line">[root@elonsu cloud]<span class="comment"># mv elasticsearch-5.6.0 elastic</span></span><br></pre></td></tr></table></figure><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><p>Elastic默认不支持root用户启动, 这里创建用户dennisit</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@elonsu cloud]<span class="comment"># pwd</span></span><br><span class="line">/<span class="built_in">export</span>/cloud</span><br><span class="line">[root@elonsu ~]<span class="comment"># adduser dennisit</span></span><br><span class="line">[root@elonsu ~]<span class="comment"># passwd dennisit</span></span><br><span class="line">Changing password <span class="keyword">for</span> user dennisit.</span><br><span class="line">New password: </span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@elonsu cloud]<span class="comment"># chown dennisit:dennisit elastic -R</span></span><br><span class="line">[root@elonsu cloud]<span class="comment"># su dennisit</span></span><br><span class="line">[dennisit@elonsu cloud]$ <span class="built_in">cd</span> elastic</span><br><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch &amp;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Elastic分词插件"><a href="#Elastic分词插件" class="headerlink" title="Elastic分词插件"></a>Elastic分词插件</h3><h4 id="中文分词插件"><a href="#中文分词插件" class="headerlink" title="中文分词插件"></a>中文分词插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.0.0/elasticsearch-analysis-ik-6.0.0.zip</span><br></pre></td></tr></table></figure><h4 id="拼音分词插件"><a href="#拼音分词插件" class="headerlink" title="拼音分词插件"></a>拼音分词插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-pinyin/releases/download/v6.0.0/elasticsearch-analysis-pinyin-6.0.0.zip</span><br></pre></td></tr></table></figure><h4 id="简繁转换插件"><a href="#简繁转换插件" class="headerlink" title="简繁转换插件"></a>简繁转换插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-stconvert/releases/download/v6.0.0/elasticsearch-analysis-stconvert-6.0.0.zip</span><br></pre></td></tr></table></figure><!-- more --><h4 id="安装插件查看"><a href="#安装插件查看" class="headerlink" title="安装插件查看"></a>安装插件查看</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch-plugin list</span><br><span class="line">analysis-ik</span><br><span class="line">analysis-pinyin</span><br><span class="line">analysis-stconvert</span><br></pre></td></tr></table></figure><h3 id="Elastic插件-Head插件"><a href="#Elastic插件-Head插件" class="headerlink" title="Elastic插件-Head插件"></a>Elastic插件-Head插件</h3><p>插件地址: <a href="https://github.com/mobz/elasticsearch-head/" target="_blank" rel="noopener">https://github.com/mobz/elasticsearch-head/</a><br>推荐安装: Chrome插件方式(简单省事)</p><h3 id="Elastic插件-IK分词器"><a href="#Elastic插件-IK分词器" class="headerlink" title="Elastic插件-IK分词器"></a>Elastic插件-IK分词器</h3><h4 id="插件主页"><a href="#插件主页" class="headerlink" title="插件主页"></a>插件主页</h4><p><a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik</a></p><h4 id="安装IK分词器"><a href="#安装IK分词器" class="headerlink" title="安装IK分词器"></a>安装IK分词器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu cloud]$ <span class="built_in">cd</span> elastic</span><br><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.6.0/elasticsearch-analysis-ik-5.6.0.zip</span><br><span class="line">-&gt; Downloading https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.6.0/elasticsearch-analysis-ik-5.6.0.zip</span><br><span class="line">[=================================================] 100%   </span><br><span class="line">-&gt; Installed analysis-ik</span><br><span class="line">[dennisit@elonsu elastic]$ bin/elasticsearch &amp;</span><br><span class="line">[1] 33893</span><br></pre></td></tr></table></figure><h4 id="查看安装插件"><a href="#查看安装插件" class="headerlink" title="查看安装插件"></a>查看安装插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elon@icloud-store elasticsearch-6.0.0]$ bin/elasticsearch-plugin list</span><br><span class="line">analysis-ik</span><br><span class="line">analysis-pinyin</span><br><span class="line">analysis-stconvert</span><br></pre></td></tr></table></figure><h4 id="验证IK分词器"><a href="#验证IK分词器" class="headerlink" title="验证IK分词器"></a>验证IK分词器</h4><h5 id="创建index"><a href="#创建index" class="headerlink" title="创建index"></a>创建index</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ curl -XPUT http://localhost:9200/index</span><br><span class="line">[2017-09-26T14:08:12,782][INFO ][o.w.a.d.Monitor          ] try load config from /<span class="built_in">export</span>/cloud/elastic/config/analysis-ik/IKAnalyzer.cfg.xml</span><br><span class="line">[2017-09-26T14:08:13,243][INFO ][o.e.c.m.MetaDataCreateIndexService] [OWIX3y4] [index] creating index, cause [api], templates [], shards [5]/[1], mappings []</span><br></pre></td></tr></table></figure><h5 id="创建mapping"><a href="#创建mapping" class="headerlink" title="创建mapping"></a>创建mapping</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ curl -XPOST http://localhost:9200/index/fulltext/_mapping -d<span class="string">'</span></span><br><span class="line"><span class="string">&gt; &#123;</span></span><br><span class="line"><span class="string">&gt;         "properties": &#123;</span></span><br><span class="line"><span class="string">&gt;             "content": &#123;</span></span><br><span class="line"><span class="string">&gt;                 "type": "text",</span></span><br><span class="line"><span class="string">&gt;                 "analyzer": "ik_max_word",</span></span><br><span class="line"><span class="string">&gt;                 "search_analyzer": "ik_max_word"</span></span><br><span class="line"><span class="string">&gt;             &#125;</span></span><br><span class="line"><span class="string">&gt;         &#125;</span></span><br><span class="line"><span class="string">&gt;     </span></span><br><span class="line"><span class="string">&gt; &#125;'</span></span><br><span class="line">[2017-09-26T14:08:58,805][INFO ][o.e.c.m.MetaDataMappingService] [OWIX3y4] [index/ZNJu9Nz_R-qJKTDUnoIlxQ] create_mapping [fulltext]</span><br><span class="line">&#123;<span class="string">"acknowledged"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="索引Document"><a href="#索引Document" class="headerlink" title="索引Document"></a>索引Document</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ curl -XPOST http://localhost:9200/index/fulltext/3?pretty -d  <span class="string">'&#123;"content":"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"created"</span> : <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[dennisit@elonsu elastic]$ curl -XPOST http://localhost:9200/index/fulltext/4?pretty -d  <span class="string">'&#123;"content":"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"4"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"created"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[dennisit@elonsu elastic]$ curl -XPOST http://localhost:9200/index/fulltext/5?pretty -d  <span class="string">'&#123;"content":"10月1日是中国国庆节"&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"5"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"created"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="查询Document"><a href="#查询Document" class="headerlink" title="查询Document"></a>查询Document</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ curl -XPOST http://localhost:9200/index/fulltext/_search?pretty  -d<span class="string">'</span></span><br><span class="line"><span class="string"> &#123;</span></span><br><span class="line"><span class="string">     "query" : &#123; "match" : &#123; "content" : "中国" &#125;&#125;,</span></span><br><span class="line"><span class="string">     "highlight" : &#123;</span></span><br><span class="line"><span class="string">         "pre_tags" : ["&lt;tag1&gt;", "&lt;tag2&gt;"],</span></span><br><span class="line"><span class="string">         "post_tags" : ["&lt;/tag1&gt;", "&lt;/tag2&gt;"],</span></span><br><span class="line"><span class="string">         "fields" : &#123;</span></span><br><span class="line"><span class="string">             "content" : &#123;&#125;</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string">'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 6,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 5,</span><br><span class="line">    <span class="string">"successful"</span> : 5,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.27233246,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"5"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.27233246,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : <span class="string">"10月1日是中国国庆节"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : [</span><br><span class="line">            <span class="string">"10月1日是&lt;tag1&gt;中国&lt;/tag1&gt;国庆节"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"4"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.27179778,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : [</span><br><span class="line">            <span class="string">"&lt;tag1&gt;中国&lt;/tag1&gt;驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.27179778,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : [</span><br><span class="line">            <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘&lt;tag1&gt;中国&lt;/tag1&gt;渔船"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[dennisit@elonsu elastic]$</span><br></pre></td></tr></table></figure><h5 id="删除Document"><a href="#删除Document" class="headerlink" title="删除Document"></a>删除Document</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[dennisit@elonsu elastic]$ curl -XDELETE  http://localhost:9200/index/fulltext/3?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 2,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"deleted"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[dennisit@elonsu elastic]$ curl -XDELETE  http://localhost:9200/index/fulltext/5?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"5"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 2,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"deleted"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[dennisit@elonsu elastic]$ curl -XDELETE  http://localhost:9200/index/fulltext/9?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"9"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"result"</span> : <span class="string">"not_found"</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 2,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[dennisit@elonsu elastic]$ curl -XPOST http://localhost:9200/index/fulltext/_search?pretty  -d<span class="string">'</span></span><br><span class="line"><span class="string"> &#123;</span></span><br><span class="line"><span class="string">     "query" : &#123; "match" : &#123; "content" : "中国" &#125;&#125;,</span></span><br><span class="line"><span class="string">     "highlight" : &#123;</span></span><br><span class="line"><span class="string">         "pre_tags" : ["&lt;tag1&gt;", "&lt;tag2&gt;"],</span></span><br><span class="line"><span class="string">         "post_tags" : ["&lt;/tag1&gt;", "&lt;/tag2&gt;"],</span></span><br><span class="line"><span class="string">         "fields" : &#123;</span></span><br><span class="line"><span class="string">             "content" : &#123;&#125;</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string">'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 7,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 5,</span><br><span class="line">    <span class="string">"successful"</span> : 5,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.27179778,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"4"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 0.27179778,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"highlight"</span> : &#123;</span><br><span class="line">          <span class="string">"content"</span> : [</span><br><span class="line">            <span class="string">"&lt;tag1&gt;中国&lt;/tag1&gt;驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="修改索引查询最大窗口"><a href="#修改索引查询最大窗口" class="headerlink" title="修改索引查询最大窗口"></a>修改索引查询最大窗口</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~ ]$ curl http://localhost:9200/idx_index/_settings/?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"idx_index"</span> : &#123;</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1529829607133"</span>,</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"5"</span>,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"XtX1yMORQWqH2jihDqLomw"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6020499"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"idx_index"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@localhost ~ ]$ curl -H <span class="string">"Content-Type: application/json"</span> -XPUT http://localhost:9200/idx_index/_settings\?pretty -d <span class="string">'&#123; "index" : &#123; "max_result_window" : 100000000&#125;&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">[root@localhost ~ ]$  curl http://localhost:9200/idx_index/_settings/\?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"idx_index"</span> : &#123;</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"5"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"idx_index"</span>,</span><br><span class="line">        <span class="string">"max_result_window"</span> : <span class="string">"100000000"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1529829607133"</span>,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"XtX1yMORQWqH2jihDqLomw"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6020499"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@elonsu cloud]<span class="comment"># wget http://nginx.org/download/nginx-1.12.1.tar.gz</span></span><br><span class="line">[root@elonsu cloud]<span class="comment"># tar -zxvf nginx-1.12.1.tar.gz </span></span><br><span class="line">[root@elonsu cloud]<span class="comment"># cd nginx-1.12.1</span></span><br><span class="line">[root@elonsu nginx-1.12.1]<span class="comment"># ./configure \</span></span><br><span class="line">  --prefix=/usr/<span class="built_in">local</span>/nginx  \</span><br><span class="line">  --sbin-path=/usr/<span class="built_in">local</span>/nginx/sbin/nginx \</span><br><span class="line">  --conf-path=/usr/<span class="built_in">local</span>/nginx/conf/nginx.conf \</span><br><span class="line">  --http-log-path=/usr/<span class="built_in">local</span>/nginx/logs/access.log \</span><br><span class="line">  --error-log-path=/usr/<span class="built_in">local</span>/nginx/logs/error.log \</span><br><span class="line">  --pid-path=/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid \</span><br><span class="line">  --lock-path=/usr/<span class="built_in">local</span>/nginx/lock/nginx.lock \</span><br><span class="line">  --http-client-body-temp-path=/usr/<span class="built_in">local</span>/nginx/client_body_temp \</span><br><span class="line">  --http-proxy-temp-path=/usr/<span class="built_in">local</span>/nginx/proxy_temp \</span><br><span class="line">  --http-fastcgi-temp-path=/usr/<span class="built_in">local</span>/nginx/fastcgi-temp \</span><br><span class="line">  --http-uwsgi-temp-path=/usr/<span class="built_in">local</span>/nginx/uwsgi-temp \</span><br><span class="line">  --http-scgi-temp-path=/usr/<span class="built_in">local</span>/nginx/scgi-temp \</span><br><span class="line">  --user=root \</span><br><span class="line">  --group=root \</span><br><span class="line">  --with-http_ssl_module \</span><br><span class="line">  --with-http_flv_module \</span><br><span class="line">  --with-http_mp4_module \</span><br><span class="line">  --with-http_gzip_static_module \</span><br><span class="line">  --with-http_stub_status_module</span><br><span class="line">[root@elonsu nginx-1.12.1]<span class="comment"># make </span></span><br><span class="line">[root@elonsu nginx-1.12.1]<span class="comment"># make install</span></span><br></pre></td></tr></table></figure><h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><p>上面我们安装了nginx在目录<code>/usr/local/nginx/</code>,接下来配置upstream</p><h4 id="Nginx主配置文件修改"><a href="#Nginx主配置文件修改" class="headerlink" title="Nginx主配置文件修改"></a>Nginx主配置文件修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@elonsu conf]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/conf</span><br><span class="line">[root@elonsu conf]<span class="comment"># cat nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;  </span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    gzip  on;</span><br><span class="line">    </span><br><span class="line">    server_names_hash_bucket_size 64;</span><br><span class="line">    server_names_hash_max_size 512;</span><br><span class="line">    </span><br><span class="line">    include domains/*;    </span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        </span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该配置文件我们做了最简单的配置, 在nginx默认的配置上做了如下修改:</p><ul><li>打开log_format</li><li>增加server_names_hash相关配置</li><li>使用<code>include domains/*;</code> 加载我们自定义upstream配置</li></ul><h4 id="自定义Upstream配置"><a href="#自定义Upstream配置" class="headerlink" title="自定义Upstream配置"></a>自定义Upstream配置</h4><p>这里我们对elastic进行代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@elonsu domains]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/conf/domains</span><br><span class="line">[root@elonsu domains]<span class="comment"># cat elastic.icloud.com.conf </span></span><br><span class="line">upstream domain.elastic.local &#123;</span><br><span class="line">                server 127.0.0.1:9200  weight=10 max_fails=2 fail_timeout=300s;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">                listen                   80;</span><br><span class="line">                server_name              elastic.icloud.com;</span><br><span class="line">                root                     /<span class="built_in">export</span>/cloud/elastic/;</span><br><span class="line">                access_log               /<span class="built_in">export</span>/cloud/elastic/logs/elastic.icloud.com_access.log main;</span><br><span class="line">                error_log                /<span class="built_in">export</span>/cloud/elastic/logs/elastic.icloud.com_error.log warn;</span><br><span class="line">                error_page              403 404 /40x.html;</span><br><span class="line"></span><br><span class="line">                location / &#123;</span><br><span class="line">                        index index.html index.htm;</span><br><span class="line">                        proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header;</span><br><span class="line">                        proxy_set_header        Host  <span class="variable">$host</span>;</span><br><span class="line">                        proxy_set_header        X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">                        proxy_set_header        X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">                        proxy_pass              http://domain.elastic.local;</span><br><span class="line">                        expires                 0d;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="配置完启动nginx"><a href="#配置完启动nginx" class="headerlink" title="配置完启动nginx"></a>配置完启动nginx</h4><p><a href="http://dennisit.github.io/2015/07/10/skill-tutorial-centos-with-nginx-intall/">Nginx的启停脚本</a></p><p>启动Nginx并访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elonsu domains]<span class="comment"># service nginx restart</span></span><br><span class="line">Stopping Nginx:                                            [  OK  ]</span><br><span class="line">Starting Nginx:                                            [  OK  ]</span><br><span class="line">[root@elonsu domains]<span class="comment"># curl -XGET  http://127.0.0.1:9200/index/fulltext/4\?pretty</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"4"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"content"</span> : <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="本机使用外网域名访问"><a href="#本机使用外网域名访问" class="headerlink" title="本机使用外网域名访问"></a>本机使用外网域名访问</h4><p>上面服务器上Elastic的反向代理已经配置好, 本机使用域名访问(因为域名非公网域名,所以本机需要配置host)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~ ]$ curl  http://elastic.icloud.com/index/fulltext/4\?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"index"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"fulltext"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"4"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"content"</span> : <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Elastic下载安装&quot;&gt;&lt;a href=&quot;#Elastic下载安装&quot; class=&quot;headerlink&quot; title=&quot;Elastic下载安装&quot;&gt;&lt;/a&gt;Elastic下载安装&lt;/h3&gt;&lt;h4 id=&quot;下载Elastic&quot;&gt;&lt;a href=&quot;#下载Elastic&quot; class=&quot;headerlink&quot; title=&quot;下载Elastic&quot;&gt;&lt;/a&gt;下载Elastic&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu cloud]&lt;span class=&quot;comment&quot;&gt;# wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.0.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu cloud]&lt;span class=&quot;comment&quot;&gt;# tar -zxvf elasticsearch-5.6.0.tar.gz &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu cloud]&lt;span class=&quot;comment&quot;&gt;# mv elasticsearch-5.6.0 elastic&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;创建用户&quot;&gt;&lt;a href=&quot;#创建用户&quot; class=&quot;headerlink&quot; title=&quot;创建用户&quot;&gt;&lt;/a&gt;创建用户&lt;/h4&gt;&lt;p&gt;Elastic默认不支持root用户启动, 这里创建用户dennisit&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu cloud]&lt;span class=&quot;comment&quot;&gt;# pwd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt;/cloud&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu ~]&lt;span class=&quot;comment&quot;&gt;# adduser dennisit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu ~]&lt;span class=&quot;comment&quot;&gt;# passwd dennisit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Changing password &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; user dennisit.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;New password: &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Retype new password: &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;passwd: all authentication tokens updated successfully.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu cloud]&lt;span class=&quot;comment&quot;&gt;# chown dennisit:dennisit elastic -R&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@elonsu cloud]&lt;span class=&quot;comment&quot;&gt;# su dennisit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[dennisit@elonsu cloud]$ &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; elastic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[dennisit@elonsu elastic]$ bin/elasticsearch &amp;amp;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Elastic" scheme="http://dennisit.github.io/tags/Elastic/"/>
    
      <category term="CentOs" scheme="http://dennisit.github.io/tags/CentOs/"/>
    
  </entry>
  
  <entry>
    <title>持续集成 - 发布系统</title>
    <link href="http://dennisit.github.io/2017/09/22/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90-%E5%8F%91%E5%B8%83%E7%B3%BB%E7%BB%9F/"/>
    <id>http://dennisit.github.io/2017/09/22/应用实践/持续集成-发布系统/</id>
    <published>2017-09-22T07:23:15.000Z</published>
    <updated>2019-02-23T09:47:26.545Z</updated>
    
    <content type="html"><![CDATA[<p>发布系统在技术团队中有着重要作用, 承担我们每天的服务部署工作, 企业发布系统根据企业技术能力来决定, 小公司不像那些公司一样,有充足的人力去开发一套自己的发布系统. 所以尽可能的去寻找一些适合企业应用的部署系统, 以提高人力成本. </p><p>这里推荐两款开源的发布系统:</p><ul><li>jekins: <a href="https://jenkins.io/" target="_blank" rel="noopener">https://jenkins.io/</a> (Java语言开发)[普遍]</li><li>walle: <a href="http://www.walle-web.io/" target="_blank" rel="noopener">http://www.walle-web.io/</a> (PHP语言开发)[小众]</li></ul><p>jekins可能大家都很熟悉,也有好多文章, walle是国人写的一个轻量的发布系统, 只所以推荐它 是因为相对其它开源的发布系统来说, 其UI界面至少看着比较舒服, 基本功能也都有. 支持国产开源.</p><h3 id="Walle安装部署"><a href="#Walle安装部署" class="headerlink" title="Walle安装部署"></a>Walle安装部署</h3><p>Walle是基于PHP写的, 所以安装前需要安装PHP环境.</p><a id="more"></a><h4 id="PHP环境安装"><a href="#PHP环境安装" class="headerlink" title="PHP环境安装"></a>PHP环境安装</h4><p>这里选用php最新稳定版7.1.10</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># wget http://cn2.php.net/distributions/php-7.1.10.tar.gz</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tar -zxvf php-7.1.10.tar.gz </span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd php-7.1.10/</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment"># ./configure --help</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment"># yum -y install libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel mysql pcre-devel</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment"># ./configure --prefix=/usr/local/php \</span></span><br><span class="line"> --with-curl \</span><br><span class="line"> --with-freetype-dir \</span><br><span class="line"> --with-gd \</span><br><span class="line"> --with-gettext \</span><br><span class="line"> --with-iconv-dir \</span><br><span class="line"> --with-kerberos \</span><br><span class="line"> --with-libdir=lib64 \</span><br><span class="line"> --with-libxml-dir \</span><br><span class="line"> --with-mysqli \</span><br><span class="line"> --with-openssl \</span><br><span class="line"> --with-pcre-regex \</span><br><span class="line"> --with-pdo-mysql \</span><br><span class="line"> --with-pdo-sqlite \</span><br><span class="line"> --with-pear \</span><br><span class="line"> --with-png-dir \</span><br><span class="line"> --with-xmlrpc \</span><br><span class="line"> --with-zlib \</span><br><span class="line"> --<span class="built_in">enable</span>-fpm \</span><br><span class="line"> --<span class="built_in">enable</span>-bcmath \</span><br><span class="line"> --<span class="built_in">enable</span>-libxml \</span><br><span class="line"> --<span class="built_in">enable</span>-inline-optimization \</span><br><span class="line"> --<span class="built_in">enable</span>-gd-native-ttf \</span><br><span class="line"> --<span class="built_in">enable</span>-mbregex \</span><br><span class="line"> --<span class="built_in">enable</span>-mbstring \</span><br><span class="line"> --<span class="built_in">enable</span>-pcntl \</span><br><span class="line"> --<span class="built_in">enable</span>-shmop \</span><br><span class="line"> --<span class="built_in">enable</span>-soap \</span><br><span class="line"> --<span class="built_in">enable</span>-sockets \</span><br><span class="line"> --<span class="built_in">enable</span>-sysvsem \</span><br><span class="line"> --<span class="built_in">enable</span>-xml \</span><br><span class="line"> --<span class="built_in">enable</span>-zip</span><br><span class="line"> [root@localhost php-7.1.10]<span class="comment"># make &amp; make install</span></span><br><span class="line"> [root@localhost php-7.1.10]<span class="comment"># cp php.ini-development /usr/local/php/lib/php.ini</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment"># cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment">#  cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment"># cp -R ./sapi/fpm/php-fpm /etc/init.d/php-fpm</span></span><br><span class="line">[root@localhost php-7.1.10]<span class="comment"># /etc/init.d/php-fpm</span></span><br></pre></td></tr></table></figure><p>修改php进程归属用户(<code>/usr/local/php/etc/php-fpm.d/www.conf</code>), 修改user和group值.<br>笔者示例中值均为 <code>elonsu</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~]$ grep -C 3 <span class="string">'elonsu'</span> /usr/<span class="built_in">local</span>/php/etc/php-fpm.d/www.conf -n</span><br><span class="line">20-; Unix user/group of processes</span><br><span class="line">21-; Note: The user is mandatory. If the group is not <span class="built_in">set</span>, the default user<span class="string">'s group</span></span><br><span class="line"><span class="string">22-;       will be used.</span></span><br><span class="line"><span class="string">23:user = elonsu</span></span><br><span class="line"><span class="string">24:group = elonsu</span></span><br><span class="line"><span class="string">25-</span></span><br><span class="line"><span class="string">26-; The address on which to accept FastCGI requests.</span></span><br><span class="line"><span class="string">27-; Valid syntaxes are:</span></span><br></pre></td></tr></table></figure><h4 id="配置php环境变量"><a href="#配置php环境变量" class="headerlink" title="配置php环境变量"></a>配置php环境变量</h4><p>在<code>/etc/profile</code>文件末尾追加环境变量,如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这是PHP环境变量</span></span><br><span class="line">PHP_HOME=/usr/<span class="built_in">local</span>/php</span><br><span class="line"><span class="comment"># 设置Meven环境变量</span></span><br><span class="line">M2_HOME=/usr/<span class="built_in">local</span>/apache-maven-3.5.0</span><br><span class="line"><span class="comment"># 设置Java环境变量</span></span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_121</span><br><span class="line">JRE_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_121/jre</span><br><span class="line">CLASS_PATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin:<span class="variable">$M2_HOME</span>/bin:<span class="variable">$PHP_HOME</span>/bin:</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PHP_HOME M2_HOME JAVA_HOME JRE_HOME CLASS_PATH PATH</span><br></pre></td></tr></table></figure><p>使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">source</span> /etc/profile</span><br><span class="line">[elonsu@localhost ~]$ php -v</span><br><span class="line">PHP 7.1.10 (cli) (built: Oct 22 2017 14:23:52) ( NTS )</span><br><span class="line">Copyright (c) 1997-2017 The PHP Group</span><br><span class="line">Zend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies</span><br></pre></td></tr></table></figure><h4 id="下载Walle"><a href="#下载Walle" class="headerlink" title="下载Walle"></a>下载Walle</h4><p>Github: <a href="https://github.com/meolu/walle-web" target="_blank" rel="noopener">https://github.com/meolu/walle-web</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">elonsu@localhost cloud]$ <span class="built_in">pwd</span></span><br><span class="line">/<span class="built_in">export</span>/cloud</span><br><span class="line">elonsu@localhost cloud]$ git <span class="built_in">clone</span> git@github.com:meolu/walle-web.git</span><br><span class="line">elonsu@localhost cloud]$ <span class="built_in">cd</span> walle-web</span><br><span class="line">elonsu@localhost cloud]$ vi config/local.php</span><br></pre></td></tr></table></figure><p>设置数据库链接和用户注册邮件通知服务配置</p><h4 id="安装Walle"><a href="#安装Walle" class="headerlink" title="安装Walle"></a>安装Walle</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost walle-web]$ curl -sS https://getcomposer.org/installer | php</span><br><span class="line">[elonsu@localhost walle-web]$ php composer.phar require guzzlehttp/promises</span><br><span class="line">[elonsu@localhost walle-web]$ php composer.phar require guzzlehttp/guzzle</span><br><span class="line">[elonsu@localhost walle-web]$ php composer.phar install --prefer-dist --no-dev --optimize-autoloader -vvvv</span><br><span class="line">[elonsu@localhost walle-web]$ ./yii walle/setup</span><br></pre></td></tr></table></figure><h4 id="Nginx反向代理"><a href="#Nginx反向代理" class="headerlink" title="Nginx反向代理"></a>Nginx反向代理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost walle-web]$ cat /usr/<span class="built_in">local</span>/nginx/conf/domains/walle.wuyu.com </span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  walle.wuyu.com;</span><br><span class="line">    root /<span class="built_in">export</span>/cloud/walle-web/web;</span><br><span class="line">    index index.php;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 建议放内网</span></span><br><span class="line">    <span class="comment"># allow 192.168.0.0/24;</span></span><br><span class="line">    <span class="comment"># deny all;</span></span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        try_files <span class="variable">$uri</span> = 404;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="访问登录"><a href="#访问登录" class="headerlink" title="访问登录"></a>访问登录</h4><p>访问: <a href="http://walle.wuyu.com/" target="_blank" rel="noopener">http://walle.wuyu.com/</a><br>首次登录默认管理员用户<code>admin/admin</code>.</p><h3 id="配置项目"><a href="#配置项目" class="headerlink" title="配置项目"></a>配置项目</h3><p>发布系统部署完后登录后效果图如下(苏若年账户为笔者自己创建): </p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15086776311511.jpg" alt></p><h4 id="添加项目配置"><a href="#添加项目配置" class="headerlink" title="添加项目配置"></a>添加项目配置</h4><p>【项目配置】- 【新建项目】:</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15086780819284.jpg" alt></p><p>上图为个人技术博客发布项配置.</p><h4 id="检测项目配置"><a href="#检测项目配置" class="headerlink" title="检测项目配置"></a>检测项目配置</h4><p>【项目配置】-【配置列表】-【检测】, 检测配置项是否配置成功.</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15086787405090.jpg" alt></p><h4 id="创建上线任务"><a href="#创建上线任务" class="headerlink" title="创建上线任务"></a>创建上线任务</h4><p>【我的上线单】-【创建上线单】-【选择上线的模板】, 填写如下项:</p><ul><li>上线单标题</li><li>选取分之</li><li>版本选取</li><li>全量/增量</li></ul><p>填写完之后会在【我的上线单】, 中出现刚才添加的上线单项目. 如下图:</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15086784831929.jpg" alt></p><h4 id="执行上线操作"><a href="#执行上线操作" class="headerlink" title="执行上线操作"></a>执行上线操作</h4><p>【我的上线单】-【选择上线单项】-【上线】-【部署】:</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15086785848544.jpg" alt></p><h3 id="远程GIT仓库授权配置"><a href="#远程GIT仓库授权配置" class="headerlink" title="远程GIT仓库授权配置"></a>远程GIT仓库授权配置</h3><h4 id="远程私有仓库ssh-授权"><a href="#远程私有仓库ssh-授权" class="headerlink" title="远程私有仓库ssh 授权"></a>远程私有仓库ssh 授权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~]<span class="comment">#  ssh-keygen -t rsa -C "dennisit@163.com"</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/elonsu/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /elonsu/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /elonsu/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">8b:8a:a0:b3:a5:a1:5f:96:8a:3c:5a:c1:e0:b3:f4:f3 dennisit@163.com</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+--[ RSA 2048]----+</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">|.                |</span></span><br><span class="line"><span class="string">|.o               |</span></span><br><span class="line"><span class="string">| +o     S        |</span></span><br><span class="line"><span class="string">|. +. . . .       |</span></span><br><span class="line"><span class="string">|o.oo+ . .        |</span></span><br><span class="line"><span class="string">|=O =o.           |</span></span><br><span class="line"><span class="string">|O== .E           |</span></span><br><span class="line"><span class="string">+-----------------+</span></span><br><span class="line"><span class="string">[elonsu@localhost ~]# ls </span></span><br><span class="line"><span class="string">[elonsu@localhost ~]$ ls ~/.ssh/</span></span><br><span class="line"><span class="string">id_rsa  id_rsa.pub</span></span><br></pre></td></tr></table></figure><p>这里的id_rsa为私钥, id_rsa_pub为公钥</p><h4 id="Git服务器配置SSH公钥"><a href="#Git服务器配置SSH公钥" class="headerlink" title="Git服务器配置SSH公钥"></a>Git服务器配置SSH公钥</h4><p>以开源中国为例, 【个人】-【设置】-【SSH公钥】</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15086793329945.jpg" alt></p><p>开源中国官方配置说明:<a href="http://git.mydoc.io/?t=154712" target="_blank" rel="noopener">http://git.mydoc.io/?t=154712</a></p><h4 id="检测配置"><a href="#检测配置" class="headerlink" title="检测配置"></a>检测配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~]$ ssh -T git@gitee.com</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Welcome to Gitee.com, -苏若年-!</span><br></pre></td></tr></table></figure><h3 id="部署目标机器授权"><a href="#部署目标机器授权" class="headerlink" title="部署目标机器授权"></a>部署目标机器授权</h3><p>我们以root用户身份, 将项目发布到<code>192.178.0.107</code>服务上时,需要给目标机器授权.如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.0.107</span><br></pre></td></tr></table></figure><p>此时会提示让输入目标服务器密码. 正确输入密码后,配置成功.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;发布系统在技术团队中有着重要作用, 承担我们每天的服务部署工作, 企业发布系统根据企业技术能力来决定, 小公司不像那些公司一样,有充足的人力去开发一套自己的发布系统. 所以尽可能的去寻找一些适合企业应用的部署系统, 以提高人力成本. &lt;/p&gt;
&lt;p&gt;这里推荐两款开源的发布系统:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;jekins: &lt;a href=&quot;https://jenkins.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://jenkins.io/&lt;/a&gt; (Java语言开发)[普遍]&lt;/li&gt;
&lt;li&gt;walle: &lt;a href=&quot;http://www.walle-web.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.walle-web.io/&lt;/a&gt; (PHP语言开发)[小众]&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;jekins可能大家都很熟悉,也有好多文章, walle是国人写的一个轻量的发布系统, 只所以推荐它 是因为相对其它开源的发布系统来说, 其UI界面至少看着比较舒服, 基本功能也都有. 支持国产开源.&lt;/p&gt;
&lt;h3 id=&quot;Walle安装部署&quot;&gt;&lt;a href=&quot;#Walle安装部署&quot; class=&quot;headerlink&quot; title=&quot;Walle安装部署&quot;&gt;&lt;/a&gt;Walle安装部署&lt;/h3&gt;&lt;p&gt;Walle是基于PHP写的, 所以安装前需要安装PHP环境.&lt;/p&gt;
    
    </summary>
    
      <category term="运维部署" scheme="http://dennisit.github.io/categories/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="发布系统" scheme="http://dennisit.github.io/tags/%E5%8F%91%E5%B8%83%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>Elastic实战Rest统计</title>
    <link href="http://dennisit.github.io/2017/09/03/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Elastic/Elastic%E5%AE%9E%E6%88%98Rest%E7%BB%9F%E8%AE%A1/"/>
    <id>http://dennisit.github.io/2017/09/03/组件框架/Elastic/Elastic实战Rest统计/</id>
    <published>2017-09-03T08:23:15.000Z</published>
    <updated>2018-12-12T00:12:23.650Z</updated>
    
    <content type="html"><![CDATA[<h3 id="索引信息"><a href="#索引信息" class="headerlink" title="索引信息"></a>索引信息</h3><h3 id="查看索引信息"><a href="#查看索引信息" class="headerlink" title="查看索引信息"></a>查看索引信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XGET <span class="string">"http://127.0.0.1:9200/db_test?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"db_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123;</span><br><span class="line">      <span class="string">"tb_opus"</span> : &#123;</span><br><span class="line">        <span class="string">"properties"</span> : &#123;</span><br><span class="line">          <span class="string">"aliasName"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"appId"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"author"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"createTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"date"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"enabled"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"favoriteTotal"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"fingerprint"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"id"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"images"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"introduce"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"boost"</span> : 10.0,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"issueTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"opusName"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"score"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"double"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"sort"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tags"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"type"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"updateTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"date"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"userId"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"uuid"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"viewTotal"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1514353694378"</span>,</span><br><span class="line">        <span class="string">"analysis"</span> : &#123;</span><br><span class="line">          <span class="string">"filter"</span> : &#123;</span><br><span class="line">            <span class="string">"mix_pinyin"</span> : &#123;</span><br><span class="line">              <span class="string">"lowercase"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"padding_char"</span> : <span class="string">" "</span>,</span><br><span class="line">              <span class="string">"first_letter"</span> : <span class="string">"prefix"</span>,</span><br><span class="line">              <span class="string">"keep_original"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"remove_duplicated_term"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"pinyin"</span>,</span><br><span class="line">              <span class="string">"keep_full_pinyin"</span> : <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"analyzer"</span> : &#123;</span><br><span class="line">            <span class="string">"ik_pinyin_analyzer"</span> : &#123;</span><br><span class="line">              <span class="string">"filter"</span> : [</span><br><span class="line">                <span class="string">"mix_pinyin"</span>,</span><br><span class="line">                <span class="string">"word_delimiter"</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"custom"</span>,</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"default"</span> : &#123;</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"seg7yr55R121l8tRW3r7uA"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="统计应用"><a href="#统计应用" class="headerlink" title="统计应用"></a>统计应用</h3><h4 id="分类统计查询"><a href="#分类统计查询" class="headerlink" title="分类统计查询"></a>分类统计查询</h4><p>查询关键词为<code></code>的文档, 并按照<code>type</code>分组(group by)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$  curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">      "introduce": "青春"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "type_count": &#123;</span></span><br><span class="line"><span class="string">      "terms": &#123;</span></span><br><span class="line"><span class="string">        "field": "type"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 1,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 84,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"type_count"</span> : &#123;</span><br><span class="line">      <span class="string">"doc_count_error_upper_bound"</span> : 0,</span><br><span class="line">      <span class="string">"sum_other_doc_count"</span> : 0,</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 30,</span><br><span class="line">          <span class="string">"doc_count"</span> : 76</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 10,</span><br><span class="line">          <span class="string">"doc_count"</span> : 4</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 20,</span><br><span class="line">          <span class="string">"doc_count"</span> : 4</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="基础函数统计查询"><a href="#基础函数统计查询" class="headerlink" title="基础函数统计查询"></a>基础函数统计查询</h4><p>查询评分最高评分和最低评分的文档(max|min|avg|sum)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "max_score": &#123;</span></span><br><span class="line"><span class="string">      "max": &#123;</span></span><br><span class="line"><span class="string">        "field": "score"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "min_score": &#123;</span></span><br><span class="line"><span class="string">      "min": &#123;</span></span><br><span class="line"><span class="string">        "field": "score"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 650,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"max_score"</span> : &#123;</span><br><span class="line">      <span class="string">"value"</span> : 99.0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"min_score"</span> : &#123;</span><br><span class="line">      <span class="string">"value"</span> : 0.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="统计信息查询"><a href="#统计信息查询" class="headerlink" title="统计信息查询"></a>统计信息查询</h4><p>统计评分Top5的文档数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$  curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match_all": &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "score": &#123;</span></span><br><span class="line"><span class="string">      "terms": &#123;</span></span><br><span class="line"><span class="string">        "field": "score",</span></span><br><span class="line"><span class="string">        "size": 5</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 651,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"score"</span> : &#123;</span><br><span class="line">      <span class="string">"doc_count_error_upper_bound"</span> : 0,</span><br><span class="line">      <span class="string">"sum_other_doc_count"</span> : 590,</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 38.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 13</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 85.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 13</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 15.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 12</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 30.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 11</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 92.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 11</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照给定维度数据进行统计</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "terms": &#123;</span></span><br><span class="line"><span class="string">      "type": ["10", "20"]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "significant_type": &#123;</span></span><br><span class="line"><span class="string">      "significant_terms": &#123;</span></span><br><span class="line"><span class="string">        "field": "type"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 13,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 141,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"significant_type"</span> : &#123;</span><br><span class="line">      <span class="string">"doc_count"</span> : 141,</span><br><span class="line">      <span class="string">"bg_count"</span> : 675,</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 20,</span><br><span class="line">          <span class="string">"doc_count"</span> : 91,</span><br><span class="line">          <span class="string">"score"</span> : 2.4442432473215634,</span><br><span class="line">          <span class="string">"bg_count"</span> : 91</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 10,</span><br><span class="line">          <span class="string">"doc_count"</span> : 50,</span><br><span class="line">          <span class="string">"score"</span> : 1.3429907952316285,</span><br><span class="line">          <span class="string">"bg_count"</span> : 50</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询评分的基本统计信息(count|min|max|avg|sum)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "score_stats": &#123;</span></span><br><span class="line"><span class="string">        "stats": &#123;</span></span><br><span class="line"><span class="string">            "field": "score"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 650,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"score_stats"</span> : &#123;</span><br><span class="line">      <span class="string">"count"</span> : 650,</span><br><span class="line">      <span class="string">"min"</span> : 0.0,</span><br><span class="line">      <span class="string">"max"</span> : 99.0,</span><br><span class="line">      <span class="string">"avg"</span> : 48.643076923076926,</span><br><span class="line">      <span class="string">"sum"</span> : 31618.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询评分的高级统计信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "score_stats": &#123;</span></span><br><span class="line"><span class="string">        "extended_stats": &#123;</span></span><br><span class="line"><span class="string">                "field": "score"</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 2,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 650,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"score_stats"</span> : &#123;</span><br><span class="line">      <span class="string">"count"</span> : 650,</span><br><span class="line">      <span class="string">"min"</span> : 0.0,</span><br><span class="line">      <span class="string">"max"</span> : 99.0,</span><br><span class="line">      <span class="string">"avg"</span> : 48.643076923076926,</span><br><span class="line">      <span class="string">"sum"</span> : 31618.0,</span><br><span class="line">      <span class="string">"sum_of_squares"</span> : 2069492.0,</span><br><span class="line">      <span class="string">"variance"</span> : 817.6849136094673,</span><br><span class="line">      <span class="string">"std_deviation"</span> : 28.59519039295712,</span><br><span class="line">      <span class="string">"std_deviation_bounds"</span> : &#123;</span><br><span class="line">        <span class="string">"upper"</span> : 105.83345770899118,</span><br><span class="line">        <span class="string">"lower"</span> : -8.547303862837317</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="分段区间统计查询"><a href="#分段区间统计查询" class="headerlink" title="分段区间统计查询"></a>分段区间统计查询</h4><p>分段统计指定区间内的评分和类型</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "score_range": &#123;</span></span><br><span class="line"><span class="string">      "range": &#123;</span></span><br><span class="line"><span class="string">        "field": "score",</span></span><br><span class="line"><span class="string">        "ranges": [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "to": 50</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "from": 50,</span></span><br><span class="line"><span class="string">            "to": 80</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "from": 80</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "type_range": &#123;</span></span><br><span class="line"><span class="string">      "range": &#123;</span></span><br><span class="line"><span class="string">        "field": "type",</span></span><br><span class="line"><span class="string">        "ranges": [</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "to": 30</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "from": 30,</span></span><br><span class="line"><span class="string">            "to": 50</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "from": 50,</span></span><br><span class="line"><span class="string">            "to": 80</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            "from": 80</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 2,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 651,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"type_range"</span> : &#123;</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"*-30.0"</span>,</span><br><span class="line">          <span class="string">"to"</span> : 30.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 141</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"30.0-50.0"</span>,</span><br><span class="line">          <span class="string">"from"</span> : 30.0,</span><br><span class="line">          <span class="string">"to"</span> : 50.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 509</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"50.0-80.0"</span>,</span><br><span class="line">          <span class="string">"from"</span> : 50.0,</span><br><span class="line">          <span class="string">"to"</span> : 80.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"80.0-*"</span>,</span><br><span class="line">          <span class="string">"from"</span> : 80.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 0</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"score_range"</span> : &#123;</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"*-50.0"</span>,</span><br><span class="line">          <span class="string">"to"</span> : 50.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 338</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"50.0-80.0"</span>,</span><br><span class="line">          <span class="string">"from"</span> : 50.0,</span><br><span class="line">          <span class="string">"to"</span> : 80.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 192</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : <span class="string">"80.0-*"</span>,</span><br><span class="line">          <span class="string">"from"</span> : 80.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 120</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>直方图统计, 按照指定维度和步长值统计</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match_all": &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "score": &#123;</span></span><br><span class="line"><span class="string">      "histogram": &#123;</span></span><br><span class="line"><span class="string">        "field": "score",</span></span><br><span class="line"><span class="string">        "interval": 10</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "type": &#123;</span></span><br><span class="line"><span class="string">      "histogram": &#123;</span></span><br><span class="line"><span class="string">        "field": "type",</span></span><br><span class="line"><span class="string">        "interval": 5</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 5,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 651,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"score"</span> : &#123;</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 0.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 70</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 10.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 59</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 20.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 64</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 30.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 81</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 40.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 64</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 50.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 64</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 60.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 60</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 70.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 68</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 80.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 55</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 90.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 65</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"type"</span> : &#123;</span><br><span class="line">      <span class="string">"buckets"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 10.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 50</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 15.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 20.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 91</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 25.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"key"</span> : 30.0,</span><br><span class="line">          <span class="string">"doc_count"</span> : 509</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤统计score=90,type=20的文档</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match_all": &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "score80": &#123;</span></span><br><span class="line"><span class="string">      "filter": &#123;</span></span><br><span class="line"><span class="string">        "term": &#123;"score": 80&#125;</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "type20": &#123;</span></span><br><span class="line"><span class="string">      "filter": &#123;</span></span><br><span class="line"><span class="string">        "term": &#123;"type": 20&#125;</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 5,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 651,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"type20"</span> : &#123;</span><br><span class="line">      <span class="string">"doc_count"</span> : 91</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"score80"</span> : &#123;</span><br><span class="line">      <span class="string">"doc_count"</span> : 3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>矩阵统计</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match_all": &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "size": 0,</span></span><br><span class="line"><span class="string">  "aggs": &#123;</span></span><br><span class="line"><span class="string">    "matrixstats": &#123;</span></span><br><span class="line"><span class="string">      "matrix_stats": &#123;</span></span><br><span class="line"><span class="string">        "fields": ["score", "type"]</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 2,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 651,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="string">"matrixstats"</span> : &#123;</span><br><span class="line">      <span class="string">"doc_count"</span> : 650,</span><br><span class="line">      <span class="string">"fields"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"score"</span>,</span><br><span class="line">          <span class="string">"count"</span> : 650,</span><br><span class="line">          <span class="string">"mean"</span> : 48.6430769230769,</span><br><span class="line">          <span class="string">"variance"</span> : 818.9448287305912,</span><br><span class="line">          <span class="string">"skewness"</span> : 0.06430023639098066,</span><br><span class="line">          <span class="string">"kurtosis"</span> : 1.827011562407035,</span><br><span class="line">          <span class="string">"covariance"</span> : &#123;</span><br><span class="line">            <span class="string">"score"</span> : 818.9448287305912,</span><br><span class="line">            <span class="string">"type"</span> : -6.150574848879931</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"correlation"</span> : &#123;</span><br><span class="line">            <span class="string">"score"</span> : 1.0,</span><br><span class="line">            <span class="string">"type"</span> : -0.03572662420282527</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"type"</span>,</span><br><span class="line">          <span class="string">"count"</span> : 650,</span><br><span class="line">          <span class="string">"mean"</span> : 27.061538461538458,</span><br><span class="line">          <span class="string">"variance"</span> : 36.19035202086057,</span><br><span class="line">          <span class="string">"skewness"</span> : -1.894319693928367,</span><br><span class="line">          <span class="string">"kurtosis"</span> : 5.30339872762004,</span><br><span class="line">          <span class="string">"covariance"</span> : &#123;</span><br><span class="line">            <span class="string">"score"</span> : -6.150574848879931,</span><br><span class="line">            <span class="string">"type"</span> : 36.19035202086057</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"correlation"</span> : &#123;</span><br><span class="line">            <span class="string">"score"</span> : -0.03572662420282527,</span><br><span class="line">            <span class="string">"type"</span> : 1.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul><li><a href="http://blog.csdn.net/napoay/article/details/56279658(分类统计)" target="_blank" rel="noopener">http://blog.csdn.net/napoay/article/details/56279658(分类统计)</a></li><li><a href="http://blog.csdn.net/napoay/article/details/53910646(高亮)" target="_blank" rel="noopener">http://blog.csdn.net/napoay/article/details/53910646(高亮)</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;索引信息&quot;&gt;&lt;a href=&quot;#索引信息&quot; class=&quot;headerlink&quot; title=&quot;索引信息&quot;&gt;&lt;/a&gt;索引信息&lt;/h3&gt;&lt;h3 id=&quot;查看索引信息&quot;&gt;&lt;a href=&quot;#查看索引信息&quot; class=&quot;headerlink&quot; title=&quot;查看索引信息&quot;&gt;&lt;/a&gt;查看索引信息&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost elasticsearch-6.0.0 ]$ curl -XGET &lt;span class=&quot;string&quot;&gt;&quot;http://127.0.0.1:9200/db_test?pretty=true&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;db_test&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;aliases&quot;&lt;/span&gt; : &amp;#123; &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;mappings&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;tb_opus&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;properties&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;aliasName&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;appId&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;author&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;createTime&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;enabled&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;integer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;favoriteTotal&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;fingerprint&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;images&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;introduce&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;boost&quot;&lt;/span&gt; : 10.0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;issueTime&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;opusName&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;score&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;double&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;sort&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;tags&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;integer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;updateTime&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;userId&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;uuid&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;viewTotal&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;settings&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;index&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;number_of_shards&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;provided_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;db_test&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;creation_date&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;1514353694378&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;analysis&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;filter&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;mix_pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;lowercase&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;padding_char&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot; &quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;first_letter&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;prefix&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;keep_original&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;remove_duplicated_term&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;keep_full_pinyin&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;filter&quot;&lt;/span&gt; : [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;mix_pinyin&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;word_delimiter&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;custom&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;tokenizer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;default&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;tokenizer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;number_of_replicas&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;uuid&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;seg7yr55R121l8tRW3r7uA&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;created&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;6000099&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Elastic" scheme="http://dennisit.github.io/tags/Elastic/"/>
    
  </entry>
  
  <entry>
    <title>Elastic实战Rest查询</title>
    <link href="http://dennisit.github.io/2017/09/01/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Elastic/Elastic%E5%AE%9E%E6%88%98Rest%E6%9F%A5%E8%AF%A2/"/>
    <id>http://dennisit.github.io/2017/09/01/组件框架/Elastic/Elastic实战Rest查询/</id>
    <published>2017-09-01T08:23:15.000Z</published>
    <updated>2018-12-12T00:12:20.707Z</updated>
    
    <content type="html"><![CDATA[<h3 id="索引信息"><a href="#索引信息" class="headerlink" title="索引信息"></a>索引信息</h3><h3 id="查看索引信息"><a href="#查看索引信息" class="headerlink" title="查看索引信息"></a>查看索引信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XGET <span class="string">"http://127.0.0.1:9200/db_test?pretty=true"</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"db_test"</span> : &#123;</span><br><span class="line">    <span class="string">"aliases"</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">"mappings"</span> : &#123;</span><br><span class="line">      <span class="string">"tb_opus"</span> : &#123;</span><br><span class="line">        <span class="string">"properties"</span> : &#123;</span><br><span class="line">          <span class="string">"aliasName"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"appId"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"author"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"createTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"date"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"enabled"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"favoriteTotal"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"fingerprint"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"id"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"images"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"introduce"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"boost"</span> : 10.0,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_smart"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"issueTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"opusName"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"score"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"double"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"sort"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"tags"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"fields"</span> : &#123;</span><br><span class="line">              <span class="string">"origin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"pinyin"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"text"</span>,</span><br><span class="line">                <span class="string">"term_vector"</span> : <span class="string">"with_positions_offsets"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_pinyin_analyzer"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"suggest"</span> : &#123;</span><br><span class="line">                <span class="string">"type"</span> : <span class="string">"completion"</span>,</span><br><span class="line">                <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span>,</span><br><span class="line">                <span class="string">"preserve_separators"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"preserve_position_increments"</span> : <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"max_input_length"</span> : 50</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"analyzer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"type"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"updateTime"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"date"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"userId"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"uuid"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"keyword"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"viewTotal"</span> : &#123;</span><br><span class="line">            <span class="string">"type"</span> : <span class="string">"long"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"number_of_shards"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"provided_name"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"creation_date"</span> : <span class="string">"1514353694378"</span>,</span><br><span class="line">        <span class="string">"analysis"</span> : &#123;</span><br><span class="line">          <span class="string">"filter"</span> : &#123;</span><br><span class="line">            <span class="string">"mix_pinyin"</span> : &#123;</span><br><span class="line">              <span class="string">"lowercase"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"padding_char"</span> : <span class="string">" "</span>,</span><br><span class="line">              <span class="string">"first_letter"</span> : <span class="string">"prefix"</span>,</span><br><span class="line">              <span class="string">"keep_original"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"remove_duplicated_term"</span> : <span class="string">"true"</span>,</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"pinyin"</span>,</span><br><span class="line">              <span class="string">"keep_full_pinyin"</span> : <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"analyzer"</span> : &#123;</span><br><span class="line">            <span class="string">"ik_pinyin_analyzer"</span> : &#123;</span><br><span class="line">              <span class="string">"filter"</span> : [</span><br><span class="line">                <span class="string">"mix_pinyin"</span>,</span><br><span class="line">                <span class="string">"word_delimiter"</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"type"</span> : <span class="string">"custom"</span>,</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"default"</span> : &#123;</span><br><span class="line">              <span class="string">"tokenizer"</span> : <span class="string">"ik_max_word"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"number_of_replicas"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"uuid"</span> : <span class="string">"seg7yr55R121l8tRW3r7uA"</span>,</span><br><span class="line">        <span class="string">"version"</span> : &#123;</span><br><span class="line">          <span class="string">"created"</span> : <span class="string">"6000099"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="搜索示例"><a href="#搜索示例" class="headerlink" title="搜索示例"></a>搜索示例</h3><p>多主键查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "ids": &#123;</span></span><br><span class="line"><span class="string">         "type": "tb_opus",</span></span><br><span class="line"><span class="string">         "values": ["1", "2", "3"]</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 7,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"max_score"</span> : 1.0,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"秒速5厘米"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"致我们终将逝去的青春"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"3"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"对不起，我爱你"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 3</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="term查询未分词的指定列"><a href="#term查询未分词的指定列" class="headerlink" title="term查询未分词的指定列"></a>term查询未分词的指定列</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">     "include": ["id", "author", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "term": &#123;</span></span><br><span class="line"><span class="string">       "author.origin": ["八月长安"]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 2,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 5,</span><br><span class="line">    <span class="string">"max_score"</span> : 4.801036,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"558"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.801036,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"你好,旧时光：陪你到青春最后"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 558</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"661"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.801036,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"最好的我们"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 661</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"662"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.801036,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"橘生淮南·暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 662</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"663"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.801036,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 663</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"664"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.801036,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"被偷走的那五年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 664</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="terms查询多个未分词的指定列"><a href="#terms查询多个未分词的指定列" class="headerlink" title="terms查询多个未分词的指定列"></a>terms查询多个未分词的指定列</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">     "include": ["id", "author", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "terms": &#123;</span></span><br><span class="line"><span class="string">       "author.origin": ["八月长安", "籽月"]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 8,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 8,</span><br><span class="line">    <span class="string">"max_score"</span> : 1.0,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"558"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"你好,旧时光：陪你到青春最后"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 558</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"661"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"最好的我们"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 661</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"662"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"橘生淮南·暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 662</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"663"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 663</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"664"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"被偷走的那五年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 664</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"668"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"夏有乔木：雅望天堂"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 668</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"669"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"初晨，是我故意忘记你"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 669</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"670"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"月光满满预见你"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 670</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前缀查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "author", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "prefix": &#123;</span></span><br><span class="line"><span class="string">       "author.origin": "九"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 8,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 13,</span><br><span class="line">    <span class="string">"max_score"</span> : 1.0,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"548"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九夜茴"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"曾少年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 548</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"549"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九夜茴"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"花开半夏"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 549</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"550"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九夜茴"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"匆匆那年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 550</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"551"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九夜茴,林特特,韩梅梅等"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"世界那么大，我想去看看"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 551</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"8"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九把刀"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"那些年我们一起追的女孩"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 8</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"765"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九鹭非香"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"百界歌"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 765</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"761"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九鹭非香"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"苍兰诀"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 761</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"762"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九鹭非香"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"司命"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 762</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"763"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九鹭非香"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"你在遥远星空中"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 763</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"764"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"九鹭非香"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"与凤行"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 764</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通配符查询(wildcard)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "author", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "wildcard": &#123;</span></span><br><span class="line"><span class="string">       "author.origin": "*月*"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 11,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 24,</span><br><span class="line">    <span class="string">"max_score"</span> : 1.0,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"558"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"你好,旧时光：陪你到青春最后"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 558</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"613"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"四月莲"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"玻璃青春"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 613</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"661"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"最好的我们"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 661</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"161"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"沧月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"忘川"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 161</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"610"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"菲雨月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"青春，终究被搁浅"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 610</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"662"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"橘生淮南·暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 662</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"663"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 663</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"664"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"被偷走的那五年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 664</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"668"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"夏有乔木：雅望天堂"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 668</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"669"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"初晨，是我故意忘记你"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 669</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正则查询(Regex)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$  curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "author", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "regexp": &#123;</span></span><br><span class="line"><span class="string">       "author.origin": "[沧|籽]月"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 5,</span><br><span class="line">    <span class="string">"max_score"</span> : 1.0,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"161"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"沧月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"忘川"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 161</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"668"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"夏有乔木：雅望天堂"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 668</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"669"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"初晨，是我故意忘记你"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 669</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"670"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"籽月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"月光满满预见你"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 670</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"452"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"沧月"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"羽·苍穹之烬"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 452</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>span查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "author", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "span_or": &#123;</span></span><br><span class="line"><span class="string">       "clauses":[</span></span><br><span class="line"><span class="string">                &#123;"span_term" : &#123;"author": "长安"&#125;&#125;,</span></span><br><span class="line"><span class="string">                &#123;"span_term" : &#123;"author": "笛"&#125;&#125;</span></span><br><span class="line"><span class="string">       ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 4,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 17,</span><br><span class="line">    <span class="string">"max_score"</span> : 9.539912,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"558"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"你好,旧时光：陪你到青春最后"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 558</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"661"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"最好的我们"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 661</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"662"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"橘生淮南·暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 662</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"663"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"暗恋"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 663</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"664"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"八月长安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"被偷走的那五年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 664</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"443"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"笛安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"西决"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 443</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"444"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"笛安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"姐姐的丛林"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 444</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"445"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"笛安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"一个女人的悲欢离合：东霓"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 445</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"446"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"笛安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"南方有令秧"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 446</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"447"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 9.539912,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"author"</span> : <span class="string">"笛安"</span>,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"妩媚航班"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 447</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匹配查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "tags"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">       "tags": &#123;</span></span><br><span class="line"><span class="string">                "query": "青春 爱情",</span></span><br><span class="line"><span class="string">                "operator": "AND"</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 6,</span><br><span class="line">    <span class="string">"max_score"</span> : 6.3930693,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 2,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"8"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 8,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"24"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 24,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"114"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 114,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"青春"</span>,</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"11"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.4129186,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 11,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"动画"</span>,</span><br><span class="line">            <span class="string">"青春"</span>,</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.142658,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 1,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"新海诚"</span>,</span><br><span class="line">            <span class="string">"动画"</span>,</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "tags"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match": &#123;</span></span><br><span class="line"><span class="string">       "tags": &#123;</span></span><br><span class="line"><span class="string">                "query": "青春 爱情",</span></span><br><span class="line"><span class="string">                "operator": "OR"</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 65,</span><br><span class="line">    <span class="string">"max_score"</span> : 6.3930693,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 2,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"8"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 8,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"24"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 24,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"114"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 114,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"青春"</span>,</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"11"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.4129186,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 11,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"动画"</span>,</span><br><span class="line">            <span class="string">"青春"</span>,</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.142658,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 1,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"新海诚"</span>,</span><br><span class="line">            <span class="string">"动画"</span>,</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"409"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 3.6897516,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 409,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"励志"</span>,</span><br><span class="line">            <span class="string">"成长"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"522"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 2.4852023,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 522,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"12"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 2.4852023,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 12,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"13"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 2.4852023,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"id"</span> : 13,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匹配查询多个field</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "tags", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "multi_match": &#123;</span></span><br><span class="line"><span class="string">         "fields": ["tags", "opusName"],</span></span><br><span class="line"><span class="string">       "query": "青春 爱情",</span></span><br><span class="line"><span class="string">       "operator": "AND"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 4,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 7,</span><br><span class="line">    <span class="string">"max_score"</span> : 6.3930693,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"致我们终将逝去的青春"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 2,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"8"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"那些年我们一起追的女孩"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 8,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"24"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"带我去远方"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 24,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"114"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 6.3930693,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"匆匆那年"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 114,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"青春"</span>,</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"11"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.4129186,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"言叶之庭"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 11,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"动画"</span>,</span><br><span class="line">            <span class="string">"青春"</span>,</span><br><span class="line">            <span class="string">"爱情"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"568"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.225136,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"致青春：我们曾经向往的爱情"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 568,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"纯爱"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.142658,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"秒速5厘米"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 1,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"新海诚"</span>,</span><br><span class="line">            <span class="string">"动画"</span>,</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"青春"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前缀匹配查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$  curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "opusName"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "match_phrase_prefix": &#123;</span></span><br><span class="line"><span class="string">         "opusName": "如果"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 6,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 5,</span><br><span class="line">    <span class="string">"max_score"</span> : 5.3439174,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"647"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.3439174,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"如果还有爱"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 647</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"626"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.80206,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"如果蜗牛有爱情"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 626</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"683"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.80206,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"如果巴黎不快乐"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 683</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"645"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 4.3599715,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"如果爱犯了错"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 645</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"547"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 2.3843746,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"如果你曾奋不顾身爱上一个人"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 547</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>query_string查询</p><p>查询关键词同时包含”蜗牛”和”爱情” 并且评分不小于80 分类号为30的文档</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "opusName", "tags", "score", "type"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "query_string": &#123;</span></span><br><span class="line"><span class="string">         "query": "蜗牛 爱情 -score:&#123;* TO 80&#125; type:30",</span></span><br><span class="line"><span class="string">         "fields":[</span></span><br><span class="line"><span class="string">            "opusName^5", "tags"</span></span><br><span class="line"><span class="string">         ],</span></span><br><span class="line"><span class="string">         "default_operator": "AND"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 3,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"max_score"</span> : 52.146034,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"626"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 52.146034,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 91,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"如果蜗牛有爱情"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 626,</span><br><span class="line">          <span class="string">"type"</span> : 30,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"都市"</span>,</span><br><span class="line">            <span class="string">"丁墨"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>区间查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "score"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "from": 0,</span></span><br><span class="line"><span class="string">  "size": 5,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "range": &#123;</span></span><br><span class="line"><span class="string">         "score": &#123;</span></span><br><span class="line"><span class="string">                "from" : 13,</span></span><br><span class="line"><span class="string">                "to": 15,</span></span><br><span class="line"><span class="string">                "include_lower": true,</span></span><br><span class="line"><span class="string">                "include_upper": false</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 2,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 11,</span><br><span class="line">    <span class="string">"max_score"</span> : 1.0,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"630"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 13,</span><br><span class="line">          <span class="string">"id"</span> : 630</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"647"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 14,</span><br><span class="line">          <span class="string">"id"</span> : 647</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"659"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 13,</span><br><span class="line">          <span class="string">"id"</span> : 659</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"529"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 14,</span><br><span class="line">          <span class="string">"id"</span> : 529</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"697"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 1.0,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 14,</span><br><span class="line">          <span class="string">"id"</span> : 697</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">bool查询</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "_source": &#123;</span></span><br><span class="line"><span class="string">                "include": ["id", "opusName", "tags", "score"]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "query": &#123;</span></span><br><span class="line"><span class="string">    "bool": &#123;</span></span><br><span class="line"><span class="string">         "must": [&#123;</span></span><br><span class="line"><span class="string">                "term" : &#123;"opusName":"爱情"&#125;</span></span><br><span class="line"><span class="string">         &#125;],</span></span><br><span class="line"><span class="string">         "must_not": [&#123;</span></span><br><span class="line"><span class="string">                "range": &#123;</span></span><br><span class="line"><span class="string">                   "score": &#123; "from": 80, "to": 100&#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">         &#125;],</span></span><br><span class="line"><span class="string">         "should": [&#123;</span></span><br><span class="line"><span class="string">              "term" : &#123;"tags":"青春"&#125;</span></span><br><span class="line"><span class="string">         &#125;]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 4,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 5,</span><br><span class="line">    <span class="string">"max_score"</span> : 5.156911,</span><br><span class="line">    <span class="string">"hits"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"468"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.156911,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 55,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"爱情的开关"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 468,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"爱情"</span>,</span><br><span class="line">            <span class="string">"匪我思存"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"504"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 5.156911,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 39,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"因为爱情"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 504,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"家庭"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"275"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 3.8527093,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 54,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"你的味蕾，我的爱情"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 275,</span><br><span class="line">          <span class="string">"tags"</span> : [ ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"568"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 3.5531719,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 77,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"致青春：我们曾经向往的爱情"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 568,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"纯爱"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"688"</span>,</span><br><span class="line">        <span class="string">"_score"</span> : 3.5531719,</span><br><span class="line">        <span class="string">"_source"</span> : &#123;</span><br><span class="line">          <span class="string">"score"</span> : 69,</span><br><span class="line">          <span class="string">"opusName"</span> : <span class="string">"蜗婚：距离爱情一平米"</span>,</span><br><span class="line">          <span class="string">"id"</span> : 688,</span><br><span class="line">          <span class="string">"tags"</span> : [</span><br><span class="line">            <span class="string">"婚恋"</span>,</span><br><span class="line">            <span class="string">"白槿湖"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="分页排序查询"><a href="#分页排序查询" class="headerlink" title="分页排序查询"></a>分页排序查询</h4><p>分页查询所有数据,结果以更新时间降序、主键编号升序排列</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment">#  curl -XPOST "http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123;</span><br><span class="line">    <span class="string">"match_all"</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"from"</span>: 0,</span><br><span class="line">  <span class="string">"size"</span>: 3,</span><br><span class="line">  <span class="string">"sort"</span>: &#123;</span><br><span class="line">    <span class="string">"updateTime"</span>: &#123;</span><br><span class="line">      <span class="string">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"id"</span>: &#123;</span><br><span class="line">      <span class="string">"order"</span>: <span class="string">"asc"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="关键词筛选查询"><a href="#关键词筛选查询" class="headerlink" title="关键词筛选查询"></a>关键词筛选查询</h4><p>查询与<code>宫崎骏</code>相关的作品</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@icloud-store ~]<span class="comment"># curl -XPOST "http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true" -H 'Content-Type: application/json' -d'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"query"</span>: &#123;</span><br><span class="line">    <span class="string">"query_string"</span>: &#123;</span><br><span class="line">      <span class="string">"query"</span>: <span class="string">"宫崎骏"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"highlight"</span>: &#123;</span><br><span class="line">    <span class="string">"pre_tags"</span>: [</span><br><span class="line">      <span class="string">"&lt;b&gt;"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"post_tags"</span>: [</span><br><span class="line">      <span class="string">"&lt;/b&gt;"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"fields"</span>: &#123;</span><br><span class="line">      <span class="string">"opusName"</span>: &#123;</span><br><span class="line">        <span class="string">"order"</span>: <span class="string">"score"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"tags"</span>: &#123;</span><br><span class="line">        <span class="string">"order"</span>: <span class="string">"score"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"introduce"</span>: &#123;</span><br><span class="line">        <span class="string">"order"</span>: <span class="string">"score"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"from"</span>: 0,</span><br><span class="line">  <span class="string">"size"</span>: 3</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><h4 id="搜索推荐查询"><a href="#搜索推荐查询" class="headerlink" title="搜索推荐查询"></a>搜索推荐查询</h4><p>根据关键词进行搜索推荐(前缀匹配)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost elasticsearch-6.0.0 ]$ curl -XPOST <span class="string">"http://127.0.0.1:9200/db_test/tb_opus/_search?pretty=true"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">         "_source": "opusName.suggest",</span></span><br><span class="line"><span class="string">    "suggest": &#123;</span></span><br><span class="line"><span class="string">        "product-suggest" : &#123;</span></span><br><span class="line"><span class="string">            "text" : "阿狸",</span></span><br><span class="line"><span class="string">            "completion" : &#123;</span></span><br><span class="line"><span class="string">                "field" : "opusName.suggest",</span></span><br><span class="line"><span class="string">                "fuzzy" : &#123;</span></span><br><span class="line"><span class="string">                    "fuzziness" : 2</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                "size": 5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 8,</span><br><span class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"_shards"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 1,</span><br><span class="line">    <span class="string">"successful"</span> : 1,</span><br><span class="line">    <span class="string">"skipped"</span> : 0,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"hits"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 0,</span><br><span class="line">    <span class="string">"max_score"</span> : 0.0,</span><br><span class="line">    <span class="string">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"suggest"</span> : &#123;</span><br><span class="line">    <span class="string">"product-suggest"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"text"</span> : <span class="string">"阿狸"</span>,</span><br><span class="line">        <span class="string">"offset"</span> : 0,</span><br><span class="line">        <span class="string">"length"</span> : 2,</span><br><span class="line">        <span class="string">"options"</span> : [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"阿狸·梦之城堡"</span>,</span><br><span class="line">            <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">            <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">            <span class="string">"_id"</span> : <span class="string">"346"</span>,</span><br><span class="line">            <span class="string">"_score"</span> : 5.0,</span><br><span class="line">            <span class="string">"_source"</span> : &#123; &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"text"</span> : <span class="string">"阿狸·永远站"</span>,</span><br><span class="line">            <span class="string">"_index"</span> : <span class="string">"db_test"</span>,</span><br><span class="line">            <span class="string">"_type"</span> : <span class="string">"tb_opus"</span>,</span><br><span class="line">            <span class="string">"_id"</span> : <span class="string">"353"</span>,</span><br><span class="line">            <span class="string">"_score"</span> : 5.0,</span><br><span class="line">            <span class="string">"_source"</span> : &#123; &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;索引信息&quot;&gt;&lt;a href=&quot;#索引信息&quot; class=&quot;headerlink&quot; title=&quot;索引信息&quot;&gt;&lt;/a&gt;索引信息&lt;/h3&gt;&lt;h3 id=&quot;查看索引信息&quot;&gt;&lt;a href=&quot;#查看索引信息&quot; class=&quot;headerlink&quot; title=&quot;查看索引信息&quot;&gt;&lt;/a&gt;查看索引信息&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost elasticsearch-6.0.0 ]$ curl -XGET &lt;span class=&quot;string&quot;&gt;&quot;http://127.0.0.1:9200/db_test?pretty=true&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;db_test&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;aliases&quot;&lt;/span&gt; : &amp;#123; &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;mappings&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;tb_opus&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;properties&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;aliasName&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;appId&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;author&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;createTime&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;enabled&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;integer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;favoriteTotal&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;fingerprint&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;images&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;introduce&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;boost&quot;&lt;/span&gt; : 10.0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_smart&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;issueTime&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;opusName&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;score&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;double&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;sort&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;tags&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;fields&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;origin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;term_vector&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;with_positions_offsets&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;suggest&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;completion&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_separators&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;preserve_position_increments&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;max_input_length&quot;&lt;/span&gt; : 50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;integer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;updateTime&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;userId&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;uuid&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;viewTotal&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;long&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;settings&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&quot;index&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;number_of_shards&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;provided_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;db_test&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;creation_date&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;1514353694378&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;analysis&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;filter&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;mix_pinyin&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;lowercase&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;padding_char&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot; &quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;first_letter&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;prefix&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;keep_original&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;remove_duplicated_term&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;pinyin&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;keep_full_pinyin&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;analyzer&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;ik_pinyin_analyzer&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;filter&quot;&lt;/span&gt; : [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;mix_pinyin&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;word_delimiter&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;custom&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;tokenizer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;default&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;string&quot;&gt;&quot;tokenizer&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;ik_max_word&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;number_of_replicas&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;uuid&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;seg7yr55R121l8tRW3r7uA&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;string&quot;&gt;&quot;created&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;6000099&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Elastic" scheme="http://dennisit.github.io/tags/Elastic/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot项目配置加密</title>
    <link href="http://dennisit.github.io/2017/07/15/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/SpringBoot%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E5%8A%A0%E5%AF%86/"/>
    <id>http://dennisit.github.io/2017/07/15/应用实践/SpringBoot项目配置加密/</id>
    <published>2017-07-15T06:02:43.000Z</published>
    <updated>2018-12-12T12:51:16.594Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>SpringBoot配置默认情况下是明文显示，安全性就比较低一些。jasypt该插件可以对配置文件进行加密, 提高配置的安全性</p></blockquote><h2 id="插件引入"><a href="#插件引入" class="headerlink" title="插件引入"></a>插件引入</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="组件说明"><a href="#组件说明" class="headerlink" title="组件说明"></a>组件说明</h2><p>使用组件原生API进行加解密，说明: 每次编码生成的编码结果串都会不一样, 均可以逆向解析.</p><a id="more"></a><h3 id="编解码示例"><a href="#编解码示例" class="headerlink" title="编解码示例"></a>编解码示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyt 秘钥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> source 原始数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 这里每次加密后的密文结果都不一样</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String keyt, String source)</span></span>&#123;</span><br><span class="line">    StandardPBEStringEncryptor encryptor = <span class="keyword">new</span> StandardPBEStringEncryptor();</span><br><span class="line">    encryptor.setPassword(keyt);</span><br><span class="line">    <span class="comment">// 默认算法为"PBEWithMD5AndDES"</span></span><br><span class="line">    encryptor.setAlgorithm(<span class="string">"PBEWithMD5AndDES"</span>);</span><br><span class="line">    <span class="keyword">return</span> encryptor.encrypt(source);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyt 秘钥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> source ji</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String keyt, String source)</span></span>&#123;</span><br><span class="line">    StandardPBEStringEncryptor encryptor = <span class="keyword">new</span> StandardPBEStringEncryptor();</span><br><span class="line">    encryptor.setPassword(keyt);</span><br><span class="line">    <span class="comment">// 默认算法为"PBEWithMD5AndDES"</span></span><br><span class="line">    encryptor.setAlgorithm(<span class="string">"PBEWithMD5AndDES"</span>);</span><br><span class="line">    <span class="keyword">return</span> encryptor.decrypt(source);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试编解码"><a href="#测试编解码" class="headerlink" title="测试编解码"></a>测试编解码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 秘钥</span></span><br><span class="line">    String kept = <span class="string">"123456A"</span>;</span><br><span class="line">    String source = <span class="string">"配置加解密"</span>;</span><br><span class="line">    String target = encrypt(kept, source);</span><br><span class="line">    System.out.println(<span class="string">"目标数据:"</span> + source + <span class="string">" \n加密结果:"</span> + target + <span class="string">" \n解密结果:"</span> + decrypt(kept, target));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目标数据:配置加解密 </span><br><span class="line">加密结果:<span class="number">5</span>eZ9Jf/<span class="number">7</span>A75hdoVMhuqcufSFKE/GiVyp </span><br><span class="line">解密结果:配置加解密</span><br></pre></td></tr></table></figure><h2 id="SpringBoot中应用"><a href="#SpringBoot中应用" class="headerlink" title="SpringBoot中应用"></a>SpringBoot中应用</h2><p>引入插件依赖, 然后在配置文件中做如下简易配置.</p><h3 id="密钥配置"><a href="#密钥配置" class="headerlink" title="密钥配置"></a>密钥配置</h3><p>配置秘钥,该步必须配置,该密钥用来对配置文件进行加解密, 对应上述示例中的kept(密钥参数) </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密密码</span></span><br><span class="line">jasypt.encryptor.password=1234ABCD</span><br></pre></td></tr></table></figure><h3 id="密文串配置"><a href="#密文串配置" class="headerlink" title="密文串配置"></a>密文串配置</h3><p>jasypt是通过识别配置文件中的<code>ENC()</code>标签来进行密文解密的,所以我们需要将受保护的配置做如下配置修改.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用ENC()标签配置密文串</span></span><br><span class="line">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/ENC(9JXD/P35350dt+R3479d6uZQ==)?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=<span class="literal">false</span></span><br><span class="line">spring.datasource.username=ENC(t+xp3NnBBFmcAePD459==)</span><br><span class="line">spring.datasource.password=ENC(A0nQxK1oPaNnBBBFmcgoTI+FFnNnBB+sdEQmUg=)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;SpringBoot配置默认情况下是明文显示，安全性就比较低一些。jasypt该插件可以对配置文件进行加密, 提高配置的安全性&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;插件引入&quot;&gt;&lt;a href=&quot;#插件引入&quot; class=&quot;headerlink&quot; title=&quot;插件引入&quot;&gt;&lt;/a&gt;插件引入&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.github.ulisesbocchio&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;jasypt-spring-boot-starter&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.1.0&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;组件说明&quot;&gt;&lt;a href=&quot;#组件说明&quot; class=&quot;headerlink&quot; title=&quot;组件说明&quot;&gt;&lt;/a&gt;组件说明&lt;/h2&gt;&lt;p&gt;使用组件原生API进行加解密，说明: 每次编码生成的编码结果串都会不一样, 均可以逆向解析.&lt;/p&gt;
    
    </summary>
    
      <category term="应用实践" scheme="http://dennisit.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/"/>
    
    
      <category term="Spring" scheme="http://dennisit.github.io/tags/Spring/"/>
    
      <category term="Jasypt" scheme="http://dennisit.github.io/tags/Jasypt/"/>
    
  </entry>
  
  <entry>
    <title>阿里云25端口封禁解决</title>
    <link href="http://dennisit.github.io/2017/07/15/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/%E9%98%BF%E9%87%8C%E4%BA%9125%E7%AB%AF%E5%8F%A3%E5%B0%81%E7%A6%81%E8%A7%A3%E5%86%B3/"/>
    <id>http://dennisit.github.io/2017/07/15/应用实践/阿里云25端口封禁解决/</id>
    <published>2017-07-15T06:02:43.000Z</published>
    <updated>2018-12-12T12:37:01.399Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用JavaMail发送邮件在阿里云服务器邮件发送失败</p></blockquote><h2 id="问题发现"><a href="#问题发现" class="headerlink" title="问题发现"></a>问题发现</h2><p><strong>问题产生</strong>: SpringBoot使用JavaMail发送邮件，本地测试是可以通过的，但项目部署到阿里云服务器后就不行了</p><p><strong>问题原因</strong>: 阿里云处于安全考虑，TCP<code>25</code>端口出方向默认被封禁.</p><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><p>对于阿里云线上服务器, 需要将邮箱的配置改为ssl加密465端口发送. <code>application.properties</code>配置文件中增加下面配置</p><h3 id="旧版配置"><a href="#旧版配置" class="headerlink" title="旧版配置"></a>旧版配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.mail.host=smtp.qq.com</span><br><span class="line">spring.mail.port=25</span><br><span class="line">spring.mail.username=邮箱账号</span><br><span class="line">spring.mail.password=邮箱密码</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="新版配置"><a href="#新版配置" class="headerlink" title="新版配置"></a>新版配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring.mail.host=smtp.qq.com</span><br><span class="line">spring.mail.username=邮箱账号</span><br><span class="line">spring.mail.password=邮箱密码</span><br><span class="line">spring.mail.default-encoding=UTF-8</span><br><span class="line">spring.mail.properties.mail.smtp.auth=<span class="literal">true</span></span><br><span class="line">spring.mail.properties.mail.smtp.timeout=25000</span><br><span class="line">spring.mail.properties.mail.smtp.ssl.enable=<span class="literal">true</span></span><br><span class="line">spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory</span><br><span class="line">spring.mail.properties.mail.smtp.socketFactory.port=465</span><br><span class="line">spring.mail.properties.mail.smtp.port=465</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用JavaMail发送邮件在阿里云服务器邮件发送失败&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;问题发现&quot;&gt;&lt;a href=&quot;#问题发现&quot; class=&quot;headerlink&quot; title=&quot;问题发现&quot;&gt;&lt;/a&gt;问题发现&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;问题产生&lt;/strong&gt;: SpringBoot使用JavaMail发送邮件，本地测试是可以通过的，但项目部署到阿里云服务器后就不行了&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;问题原因&lt;/strong&gt;: 阿里云处于安全考虑，TCP&lt;code&gt;25&lt;/code&gt;端口出方向默认被封禁.&lt;/p&gt;
&lt;h2 id=&quot;问题解决&quot;&gt;&lt;a href=&quot;#问题解决&quot; class=&quot;headerlink&quot; title=&quot;问题解决&quot;&gt;&lt;/a&gt;问题解决&lt;/h2&gt;&lt;p&gt;对于阿里云线上服务器, 需要将邮箱的配置改为ssl加密465端口发送. &lt;code&gt;application.properties&lt;/code&gt;配置文件中增加下面配置&lt;/p&gt;
&lt;h3 id=&quot;旧版配置&quot;&gt;&lt;a href=&quot;#旧版配置&quot; class=&quot;headerlink&quot; title=&quot;旧版配置&quot;&gt;&lt;/a&gt;旧版配置&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;spring.mail.host=smtp.qq.com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spring.mail.port=25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spring.mail.username=邮箱账号&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spring.mail.password=邮箱密码&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="应用实践" scheme="http://dennisit.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/"/>
    
    
      <category term="阿里云" scheme="http://dennisit.github.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>Akka调度器和远程调用</title>
    <link href="http://dennisit.github.io/2017/02/01/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Akka/Akka%E8%B0%83%E5%BA%A6%E5%99%A8%E5%92%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/"/>
    <id>http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka调度器和远程调用/</id>
    <published>2017-02-01T11:57:53.000Z</published>
    <updated>2018-12-12T00:08:46.502Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在没有为Actor作配置的情况下，每一个ActorSystem将有一个缺省的派发器。该缺省派发器可以被配置，默认是使用指定的default-executor的一个Dispatcher</p></blockquote><h3 id="Akka-Dispatcher应用"><a href="#Akka-Dispatcher应用" class="headerlink" title="Akka Dispatcher应用"></a>Akka Dispatcher应用</h3><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p><code>application.conf</code> 内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DispatcherExample&#123;</span><br><span class="line">defaultDispatcher &#123;</span><br><span class="line">   type = Dispatcher</span><br><span class="line">   executor = "fork-join-executor"</span><br><span class="line">   fork-join-executor &#123;</span><br><span class="line">       parallelism-min = 2</span><br><span class="line">        parallelism-factor = 2.0</span><br><span class="line">    parallelism-max = 6</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">defaultDispatcher1 &#123;</span><br><span class="line">   type = Dispatcher</span><br><span class="line">   executor = "thread-pool-executor"</span><br><span class="line">   thread-pool-executor &#123;</span><br><span class="line">       core-pool-size-min = 1</span><br><span class="line">        core-pool-size-factor = 2.0</span><br><span class="line">    core-pool-size-max = 6</span><br><span class="line">   &#125;</span><br><span class="line">   throughput = 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="事件处理Actor"><a href="#事件处理Actor" class="headerlink" title="事件处理Actor"></a>事件处理Actor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger instance  = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log().info(<span class="string">"实例 #"</span> + instance.incrementAndGet() + <span class="string">", Hashcode #"</span> + <span class="keyword">this</span>.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(String.class, x-&gt;&#123;</span><br><span class="line">                    log().info(<span class="string">"[接收消息]:&#123;&#125;, Actor:&#123;&#125;, Thread:&#123;&#125;"</span>, x, self().path() , Thread.currentThread().getName());</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="主类测试示例"><a href="#主类测试示例" class="headerlink" title="主类测试示例"></a>主类测试示例</h4><p>主类示例代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"dispatcherSystem"</span>, ConfigFactory.load().getConfig(<span class="string">"DispatcherExample"</span>));</span><br><span class="line">        Props props = Props.create(EchoActor.class).withDispatcher(<span class="string">"defaultDispatcher"</span>).withRouter(<span class="keyword">new</span> RoundRobinPool(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        ActorRef actor = system.actorOf(props, <span class="string">"echoActor"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            actor.tell(<span class="string">"消息:"</span> + i, ActorRef.noSender());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        system.terminate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试示例输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/29/2018 17:57:12.527] [dispatcherSystem-defaultDispatcher-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] 实例 <span class="comment">#3, Hashcode #2058102743</span></span><br><span class="line">[INFO] [01/29/2018 17:57:12.527] [dispatcherSystem-defaultDispatcher-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] 实例 <span class="comment">#2, Hashcode #1700945207</span></span><br><span class="line">[INFO] [01/29/2018 17:57:12.529] [dispatcherSystem-defaultDispatcher-8] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] 实例 <span class="comment">#1, Hashcode #1494635147</span></span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:0, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher-6</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] [接收消息]:消息:1, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>, Thread:dispatcherSystem-defaultDispatcher-7</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-8] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] [接收消息]:消息:2, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>, Thread:dispatcherSystem-defaultDispatcher-8</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:3, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher-6</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] [接收消息]:消息:4, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>, Thread:dispatcherSystem-defaultDispatcher-7</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-8] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] [接收消息]:消息:5, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>, Thread:dispatcherSystem-defaultDispatcher-8</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:6, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher-6</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] [接收消息]:消息:7, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>, Thread:dispatcherSystem-defaultDispatcher-7</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-8] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] [接收消息]:消息:8, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>, Thread:dispatcherSystem-defaultDispatcher-8</span><br><span class="line">[INFO] [01/29/2018 17:57:12.530] [dispatcherSystem-defaultDispatcher-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:9, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher-6</span><br></pre></td></tr></table></figure><h4 id="切换Dispatcher测试"><a href="#切换Dispatcher测试" class="headerlink" title="切换Dispatcher测试"></a>切换Dispatcher测试</h4><p>主类代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ActorSystem system = ActorSystem.create(</span><br><span class="line">                <span class="string">"default-dispatcher"</span>,</span><br><span class="line">                ConfigFactory.load().getConfig(<span class="string">"DispatcherExample"</span>));</span><br><span class="line"></span><br><span class="line">        ActorRef actor = system.actorOf(</span><br><span class="line">                Props.create(EchoActor.class).withDispatcher(<span class="string">"defaultDispatcher1"</span>).withRouter(<span class="keyword">new</span> RoundRobinPool(<span class="number">3</span>))</span><br><span class="line">        , <span class="string">"echoActor"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            actor.tell(<span class="string">"消息:"</span> + i, ActorRef.noSender());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        system.terminate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/29/2018 18:02:44.600] [dispatcherSystem-defaultDispatcher1-5] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] 实例 <span class="comment">#3, Hashcode #1590930020</span></span><br><span class="line">[INFO] [01/29/2018 18:02:44.600] [dispatcherSystem-defaultDispatcher1-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] 实例 <span class="comment">#1, Hashcode #938937247</span></span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] 实例 <span class="comment">#2, Hashcode #904652545</span></span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-5] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:0, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher1-5</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] [接收消息]:消息:1, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>, Thread:dispatcherSystem-defaultDispatcher1-6</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] [接收消息]:消息:2, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>, Thread:dispatcherSystem-defaultDispatcher1-7</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-5] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:3, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher1-5</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-6] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] [接收消息]:消息:4, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>, Thread:dispatcherSystem-defaultDispatcher1-6</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-7] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] [接收消息]:消息:5, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>, Thread:dispatcherSystem-defaultDispatcher1-7</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-8] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:6, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher1-8</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-9] [akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>] [接收消息]:消息:7, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$b</span>, Thread:dispatcherSystem-defaultDispatcher1-9</span><br><span class="line">[INFO] [01/29/2018 18:02:44.603] [dispatcherSystem-defaultDispatcher1-8] [akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>] [接收消息]:消息:9, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$a</span>, Thread:dispatcherSystem-defaultDispatcher1-8</span><br><span class="line">[INFO] [01/29/2018 18:02:44.604] [dispatcherSystem-defaultDispatcher1-10] [akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>] [接收消息]:消息:8, Actor:akka://dispatcherSystem/user/echoActor/<span class="variable">$c</span>, Thread:dispatcherSystem-defaultDispatcher1-10</span><br><span class="line">`</span><br></pre></td></tr></table></figure><h3 id="Akka-Remote应用"><a href="#Akka-Remote应用" class="headerlink" title="Akka Remote应用"></a>Akka Remote应用</h3><p> Akka是一种消息驱动运算模式，它实现跨JVM程序运算的方式是通过能跨JVM的消息系统来调动分布在不同JVM上ActorSystem中的Actor进行运算，前题是Akka的地址系统可以支持跨JVM定位。Akka的消息系统最高境界可以实现所谓的Actor位置透明化，这样在Akka编程中就无须关注Actor具体在哪个JVM上运行，分布式Actor编程从方式上跟普通Actor编程就不会有什么区别了。Akka的Remoting是一种点对点的跨JVM消息通道，让一个JVM上ActorSystem中的某个Actor可以连接另一个JVM上ActorSystem中的另一个Actor。两个JVM上的ActorSystem之间只需具备TCP网络连接功能就可以实现Akka Remoting了。Akka-Remoting还没有实现完全的位置透明化，因为用户还必须在代码里或者配置文件里指明目标Actor的具体地址.</p><h4 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-remote_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="服务端消息处理"><a href="#服务端消息处理" class="headerlink" title="服务端消息处理"></a>服务端消息处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger instance  = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log().info(<span class="string">"启动实例 #"</span> + instance.incrementAndGet() + <span class="string">", Hashcode #"</span> + <span class="keyword">this</span>.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(String.class, x-&gt;&#123;</span><br><span class="line">                    log().info(<span class="string">"[接收消息]:&#123;&#125;, Actor:&#123;&#125;"</span>, x, getSender().path());</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="服务端主类示例"><a href="#服务端主类示例" class="headerlink" title="服务端主类示例"></a>服务端主类示例</h4><p>主类代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerSystem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"ServerSys"</span>, serverConfig());</span><br><span class="line">        ActorRef actor = system.actorOf(Props.create(EchoActor.class), <span class="string">"echoActor"</span>);</span><br><span class="line">        actor.tell(<span class="string">"服务端启动..."</span>, ActorRef.noSender());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Config <span class="title">serverConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">        map.put(<span class="string">"akka.actor.provider"</span>,   <span class="string">"akka.remote.RemoteActorRefProvider"</span>);</span><br><span class="line">        map.put(<span class="string">"akka.remote.transport"</span>, <span class="string">"akka.remote.netty.NettyRemoteTransport"</span>);</span><br><span class="line">        map.put(<span class="string">"akka.remote.netty.tcp.hostname"</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line">        map.put(<span class="string">"akka.remote.netty.tcp.port"</span>, <span class="string">"2500"</span>);</span><br><span class="line">        <span class="keyword">return</span> ConfigFactory.parseMap(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/29/2018 16:48:17.553] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/29/2018 16:48:17.708] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://ServerSys@127.0.0.1:2500]</span><br><span class="line">[INFO] [01/29/2018 16:48:17.709] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://ServerSys@127.0.0.1:2500]</span><br><span class="line">[INFO] [01/29/2018 16:48:17.734] [ServerSys-akka.actor.default-dispatcher-2] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] 启动实例 <span class="comment">#1, Hashcode #242972067</span></span><br><span class="line">[INFO] [01/29/2018 16:48:17.734] [ServerSys-akka.actor.default-dispatcher-2] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:服务端启动..., Actor:akka://ServerSys/user/echoActor</span><br></pre></td></tr></table></figure><h4 id="客户端主类示例"><a href="#客户端主类示例" class="headerlink" title="客户端主类示例"></a>客户端主类示例</h4><p>主类代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientSystem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ActorSystem system = ActorSystem.create(<span class="string">"ClientSys"</span>, clientConfig());</span><br><span class="line">        String path = <span class="string">"akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor"</span>;</span><br><span class="line">        ActorRef remoteActor = system.actorFor(path);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">            remoteActor.tell(<span class="string">"客户端推送发送"</span> + i, ActorRef.noSender());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Config <span class="title">clientConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">        map.put(<span class="string">"akka.actor.provider"</span>,   <span class="string">"akka.remote.RemoteActorRefProvider"</span>);</span><br><span class="line">        map.put(<span class="string">"akka.remote.transport"</span>, <span class="string">"akka.remote.netty.NettyRemoteTransport"</span>);</span><br><span class="line">        map.put(<span class="string">"akka.remote.netty.tcp.hostname"</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line">        map.put(<span class="string">"akka.remote.netty.tcp.port"</span>, <span class="string">"2600"</span>);</span><br><span class="line">        <span class="keyword">return</span> ConfigFactory.parseMap(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动日志</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [<span class="number">01</span>/<span class="number">29</span>/<span class="number">2018</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">26.999</span>] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [<span class="number">01</span>/<span class="number">29</span>/<span class="number">2018</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">27.168</span>] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp:<span class="comment">//ClientSys@127.0.0.1:2600]</span></span><br><span class="line">[INFO] [<span class="number">01</span>/<span class="number">29</span>/<span class="number">2018</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">27.169</span>] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp:<span class="comment">//ClientSys@127.0.0.1:2600]</span></span><br></pre></td></tr></table></figure><p>服务端日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/29/2018 16:48:17.553] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/29/2018 16:48:17.708] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://ServerSys@127.0.0.1:2500]</span><br><span class="line">[INFO] [01/29/2018 16:48:17.709] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://ServerSys@127.0.0.1:2500]</span><br><span class="line">[INFO] [01/29/2018 16:48:17.734] [ServerSys-akka.actor.default-dispatcher-2] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] 启动实例 <span class="comment">#1, Hashcode #242972067</span></span><br><span class="line">[INFO] [01/29/2018 16:48:17.734] [ServerSys-akka.actor.default-dispatcher-2] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:服务端启动..., Actor:akka://ServerSys/user/echoActor</span><br><span class="line">[INFO] [01/29/2018 16:48:27.326] [ServerSys-akka.actor.default-dispatcher-4] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:客户端推送发送0, Actor:akka://ServerSys/user/echoActor</span><br><span class="line">[INFO] [01/29/2018 16:48:27.326] [ServerSys-akka.actor.default-dispatcher-4] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:客户端推送发送1, Actor:akka://ServerSys/user/echoActor</span><br><span class="line">[INFO] [01/29/2018 16:48:27.326] [ServerSys-akka.actor.default-dispatcher-4] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:客户端推送发送2, Actor:akka://ServerSys/user/echoActor</span><br><span class="line">[INFO] [01/29/2018 16:48:27.326] [ServerSys-akka.actor.default-dispatcher-4] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:客户端推送发送3, Actor:akka://ServerSys/user/echoActor</span><br><span class="line">[INFO] [01/29/2018 16:48:27.326] [ServerSys-akka.actor.default-dispatcher-4] [akka.tcp://ServerSys@127.0.0.1:2500/user/echoActor] [接收消息]:客户端推送发送4, Actor:akka://ServerSys/user/echoActor</span><br></pre></td></tr></table></figure><h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><ul><li><a href="http://www.cnblogs.com/tiger-xc/p/7063301.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiger-xc/p/7063301.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在没有为Actor作配置的情况下，每一个ActorSystem将有一个缺省的派发器。该缺省派发器可以被配置，默认是使用指定的default-executor的一个Dispatcher&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;Akka-Dispatcher应用&quot;&gt;&lt;a href=&quot;#Akka-Dispatcher应用&quot; class=&quot;headerlink&quot; title=&quot;Akka Dispatcher应用&quot;&gt;&lt;/a&gt;Akka Dispatcher应用&lt;/h3&gt;&lt;h4 id=&quot;配置文件&quot;&gt;&lt;a href=&quot;#配置文件&quot; class=&quot;headerlink&quot; title=&quot;配置文件&quot;&gt;&lt;/a&gt;配置文件&lt;/h4&gt;&lt;p&gt;&lt;code&gt;application.conf&lt;/code&gt; 内容&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;DispatcherExample&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	defaultDispatcher &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 type = Dispatcher&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 executor = &quot;fork-join-executor&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 fork-join-executor &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       		parallelism-min = 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	    parallelism-factor = 2.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    parallelism-max = 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	defaultDispatcher1 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 type = Dispatcher&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 executor = &quot;thread-pool-executor&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 thread-pool-executor &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       		core-pool-size-min = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    	    core-pool-size-factor = 2.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			    core-pool-size-max = 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  	 throughput = 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Akka" scheme="http://dennisit.github.io/tags/Akka/"/>
    
  </entry>
  
  <entry>
    <title>Akka介绍与入门示例</title>
    <link href="http://dennisit.github.io/2017/02/01/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Akka/Akka%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%85%A5%E9%97%A8%E7%A4%BA%E4%BE%8B/"/>
    <id>http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka介绍与入门示例/</id>
    <published>2017-02-01T11:57:53.000Z</published>
    <updated>2018-12-13T00:37:46.670Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Akka介绍"><a href="#Akka介绍" class="headerlink" title="Akka介绍"></a>Akka介绍</h3><blockquote><p>Akka是用scala编写的actor模型框架。它在使用中不需要锁和多线程，每个Actor在独立空间中进行数据操作，Actor之间并不直接通信,而是通过了消息来相互沟通,每一个Actor都把它要做的事情都封装在了它的内部，操作都是异步进行的。<br>理论上来讲,每一个Actor都拥有属于自己的轻量级线程,保护它不会被系统中的其他部分影响.因此,我们在编写Actor时,就不用担心并发的问题, 通过Actor能够简化锁以及线程管理.<br>它可以用于高并发、分布式场景，需要注意的是，Akka消息的传递不保证绝对可靠投递，当然这带来了好处是整个实现简单.</p></blockquote><p>Actor具有以下的特性</p><ul><li>提供了一种高级的抽象,能够封装状态和操作.简化并发应用的开发.</li><li>提供了异步的非阻塞的/高性能的事件驱动模型</li><li>超级轻量级的线程事件处理能力.</li></ul><a id="more"></a><h3 id="概念认知"><a href="#概念认知" class="headerlink" title="概念认知"></a>概念认知</h3><p>在了解Akka前先了解几个概念</p><h4 id="并发-amp-并行"><a href="#并发-amp-并行" class="headerlink" title="并发&amp;并行"></a>并发&amp;并行</h4><p>并发: 指的是两个或多个任务都有进展，即使他们没有被同时执行。例如可以这样实现：划分出时间片，几个任务交叉执行，尽管时间片的执行是线性的。<br>并行: 指可以真正同时执行。</p><h4 id="异步-amp-同步"><a href="#异步-amp-同步" class="headerlink" title="异步&amp;同步"></a>异步&amp;同步</h4><p>所谓同步，就是在发出一个功能调用时，在没有得到结果之前，该调用就不返回。当一个异步过程调用发出后，调用者不能立刻得到结果。实际处理这个调用的部件在完成后，通过状态、通知和回调来通知调用者。</p><h4 id="阻塞-amp-非阻塞"><a href="#阻塞-amp-非阻塞" class="headerlink" title="阻塞&amp;非阻塞"></a>阻塞&amp;非阻塞</h4><p>阻塞调用是指调用结果返回之前，当前线程会被挂起。函数只有在得到结果之后才会返回。有人也许会把阻塞调用和同步调用等同起来，实际上他是不同的。对于同步调用来说，很多时候当前线程还是激活的，只是从逻辑上当前函数没有返回而已。<br>非阻塞和阻塞的概念相对应，指在不能立刻得到结果之前，该函数不会阻塞当前线程，而会立刻返回</p><h3 id="Akka模块介绍"><a href="#Akka模块介绍" class="headerlink" title="Akka模块介绍"></a>Akka模块介绍</h3><ul><li>akka-actor:最核心的依赖包,里面实现了Actor模型的大部分东西</li><li>akka-agent:代理/整合了Scala中的一些STM特性</li><li>akka-camel:整合了Apache的Camel</li><li>akka-cluster:akka集群依赖,封装了集群成员的管理和路由</li><li>akka-kernel:akka的一个极简化的应用服务器,可以脱离项目单独运行.</li><li>akka-osgi:对OSGI容器的支持,有akka的最基本的Bundle</li><li>akka-remote:akka远程调用</li><li>akka-slf4j:Akka的日志事件监听</li><li>akka-testkit:Akka的各种测试工具</li><li>akka-zeromq:整合ZeroMQ</li></ul><p>其中最总要的就是akka-actor,最简单的AKKA使用的话,只需要引入这个包就可以了.</p><h3 id="建议一个Akka系统的步骤"><a href="#建议一个Akka系统的步骤" class="headerlink" title="建议一个Akka系统的步骤"></a>建议一个Akka系统的步骤</h3><ol><li>建立角色系统，ActorSystem;</li><li>定义角色，actor;</li><li>注册角色，actorSystem.actorOf；</li><li>消息的传递，tell；</li><li>在actor内消息的处理（处理完后，也可通过actorSelect路径选择其它actor，并发送消息)</li></ol><p>相关模块说明</p><ul><li>角色系统<code>ActorSystem</code></li></ul><p>在akka中，所有角色都需在角色系统中，可以通过ActorSystem.create方法建立，同时可以指定角色系统名称，这会在actor路径中体现出来；</p><ul><li>角色(Actor)</li></ul><p>通过继承AbstractActor类，实现抽象方法createReceive,并在此方法定义消息处理模块(使用reciveBuilder.build进行构造), 接收消息（消息类型，其实也就是消息的class类型区分消息），并进行消息处理；</p><ul><li>角色(Actor)注册/创建</li></ul><p>通过ActorSystem的actorOf方法创建actor，创建时可以通过new BalancingPool(3)指定该actor的工作worker数量，以及actor的名称，这会在路径中体现出来。</p><ul><li>角色(Actor)路径及查找</li></ul><p>Akka内的各个actor采用类似于分布式文件系统（如hdfs）进行管理，actor类似于文件系统的各个文件。</p><p>Akka主要根路径有三个：/（根路径），/system（系统相关的路径），/user(用户路径，通常定义的actor在此路径下)。</p><p>有了路径，可以通过getContext().actorSelect()方法基于路径,获取到相关actor引用，进而发送消息.</p><p>/user: 守护Actor</p><p>这个名为”/user”的守护者，作为所有用户创建actor的父actor，可能是需要打交道最多的。使用system.actorOf()创建的actor都是其子actor。这意味着，当该守护者终止时，系统中所有的普通actor都将被关闭。同时也意味着，该守护者的监管策略决定了普通顶级actor是如何被监督的.</p><p>/system: 系统守护者</p><p>这个特殊的守护者被引入，是为了实现正确的关闭顺序，即日志（logging）要保持可用直到所有普通actor终止，即使日志本身也是用actor实现的。其实现方法是：系统守护者观察user守护者，并在收到Terminated消息初始化其自己的关闭过程。顶级的系统actor被监管的策略是，对收到的除ActorInitializationException和ActorKilledException之外的所有Exception无限地执行重启，这也将终止其所有子actor。所有其他Throwable被上升，然后将导致整个actor系统的关闭。</p><p>/: 根守护者</p><p>根守护者所谓“顶级”actor的祖父，它监督所有在Actor路径的顶级作用域中定义的特殊actor，使用发现任何Exception就终止子actor的SupervisorStrategy.stoppingStrategy策略。其他所有Throwable都会被上升……但是上升给谁？所有的真实actor都有一个监管者，但是根守护者没有父actor，因为它就是整个树结构的根。因此这里使用一个虚拟的ActorRef，在发现问题后立即停掉其子actor，并在根守护者完全终止之后（所有子actor递归停止），立即把actor系统的isTerminated置为true。</p><h3 id="Akka监管策略"><a href="#Akka监管策略" class="headerlink" title="Akka监管策略"></a>Akka监管策略</h3><p>Akka中有两种类型的监管策略：OneForOneStrategy 和AllForOneStrategy.</p><p>两者都配置有从异常类型监管指令间的映射（见上文），并限制了一个孩子被终止之前允许失败的次数。它们之间的区别在于，前者只将所获得的指令应用在发生故障的子actor上，而后者则是应用在所有孩子上。通常情况下，你应该使用OneForOneStrategy，这也是默认的策略。</p><h3 id="Akka消息传递机制"><a href="#Akka消息传递机制" class="headerlink" title="Akka消息传递机制"></a>Akka消息传递机制</h3><p>有三种基本类型：</p><ul><li>至多一次投递的意思是对该机制下的每条消息，会被投递0或1次；更随意的说法就是，它意味着消息可能会丢失。</li><li>至少一次投递的意思对该机制下的每条消息，有可能为投递进行多次尝试，以使得至少有一个成功；更随意的说法就是，消息可能重复，但不会丢失。</li><li>恰好一次投递的意思对该机制下的每条消息，接收者会正好得到一次投递；消息既不能丢，也不会重复。</li></ul><p>第一种是最廉价的——性能最高，实现开销最少——因为它可以用打后不管（fire-and-forget）的方式完成，不需要在发送端或传输机制中保留状态。第二种方式要求重试来对抗传输丢失，这意味着需要在发送端保持状态，并在接收端使用确认机制。第三种是最昂贵的——并因此表现最差——因为除了需要第二种方式的机制以外，还需要在接收端保持状态，以过滤重复的投递.</p><h3 id="Akka入门示例"><a href="#Akka入门示例" class="headerlink" title="Akka入门示例"></a>Akka入门示例</h3><h4 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="定义Actor"><a href="#定义Actor" class="headerlink" title="定义Actor"></a>定义Actor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Number.class, m -&gt; &#123;</span><br><span class="line">                    log().info(<span class="string">"[ACCEPT][String]:&#123;&#125;"</span>, m);</span><br><span class="line">                    System.out.println(m);</span><br><span class="line">                &#125;)</span><br><span class="line">                .match(String.class, StringUtils::isNotBlank, m -&gt; &#123;</span><br><span class="line">                    log().info(<span class="string">"[Accept][Number]:&#123;&#125;"</span>, m);</span><br><span class="line">                    System.out.println(m);</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="程序主类"><a href="#程序主类" class="headerlink" title="程序主类"></a>程序主类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1</span></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"helloSystem"</span>);</span><br><span class="line">        <span class="comment">// 2</span></span><br><span class="line">        ActorRef helloActor = system.actorOf(Props.create(HelloActor.class), <span class="string">"helloActor"</span>);</span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        helloActor.tell(<span class="string">"Hello, World!"</span>, ActorRef.noSender());</span><br><span class="line">        helloActor.tell(<span class="number">123</span>, ActorRef.noSender());</span><br><span class="line">        helloActor.tell(<span class="string">"Have Fun with Akka!"</span>, ActorRef.noSender());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>程序解读</strong></p><ol><li>创建一个Actor系统,命名为”helloSystem”</li><li>每个Actor对外封闭,使用ActorRef的actorOf方法创建Actor,示例创建了一个名为”helloActor”的Actor,绑定HelloActor事件处理.</li><li>发送消息给”helloActor”,tell()方法是异步的，它只给Actor的邮箱放一封邮件，然后就返回了。tell()方法的第一个参数是消息，第二个参数是发送者，这样接收者Actor就知道是谁给自己发的消息了. 示例中在主方法中发送消息,所以首次消息发送者为<code>ActorRef.noSender()</code>.</li></ol><h4 id="执行输出"><a href="#执行输出" class="headerlink" title="执行输出"></a>执行输出</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hello, World!</span><br><span class="line">123</span><br><span class="line">Have Fun with Akka!</span><br><span class="line">[INFO] [01/26/2018 15:33:06.870] [helloSystem-akka.actor.default-dispatcher-5] [akka://helloSystem/user/helloActor] [Accept][Number]:Hello, World!</span><br><span class="line">[INFO] [01/26/2018 15:33:06.871] [helloSystem-akka.actor.default-dispatcher-5] [akka://helloSystem/user/helloActor] [ACCEPT][String]:123</span><br><span class="line">[INFO] [01/26/2018 15:33:06.871] [helloSystem-akka.actor.default-dispatcher-5] [akka://helloSystem/user/helloActor] [Accept][Number]:Have Fun with Akka!</span><br></pre></td></tr></table></figure><h3 id="Akka消息传递"><a href="#Akka消息传递" class="headerlink" title="Akka消息传递"></a>Akka消息传递</h3><p>示例使用Akka实现一个MapReduce的经典示例<code>WordCount</code></p><h4 id="Maven依赖-1"><a href="#Maven依赖-1" class="headerlink" title="Maven依赖"></a>Maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   └── main</span><br><span class="line">│       ├── java</span><br><span class="line">│       │   └── com</span><br><span class="line">│       │       └── elons</span><br><span class="line">│       │           └── wordcount</span><br><span class="line">│       │               └── akka</span><br><span class="line">│       │                   ├── actor</span><br><span class="line">│       │                   │   ├── InputActor.java</span><br><span class="line">│       │                   │   ├── MapperActor.java</span><br><span class="line">│       │                   │   ├── OutputActor.java</span><br><span class="line">│       │                   │   └── ReduceActor.java</span><br><span class="line">│       │                   ├── main</span><br><span class="line">│       │                   │   └── WcApplication.java</span><br><span class="line">│       │                   └── trans</span><br><span class="line">│       │                       └── Message.java</span><br><span class="line">│       └── resources</span><br><span class="line">│           └── application.properties</span><br></pre></td></tr></table></figure><h4 id="消息定义"><a href="#消息定义" class="headerlink" title="消息定义"></a>消息定义</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Count</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String word;</span><br><span class="line">        <span class="keyword">private</span> Integer count;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Mapper</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;Count&gt; data;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Mapper</span><span class="params">(List&lt;Count&gt; data)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.data = Collections.unmodifiableList(data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Reduce</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, Integer&gt; data;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Reduce</span><span class="params">(Map&lt;String, Integer&gt; reduceDataList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.data = Collections.unmodifiableMap(reduceDataList);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Actor定义"><a href="#Actor定义" class="headerlink" title="Actor定义"></a>Actor定义</h4><p><code>InputActor</code>定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InputActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链式逆向织入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef wcOutputActor = context().system()</span><br><span class="line">            .actorOf(Props.create(OutputActor.class), <span class="string">"outputActor"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef reduceActor = context().system()</span><br><span class="line">            .actorOf(Props.create(ReduceActor.class, wcOutputActor), <span class="string">"reduceActor"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef mapperActor = context().system()</span><br><span class="line">            .actorOf(Props.create(MapperActor.class, reduceActor), <span class="string">"mapperActor"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(String.class, x -&gt; &#123;</span><br><span class="line">                    log().info(<span class="string">"[事件][数据录入]: &#123;&#125;"</span>, x);</span><br><span class="line">                    mapperActor.tell(x, self());</span><br><span class="line">                &#125;)</span><br><span class="line">                .match(Message.Result.class, x -&gt; &#123;</span><br><span class="line">                    log().info(<span class="string">"[事件][结果统计]"</span>);</span><br><span class="line">                    wcOutputActor.tell(x, self());</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MapperActor</code>定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef reduceActor = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapperActor</span><span class="params">(ActorRef reduceActor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reduceActor = reduceActor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(String.class, x -&gt; &#123;</span><br><span class="line">                    Message.Mapper mapper = mapper(x);</span><br><span class="line">                    reduceActor.tell(mapper, self());</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Message.<span class="function">Mapper <span class="title">mapper</span><span class="params">(String line)</span> </span>&#123;</span><br><span class="line">        List&lt;Message.Count&gt; list = Lists.newArrayList();</span><br><span class="line">        StringTokenizer parser = <span class="keyword">new</span> StringTokenizer(line);</span><br><span class="line">        <span class="keyword">while</span> (parser.hasMoreTokens()) &#123;</span><br><span class="line">            String word = parser.nextToken().toLowerCase();</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(word)) &#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> Message.Count(word, <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Message.Mapper(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ReduceActor</code>定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReduceActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结果集统计Actor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ActorRef wcOutputActor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReduceActor</span><span class="params">(ActorRef wcOutputActor)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.wcOutputActor = wcOutputActor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AbstractActor.<span class="function">Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Mapper.class, x -&gt; &#123;</span><br><span class="line">                    log().info(<span class="string">"[计算][Mapper]: &#123;&#125;"</span>, x);</span><br><span class="line">                    <span class="comment">// reduce the incoming data</span></span><br><span class="line">                    Message.Reduce reduceData = reduce(x.getData());</span><br><span class="line">                    <span class="comment">// forward the result to aggregate actor</span></span><br><span class="line">                    wcOutputActor.tell(reduceData, self());</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Message.<span class="function">Reduce <span class="title">reduce</span><span class="params">(List&lt;Message.Count&gt; coll)</span> </span>&#123;</span><br><span class="line">        HashMap&lt;String, Integer&gt; reducedMap = Maps.newHashMap();</span><br><span class="line">        <span class="keyword">for</span> (Message.Count count: coll) &#123;</span><br><span class="line">            <span class="keyword">if</span> (reducedMap.containsKey(count.getWord())) &#123;</span><br><span class="line">                Integer value = reducedMap.get(count.getWord());</span><br><span class="line">                value++;</span><br><span class="line">                reducedMap.put(count.getWord(), value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reducedMap.put(count.getWord(), <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Message.Reduce(reducedMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>OutputActor</code>定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutputActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; wcCount = Maps.newHashMap();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Reduce.class, x -&gt; &#123;</span><br><span class="line">                    log().info(<span class="string">"[计算][Reduce]: &#123;&#125;"</span>, x);</span><br><span class="line">                    Map&lt;String, Integer&gt; map = x.getData();</span><br><span class="line">                    countReduce(map);</span><br><span class="line">                &#125;)</span><br><span class="line">                .match(Message.Result.class, x -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"结果:"</span> + wcCount);</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">countReduce</span><span class="params">(Map&lt;String, Integer&gt; reduce)</span> </span>&#123;</span><br><span class="line">        Integer count = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (String key : reduce.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (wcCount.containsKey(key)) &#123;</span><br><span class="line">                count = wcCount.get(key) + reduce.get(key) ;</span><br><span class="line">                wcCount.put(key, count);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                wcCount.put(key, reduce.get(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WcApplication</code>测试主类定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WcApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"wordCountSystem"</span>);</span><br><span class="line">        ActorRef inputActor = system.actorOf(Props.create(InputActor.class),<span class="string">"inputActor"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 推送待统计数据</span></span><br><span class="line">        inputActor.tell(<span class="string">"Akka Map Reduce Demo"</span>, ActorRef.noSender());</span><br><span class="line">        inputActor.tell(<span class="string">"Word Count With Akka , Map Reduce Test."</span>, ActorRef.noSender());</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取计算结果</span></span><br><span class="line">        inputActor.tell(<span class="keyword">new</span> Message.Result(), <span class="keyword">null</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        system.terminate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="执行输出-1"><a href="#执行输出-1" class="headerlink" title="执行输出"></a>执行输出</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/29/2018 12:00:27.089] [wordCountSystem-akka.actor.default-dispatcher-3] [akka://wordCountSystem/user/inputActor] [事件][数据录入]: Akka Map Reduce Demo</span><br><span class="line">[INFO] [01/29/2018 12:00:27.089] [wordCountSystem-akka.actor.default-dispatcher-3] [akka://wordCountSystem/user/inputActor] [事件][数据录入]: Word Count With Akka , Map Reduce Test.</span><br><span class="line">[INFO] [01/29/2018 12:00:27.224] [wordCountSystem-akka.actor.default-dispatcher-3] [akka://wordCountSystem/user/reduceActor] [计算][Mapper]: &#123;<span class="string">"data"</span>:[&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"akka"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"map"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"reduce"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"demo"</span>&#125;]&#125;</span><br><span class="line">[INFO] [01/29/2018 12:00:27.224] [wordCountSystem-akka.actor.default-dispatcher-3] [akka://wordCountSystem/user/reduceActor] [计算][Mapper]: &#123;<span class="string">"data"</span>:[&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"word"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"count"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"with"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"akka"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">","</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"map"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"reduce"</span>&#125;,&#123;<span class="string">"count"</span>:1,<span class="string">"word"</span>:<span class="string">"test."</span>&#125;]&#125;</span><br><span class="line">[INFO] [01/29/2018 12:00:27.228] [wordCountSystem-akka.actor.default-dispatcher-5] [akka://wordCountSystem/user/outputActor] [计算][Reduce]: &#123;<span class="string">"data"</span>:&#123;<span class="string">"reduce"</span>:1,<span class="string">"akka"</span>:1,<span class="string">"map"</span>:1,<span class="string">"demo"</span>:1&#125;&#125;</span><br><span class="line">[INFO] [01/29/2018 12:00:27.229] [wordCountSystem-akka.actor.default-dispatcher-5] [akka://wordCountSystem/user/outputActor] [计算][Reduce]: &#123;<span class="string">"data"</span>:&#123;<span class="string">"reduce"</span>:1,<span class="string">"with"</span>:1,<span class="string">"count"</span>:1,<span class="string">","</span>:1,<span class="string">"word"</span>:1,<span class="string">"akka"</span>:1,<span class="string">"map"</span>:1,<span class="string">"test."</span>:1&#125;&#125;</span><br><span class="line">结果:&#123;reduce=2, with=1, count=1, ,=1, akka=2, map=2, demo=1, word=1, <span class="built_in">test</span>.=1&#125;</span><br><span class="line">[INFO] [01/29/2018 12:00:27.583] [wordCountSystem-akka.actor.default-dispatcher-4] [akka://wordCountSystem/user/inputActor] [事件][结果统计]</span><br></pre></td></tr></table></figure><h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><ul><li><a href="https://doc.yonyoucloud.com/doc/akka-doc-cn/2.3.6/scala/book/chapter1/introduction.html" target="_blank" rel="noopener">https://doc.yonyoucloud.com/doc/akka-doc-cn/2.3.6/scala/book/chapter1/introduction.html</a></li><li><a href="http://blog.csdn.net/jmppok/article/details/17264495" target="_blank" rel="noopener">http://blog.csdn.net/jmppok/article/details/17264495</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Akka介绍&quot;&gt;&lt;a href=&quot;#Akka介绍&quot; class=&quot;headerlink&quot; title=&quot;Akka介绍&quot;&gt;&lt;/a&gt;Akka介绍&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Akka是用scala编写的actor模型框架。它在使用中不需要锁和多线程，每个Actor在独立空间中进行数据操作，Actor之间并不直接通信,而是通过了消息来相互沟通,每一个Actor都把它要做的事情都封装在了它的内部，操作都是异步进行的。&lt;br&gt;理论上来讲,每一个Actor都拥有属于自己的轻量级线程,保护它不会被系统中的其他部分影响.因此,我们在编写Actor时,就不用担心并发的问题, 通过Actor能够简化锁以及线程管理.&lt;br&gt;它可以用于高并发、分布式场景，需要注意的是，Akka消息的传递不保证绝对可靠投递，当然这带来了好处是整个实现简单.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Actor具有以下的特性&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;提供了一种高级的抽象,能够封装状态和操作.简化并发应用的开发.&lt;/li&gt;
&lt;li&gt;提供了异步的非阻塞的/高性能的事件驱动模型&lt;/li&gt;
&lt;li&gt;超级轻量级的线程事件处理能力.&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Akka" scheme="http://dennisit.github.io/tags/Akka/"/>
    
  </entry>
  
  <entry>
    <title>Akka分布式计算应用</title>
    <link href="http://dennisit.github.io/2017/02/01/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Akka/Akka%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%BA%94%E7%94%A8/"/>
    <id>http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka分布式计算应用/</id>
    <published>2017-02-01T11:57:53.000Z</published>
    <updated>2018-12-12T00:08:46.498Z</updated>
    
    <content type="html"><![CDATA[<p>介绍<code>Akka-Cluster</code>前 需要先说一下<code>Akka-Remoting</code>.</p><blockquote><p><code>Akka-Remoting</code>一种ActorSystem之间Actor对Actor点对点的沟通协议.通过Akka-Remoting来实现一个ActorSystem中的一个Actor与另一个ActorSystem中的另一个Actor之间的沟通.在Remoting功能之后,Akka又发展了集群Cluster功能.<br><code>Akka-Cluster</code>是基于Akka-Remoting之上的新一代分布式运算环境,所以Remoting已经成为了Akka-Cluster的内部支持功能,在生产环境中的分布式运算应该尽量使用Akka-Cluster; Akka-Cluster可以在一部物理机或一组网络连接的服务器上搭建部署.</p></blockquote><p>简单来说Akka-Cluster将多个JVM连接整合起来,实现消息地址的透明化和统一化使用管理,集成一体化的消息驱动系统.最终目的是能够把一个大型程序分割成多个子程序,然后部署到很多JVM上去实现程序的分布式并行运算.更重要的是：Cluster的构建过程与Actor编程没有牵连,当Cluster把多个ActorSystem集合成一个统一系统后,我们可以用在单一ActorSystem里编程的习惯方式编写分布式运算程序.由于在单一机器上就可以配置多个节点形成一个集群,我们开发的分布式程序可以在单机或多机群上运行,不同的只是如何部署和配置集群环境.</p><a id="more"></a><h3 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost akka-task ]$ tree akka-task</span><br><span class="line">akka-task</span><br><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   └── main</span><br><span class="line">│       ├── java</span><br><span class="line">│       │   └── com</span><br><span class="line">│       │       └── elonsu</span><br><span class="line">│       │           └── cluster</span><br><span class="line">│       │               └── akka</span><br><span class="line">│       │                   ├── Message.java</span><br><span class="line">│       │                   ├── client</span><br><span class="line">│       │                   │   ├── DispatchActor.java</span><br><span class="line">│       │                   │   └── TaskClusterClient.java</span><br><span class="line">│       │                   └── server</span><br><span class="line">│       │                       ├── TaskActor.java</span><br><span class="line">│       │                       ├── TaskClusterServer1.java</span><br><span class="line">│       │                       ├── TaskClusterServer2.java</span><br><span class="line">│       │                       └── TaskClusterServer3.java</span><br><span class="line">│       └── resources</span><br><span class="line">│           ├── akka-client.conf</span><br><span class="line">│           ├── akka-node1.conf</span><br><span class="line">│           ├── akka-node2.conf</span><br><span class="line">│           └── akka-node3.conf</span><br></pre></td></tr></table></figure><h3 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-cluster_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-remote_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明"></a>模块说明</h3><p>消息相关</p><ul><li>Message: 示例中客户端和服务端通讯的消息定义</li></ul><p>服务端相关</p><ul><li>TaskActor: 服务端事件处理类</li><li>TaskClusterServer* : 服务端实例主类(示例中定义了3台实例)</li><li>akka-node*.conf : 服务端配置</li></ul><p>客户端相关</p><ul><li>DispatchActor: 消息投递转发类, 用于对于服务端节点进行选取和消息投递</li><li>TaskClusterClient: 客户端示例主类</li><li>akka-client.conf : 客户端配置</li></ul><h3 id="代码示例-服务端"><a href="#代码示例-服务端" class="headerlink" title="代码示例(服务端)"></a>代码示例(服务端)</h3><p>示例中定义的服务端端端口分别为:2551、2552、2553</p><h4 id="消息定义"><a href="#消息定义" class="headerlink" title="消息定义"></a>消息定义</h4><p>说明: 消息定义必须实现序列化接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span>  taskId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> taskId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String result;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h4><p><code>akka-node1.conf</code>配置内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2551</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["server"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>akka-node2.conf</code>配置内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2552</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["server"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>akka-node3.conf</code>配置内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2553</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["server"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="服务端Actor"><a href="#服务端Actor" class="headerlink" title="服务端Actor"></a>服务端Actor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 集群监听</span></span><br><span class="line">    <span class="keyword">private</span> Cluster cluster = Cluster.get(getContext().system());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//subscribe to cluster changes</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//#subscribe</span></span><br><span class="line">        cluster.subscribe(getSelf(), ClusterEvent.initialStateAsEvents(),</span><br><span class="line">                ClusterEvent.MemberEvent.class, ClusterEvent.UnreachableMember.class);</span><br><span class="line">        <span class="comment">//#subscribe</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//re-subscribe when restart</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cluster.unsubscribe(getSelf());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x-&gt; &#123;</span><br><span class="line">                            log().info(<span class="string">"[接收消息]:&#123;&#125;, Actor:&#123;&#125;, Thread:&#123;&#125;"</span>, x, getSelf().path(), Thread.currentThread().getName());</span><br><span class="line">                            getSender().tell(<span class="keyword">new</span> Message.Result(x.getTaskId(), x.getContent() + <span class="string">"处理完成"</span>), self());</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberUp.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member is Up: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.CurrentClusterState.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Cluster State: &#123;&#125;"</span>, x.getMembers())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.UnreachableMember.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member detected as unreachable: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberRemoved.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member is Removed: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberEvent.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"ignore"</span>)</span><br><span class="line">                )</span><br><span class="line">                .matchAny(</span><br><span class="line">                        x -&gt; unhandled(x)</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="服务端主类"><a href="#服务端主类" class="headerlink" title="服务端主类"></a>服务端主类</h4><p>这里只列出Node1上的主类, 服务端节点中每个示例的内容基本一样,不同的是各自加载的配置文件<code>&quot;akka-node*.conf&quot;</code>与实例对应.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskClusterServer1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"simpleAkkaCluster"</span>, ConfigFactory.load(<span class="string">"akka-node1.conf"</span>));</span><br><span class="line">        ActorRef taskActor = system.actorOf(Props.create(TaskActor.class), <span class="string">"taskActor"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Akka Cluster Node1 启动完成"</span> + taskActor.path());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="集群状态监听"><a href="#集群状态监听" class="headerlink" title="集群状态监听"></a>集群状态监听</h3><p>示例场景: 分别启动服务端节点Node1、Node2、Node3、然后关停Node2、再重新启动,观察集群状态日志</p><h4 id="Node1日志"><a href="#Node1日志" class="headerlink" title="Node1日志"></a>Node1日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:45:06.365] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:45:06.565] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 11:45:06.567] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 11:45:06.578] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:45:06.728] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:45:06.728] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:45:06.765] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.862] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.862] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2552</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.863] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:06.863] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-0] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]] Caused by: [Connection refused: /172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:06.867] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:06.867] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:07.782] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:07.782] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:08.783] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:08.783] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:09.781] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:09.781] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:10.783] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:10.783] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#-113492512] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:11.792] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:11.802] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:11.806] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.616] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-138411316]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.616] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-138411316]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.662] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.664] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.770] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.771] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.523] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.523] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.770] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.771] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:45.977] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:47.769] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Exiting]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:47.771] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:48.776] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Exiting confirmed [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.798] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-0/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] -&gt; [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.798] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-6] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/endpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-2] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:50.771] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is removing confirmed Exiting node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:50.772] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Removed)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.358] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.358] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.769] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.770] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br></pre></td></tr></table></figure><h4 id="Node2日志"><a href="#Node2日志" class="headerlink" title="Node2日志"></a>Node2日志</h4><p>首次加入集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:45:12.982] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:45:13.249] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:45:13.251] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:45:13.267] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:45:13.401] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:45:13.401] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:45:13.433] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:13.532] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 11:45:13.536] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.540] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/joinSeedNodeProcess-1#-138411316] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.770] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.779] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.779] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:13.811] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.496] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#-505101083]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.780] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.803] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#-1800037640] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.372] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon] Message [akka.cluster.GossipEnvelope] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon#-2084557458] to Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon#-53996821] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:18.776] [simpleAkkaCluster-akka.actor.default-dispatcher-25] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br></pre></td></tr></table></figure><p>断开后再次加入集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:46:56.861] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:46:57.054] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:46:57.055] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 11:46:57.069] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:46:57.184] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:46:57.184] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:46:57.210] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.375] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.378] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.379] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.379] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:58.227] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br></pre></td></tr></table></figure><h4 id="Node3日志"><a href="#Node3日志" class="headerlink" title="Node3日志"></a>Node3日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 11:45:17.020] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 11:45:17.213] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 11:45:17.215] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 11:45:17.226] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 11:45:17.332] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 11:45:17.332] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 11:45:17.359] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.544] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.549] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.550] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:17.551] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:45:19.381] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:46.368] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:48.777] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Exiting confirmed [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:48.779] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.806] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-13] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/endpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-3] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 11:46:48.806] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-1/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] -&gt; [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2552</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:49.365] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.GossipStatus] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon#-53996821] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:49.563] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#1010718345] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:50.573] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#1010718345] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:51.378] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Removed)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.342] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-1328666486]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.366] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 11:46:57.772] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br></pre></td></tr></table></figure><p>通过日志示例和服务端代码可以看到集群事件是通过MemberEvent传递的,这个其实就是每个成员所可能拥有的events,一个成员在它的生命周期中有以下的events:</p><ul><li>ClusterEvent.MemberJoined - 新的节点加入集群,此时的状态是Joining；</li><li>ClusterEvent.MemberUp - 新的节点加入集群,此时的状态是Up；</li><li>ClusterEvent.MemberExited - 节点正在离开集群,此时的状态是Exiting；</li><li>ClusterEvent.MemberRemoved - 节点已经离开集群,此时的状态是Removed；</li><li>ClusterEvent.UnreachableMember - 节点被标记为不可触达；</li><li>ClusterEvent.ReachableMember - 节点被标记为可触达；</li></ul><p>状态说明：</p><ul><li>Joining: 加入集群的瞬间状态</li><li>Up: 正常服务状态</li><li>Leaving / Exiting: 正常移出中状态</li><li>Down: 被标记为停机（不再是集群决策的一部分）</li><li>Removed: 已从集群中移除</li></ul><h3 id="代码示例-客户端"><a href="#代码示例-客户端" class="headerlink" title="代码示例(客户端)"></a>代码示例(客户端)</h3><p>示例中定义的客户端端口为:2600</p><h4 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = "INFO"</span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = "akka.cluster.ClusterActorRefProvider"</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    log-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = "172.30.5.13"</span><br><span class="line">      port = 2600</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = ["router", "client"]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2551",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2552",</span><br><span class="line">      "akka.tcp://simpleAkkaCluster@172.30.5.13:2553"]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    auto-down-unreachable-after = 5s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="客户端消息转发"><a href="#客户端消息转发" class="headerlink" title="客户端消息转发"></a>客户端消息转发</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatchActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务路径</span></span><br><span class="line">    <span class="keyword">private</span> String actorPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务集合</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ActorRef&gt; servers = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 集群监听</span></span><br><span class="line">    <span class="keyword">private</span> Cluster cluster = Cluster.get(context().system());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务地址统计</span></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DispatchActor</span><span class="params">(String actorPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.actorPath = actorPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cluster.subscribe(self(), ClusterEvent.MemberEvent.class, ClusterEvent.ReachabilityEvent.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cluster.unsubscribe(self());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x -&gt; servers.isEmpty(),</span><br><span class="line">                        x -&gt; sender().tell(<span class="keyword">new</span> Message.Result(-<span class="number">1L</span>, <span class="string">"服务暂不可用"</span>), sender())</span><br><span class="line">                )</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x -&gt; &#123;</span><br><span class="line">                            log().info(<span class="string">"[Dispatcher] [消息转发] 集群节点数量:&#123;&#125;, 待处理任务:&#123;&#125;"</span>, servers.size(), x.getTaskId());</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">int</span> index = count.incrementAndGet() % servers.size();</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;servers.size(); i++)&#123;</span><br><span class="line">                                System.out.println(<span class="string">"[Dispatcher][服务选取] 选中["</span> + (i == index)+<span class="string">"] 地址: "</span> + servers.get(i).path());</span><br><span class="line">                            &#125;</span><br><span class="line">                            System.out.println();</span><br><span class="line"></span><br><span class="line">                            servers.get(index).forward(x, getContext());</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                .match(Terminated.class,</span><br><span class="line">                        x -&gt; unRegister(x.getActor())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.CurrentClusterState.class, state -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 当前节点在刚刚加入集群时,会收到CurrentClusterState消息,从中可以解析出集群中的所有前端节点</span></span><br><span class="line">                    servers.clear();</span><br><span class="line">                    <span class="keyword">for</span> (Member member : state.getMembers()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (member.status().equals(MemberStatus.up())) &#123;</span><br><span class="line">                            register(member);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .match(ClusterEvent.MemberUp.class,</span><br><span class="line">                        x -&gt; register(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberEvent.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.UnreachableMember.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.ReachableMember.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != member &amp;&amp; member.hasRole(<span class="string">"server"</span>))&#123;</span><br><span class="line">            register(getContext().actorFor(member.address() + <span class="string">"/user/"</span> + <span class="keyword">this</span>.actorPath));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != member &amp;&amp; member.hasRole(<span class="string">"server"</span>))&#123;</span><br><span class="line">            unRegister(getContext().actorFor(member.address() + <span class="string">"/user/"</span> + <span class="keyword">this</span>.actorPath));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(ActorRef actorRef)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != actorRef)&#123;</span><br><span class="line">            servers.add(actorRef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(ActorRef actorRef)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != actorRef)&#123;</span><br><span class="line">            servers.remove(actorRef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="客户端主类"><a href="#客户端主类" class="headerlink" title="客户端主类"></a>客户端主类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskClusterClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"simpleAkkaCluster"</span>, ConfigFactory.load(<span class="string">"akka-client.conf"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 单节点处理</span></span><br><span class="line">        directorClient(system);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 集群处理</span></span><br><span class="line">        clusterClient(system);</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        system.terminate();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接指定特定节点处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">directorClient</span><span class="params">(ActorSystem system)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ActorRef directClient = system.actorFor(<span class="string">"akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Akka Direct Client 启动完成. "</span> + directClient.path());</span><br><span class="line">        remoteInvoke(<span class="string">"[指定处理]"</span>, directClient);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定集群处理(集群节点选组由Dispatcher处理)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clusterClient</span><span class="params">(ActorSystem system)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ActorRef clusterClient = system.actorOf(Props.create(DispatchActor.class, <span class="string">"taskActor"</span>), <span class="string">"clientActor"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Akka Cluster Client 启动完成. "</span> + clusterClient.path());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++)&#123;</span><br><span class="line">            System.out.println();</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            remoteInvoke(<span class="string">"[集群处理]"</span>, clusterClient);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 和远程端进行数据交互并获取处理结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> depict 交互类型描述</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endpoint 服务节点地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remoteInvoke</span><span class="params">(String depict, ActorRef endpoint)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Future&lt;Object&gt;&gt; futures = Lists.newArrayList();</span><br><span class="line">        Timeout timeout = <span class="keyword">new</span> Timeout(Duration.create(<span class="number">10</span>, TimeUnit.SECONDS));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">            String text = depict + <span class="string">"消息"</span> + i + UUID.randomUUID().toString();</span><br><span class="line">            Future&lt;Object&gt; future = Patterns.ask(endpoint, <span class="keyword">new</span> Message.Task(<span class="number">100L</span> +i, text), timeout);</span><br><span class="line">            futures.add(future);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Future&lt;Object&gt; future: futures)&#123;</span><br><span class="line">            Message.Result result = (Message.Result) Await.result(future, timeout.duration());</span><br><span class="line">            System.out.println(<span class="string">"服务端返回:"</span> + result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端分别演示了指定节点处理和基于集群处理.</p><h3 id="分布式计算"><a href="#分布式计算" class="headerlink" title="分布式计算"></a>分布式计算</h3><p>启动服务端: 分别启动服务端节点(Node1、Node2、Node3)、<br>启动客户端: 启动客户端主类模拟调用</p><h4 id="服务端日志"><a href="#服务端日志" class="headerlink" title="服务端日志"></a>服务端日志</h4><p>Node1日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:09:28.361] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:09:28.528] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 12:09:28.530] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span><br><span class="line">[INFO] [01/31/2018 12:09:28.541] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:09:28.658] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:09:28.658] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:09:28.684] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.775] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2552</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.775] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.777] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:28.777] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2552-0] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]] Caused by: [Connection refused: /172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:28.780] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:28.780] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:29.707] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:29.707] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:30.697] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:30.697] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:31.695] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:31.696] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:32.707] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:32.708] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/firstSeedNodeProcess-1#657073580] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:33.715] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:33.722] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:33.726] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.312] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-987896376]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.312] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/joinSeedNodeProcess-1#-987896376]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.353] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.354] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.696] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.696] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.491] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.491] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.703] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:49.694] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:49.696] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.697] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:23.693] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is moving node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:23.694] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.653] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息2fe9b091d-dbca-4a43-bb8f-4e11fa7db348","taskId":102&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-3</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:24.654] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Result] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息071a6714d-94af-47e2-b3e2-e298ca60e6f7","taskId":100&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息34ce25577-f548-4836-8f86-a7e789f3284f","taskId":103&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 12:10:27.698] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-4/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:31.694] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/cluster/core/daemon] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Marking node(s) as UNREACHABLE [Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)]. Node roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.696] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member detected as unreachable: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.727] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.728] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:36.711] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is auto-downing unreachable node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]. Don'</span>t use auto-down feature of Akka Cluster <span class="keyword">in</span> production. See <span class="string">'Auto-downing (DO NOT USE)'</span> section of Akka Cluster documentation.</span><br><span class="line">[INFO] [01/31/2018 12:10:36.712] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Marking unreachable node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] as [Down]</span><br><span class="line">[WARN] [01/31/2018 12:10:38.727] [New I/O boss <span class="comment">#3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line">[WARN] [01/31/2018 12:10:38.727] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated <span class="keyword">for</span> [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:39.684] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2551] - Leader is removing unreachable node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:39.686] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Removed)</span><br></pre></td></tr></table></figure><p>Node2日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:09:38.816] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:09:38.986] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 12:09:38.988] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span><br><span class="line">[INFO] [01/31/2018 12:09:39.009] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:09:39.126] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:09:39.126] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:09:39.150] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:39.236] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2553</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:09:39.237] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-6] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2553-1] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]] Caused by: [Connection refused: /172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.240] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction$InitJoin$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/joinSeedNodeProcess-1#-987896376] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.431] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2551]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.434] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.434] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:39.707] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.492] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.492] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/joinSeedNodeProcess-1#1412926543]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.520] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] is JOINING, roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.521] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:49.700] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.308] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.330] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] is JOINING, roles [router, client, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.331] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.651] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息0d5dbe1b1-5d5d-48cb-8279-7afc9d013633","taskId":100&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-19</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.652] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息338f8e10b-ac1a-4714-9642-8ee64cb4c31f","taskId":103&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-19</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:24.652] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Result] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:25.169] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息1104806a5-2a35-4328-ae7d-8d39052c5cf4","taskId":101&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-20</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.667] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息4113e1b57-d258-4ac4-96da-2dcdc531f823","taskId":104&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-23</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 12:10:27.695] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-7] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-4/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:28.450] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:29.453] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:30.452] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.452] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.162] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/cluster/core/daemon] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2552] - Marking node(s) as UNREACHABLE [Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)]. Node roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:32.164] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member detected as unreachable: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:32.451] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.457] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.457] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:33.458] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:34.451] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:35.450] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:36.450] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#145674424] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.455] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.457] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:40.168] [simpleAkkaCluster-akka.actor.default-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Removed)</span></span><br></pre></td></tr></table></figure><p>Node3日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:09:48.069] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:09:48.226] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 12:09:48.227] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span><br><span class="line">[INFO] [01/31/2018 12:09:48.238] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:09:48.338] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:09:48.338] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Started up successfully</span><br><span class="line">Akka Cluster Node1 启动完成akka://simpleAkkaCluster/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:09:48.361] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.537] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.541] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2551, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.541] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2552, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:48.541] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:09:50.169] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2553, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.320] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]] to [akka.tcp://simpleAkkaCluster@172.30.5.13:2553]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.321] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] to [Actor[akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/joinSeedNodeProcess-1#-1040563122]]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.428] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息0185c0218-8792-44a3-9bbe-c79fd5d1fe5e","taskId":100&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息1572b5e48-16dd-4137-92b8-604d92e1fe0e","taskId":101&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息2defa8129-a316-434d-a749-7081a5b11a50","taskId":102&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息375821f49-51e7-4530-8728-c05e96f334fc","taskId":103&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.429] [simpleAkkaCluster-akka.actor.default-dispatcher-21] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[指定处理]消息4764d693f-b803-4b6c-87db-a6c8dcd9ce68","taskId":104&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-21</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.430] [simpleAkkaCluster-akka.actor.default-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] ignore</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:22.430] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-13] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Result] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.373] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.571] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息15cbfbf9d-323d-428a-bbd5-dc66dec9b3e3","taskId":101&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.572] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息4f65324da-5eee-4815-9c3d-6541cfc09446","taskId":104&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.665] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] [接收消息]:&#123;"content":"[集群处理]消息2320bd63b-9911-49bb-a58a-2cc12eac733f","taskId":102&#125;, Actor:akka://simpleAkkaCluster/user/taskActor, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-15</span></span><br><span class="line"><span class="string">[ERROR] [01/31/2018 12:10:27.706] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-4/endpointWriter] AssociationError [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] &lt;- [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]: Error [Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600] [</span></span><br><span class="line"><span class="string">akka.remote.ShutDownAssociation: Shut down address: akka.tcp://simpleAkkaCluster@172.30.5.13:2600</span></span><br><span class="line"><span class="string">Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:28.558] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:29.558] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:30.558] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.369] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.GossipStatus] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon#-1409330530] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.558] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [5] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:31.708] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member detected as unreachable: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:32.371] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/cluster/core/daemon] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2553] - Marking node(s) as UNREACHABLE [Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Up)]. Node roles [server, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:32.557] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [6] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.565] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:33.565] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:33.566] [simpleAkkaCluster-akka.actor.default-dispatcher-23] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [7] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:34.558] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [8] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:35.557] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [9] dead letters encountered. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:36.558] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.ClusterHeartbeatSender$Heartbeat] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/heartbeatSender#2131930055] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [10] dead letters encountered, no more dead letters will be logged. This logging can be turned off or adjusted with configuration settings '</span>akka.log-dead-letters<span class="string">' and '</span>akka.log-dead-letters-during-shutdown<span class="string">'.</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.561] [New I/O boss #3] [NettyTransport(akka://simpleAkkaCluster)] Remote connection to [null] failed with java.net.ConnectException: Connection refused: /172.30.5.13:2600</span></span><br><span class="line"><span class="string">[WARN] [01/31/2018 12:10:39.562] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-13] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/system/endpointManager/reliableEndpointWriter-akka.tcp%3A%2F%2FsimpleAkkaCluster%40172.30.5.13%3A2600-5] Association with remote system [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]] Caused by: [Connection refused: /172.30.5.13:2600]</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:39.694] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor] Member is Removed: Member(address = akka.tcp://simpleAkkaCluster@172.30.5.13:2600, status = Removed)</span></span><br></pre></td></tr></table></figure><h4 id="客户端日志"><a href="#客户端日志" class="headerlink" title="客户端日志"></a>客户端日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [01/31/2018 12:10:21.847] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [01/31/2018 12:10:22.021] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://simpleAkkaCluster@172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:22.022] [main] [akka.remote.Remoting] Remoting now listens on addresses: [akka.tcp://simpleAkkaCluster@172.30.5.13:2600]</span><br><span class="line">[INFO] [01/31/2018 12:10:22.036] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Starting up...</span><br><span class="line">[INFO] [01/31/2018 12:10:22.148] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [01/31/2018 12:10:22.148] [main] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Started up successfully</span><br><span class="line">Akka Direct Client 启动完成. akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span><br><span class="line">[WARN] [01/31/2018 12:10:22.179] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/cluster/core/daemon/downingProvider] Don<span class="string">'t use auto-down feature of Akka Cluster in production. See '</span>Auto-downing (DO NOT USE)<span class="string">' section of Akka Cluster documentation.</span></span><br><span class="line"><span class="string">[WARN] [SECURITY][01/31/2018 12:10:22.288] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-14] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer for class [com.elonsu.cluster.akka.Message$Task] which is not recommended because of performance implications. Use another serializer or disable this warning using the setting '</span>akka.actor.warn-about-java-serializer-usage<span class="string">'</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:22.351] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@172.30.5.13:2600] - Welcome from [akka.tcp://simpleAkkaCluster@172.30.5.13:2552]</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息0185c0218-8792-44a3-9bbe-c79fd5d1fe5e处理完成","taskId":100&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息1572b5e48-16dd-4137-92b8-604d92e1fe0e处理完成","taskId":101&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息2defa8129-a316-434d-a749-7081a5b11a50处理完成","taskId":102&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息375821f49-51e7-4530-8728-c05e96f334fc处理完成","taskId":103&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[指定处理]消息4764d693f-b803-4b6c-87db-a6c8dcd9ce68处理完成","taskId":104&#125;</span></span><br><span class="line"><span class="string">Akka Cluster Client 启动完成. akka://simpleAkkaCluster/user/clientActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.567] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:100</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.568] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:101</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.568] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:102</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.568] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:103</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:24.569] [simpleAkkaCluster-akka.actor.default-dispatcher-17] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:104</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息0d5dbe1b1-5d5d-48cb-8279-7afc9d013633处理完成","taskId":100&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息15cbfbf9d-323d-428a-bbd5-dc66dec9b3e3处理完成","taskId":101&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息2fe9b091d-dbca-4a43-bb8f-4e11fa7db348处理完成","taskId":102&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息338f8e10b-ac1a-4714-9642-8ee64cb4c31f处理完成","taskId":103&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息4f65324da-5eee-4815-9c3d-6541cfc09446处理完成","taskId":104&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.662] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:100</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.662] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:101</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.662] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:102</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2551/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[true] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2552/user/taskActor</span></span><br><span class="line"><span class="string">[Dispatcher][服务选取] 选中[false] 地址: akka.tcp://simpleAkkaCluster@172.30.5.13:2553/user/taskActor</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.663] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:103</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:26.663] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/user/clientActor] [Dispatcher] [消息转发] 集群节点数量:3, 待处理任务:104</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息071a6714d-94af-47e2-b3e2-e298ca60e6f7处理完成","taskId":100&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息1104806a5-2a35-4328-ae7d-8d39052c5cf4处理完成","taskId":101&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息2320bd63b-9911-49bb-a58a-2cc12eac733f处理完成","taskId":102&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息34ce25577-f548-4836-8f86-a7e789f3284f处理完成","taskId":103&#125;</span></span><br><span class="line"><span class="string">服务端返回:&#123;"result":"[集群处理]消息4113e1b57-d258-4ac4-96da-2dcdc531f823处理完成","taskId":104&#125;</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.683] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/remoting-terminator] Shutting down remote daemon.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.684] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/remoting-terminator] Remote daemon shut down; proceeding with flushing remote transports.</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.710] [simpleAkkaCluster-akka.actor.default-dispatcher-20] [akka.remote.Remoting] Remoting shut down</span></span><br><span class="line"><span class="string">[INFO] [01/31/2018 12:10:27.711] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.tcp://simpleAkkaCluster@172.30.5.13:2600/system/remoting-terminator] Remoting shut down.</span></span><br></pre></td></tr></table></figure><h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><ul><li><a href="http://www.cnblogs.com/tiger-xc/p/7082905.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiger-xc/p/7082905.html</a></li><li><a href="http://blog.csdn.net/tiger_xc/article/details/72857967" target="_blank" rel="noopener">http://blog.csdn.net/tiger_xc/article/details/72857967</a></li><li><a href="http://blog.csdn.net/zhanglh046/article/details/78621376" target="_blank" rel="noopener">http://blog.csdn.net/zhanglh046/article/details/78621376</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;介绍&lt;code&gt;Akka-Cluster&lt;/code&gt;前 需要先说一下&lt;code&gt;Akka-Remoting&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Akka-Remoting&lt;/code&gt;一种ActorSystem之间Actor对Actor点对点的沟通协议.通过Akka-Remoting来实现一个ActorSystem中的一个Actor与另一个ActorSystem中的另一个Actor之间的沟通.在Remoting功能之后,Akka又发展了集群Cluster功能.&lt;br&gt;&lt;code&gt;Akka-Cluster&lt;/code&gt;是基于Akka-Remoting之上的新一代分布式运算环境,所以Remoting已经成为了Akka-Cluster的内部支持功能,在生产环境中的分布式运算应该尽量使用Akka-Cluster; Akka-Cluster可以在一部物理机或一组网络连接的服务器上搭建部署.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单来说Akka-Cluster将多个JVM连接整合起来,实现消息地址的透明化和统一化使用管理,集成一体化的消息驱动系统.最终目的是能够把一个大型程序分割成多个子程序,然后部署到很多JVM上去实现程序的分布式并行运算.更重要的是：Cluster的构建过程与Actor编程没有牵连,当Cluster把多个ActorSystem集合成一个统一系统后,我们可以用在单一ActorSystem里编程的习惯方式编写分布式运算程序.由于在单一机器上就可以配置多个节点形成一个集群,我们开发的分布式程序可以在单机或多机群上运行,不同的只是如何部署和配置集群环境.&lt;/p&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Akka" scheme="http://dennisit.github.io/tags/Akka/"/>
    
  </entry>
  
  <entry>
    <title>Akka与Spring整合应用</title>
    <link href="http://dennisit.github.io/2017/02/01/%E7%BB%84%E4%BB%B6%E6%A1%86%E6%9E%B6/Akka/Akka%E4%B8%8ESpring%E6%95%B4%E5%90%88%E5%BA%94%E7%94%A8/"/>
    <id>http://dennisit.github.io/2017/02/01/组件框架/Akka/Akka与Spring整合应用/</id>
    <published>2017-02-01T11:57:53.000Z</published>
    <updated>2018-12-12T00:08:46.490Z</updated>
    
    <content type="html"><![CDATA[<p>本篇集合Akka应用-分布式计算应用展示在Spring项目中做分布式计算.</p><h3 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost spring-akka ]$ tree akka-task</span><br><span class="line">akka-task</span><br><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   └── main</span><br><span class="line">│       ├── java</span><br><span class="line">│       │   └── com</span><br><span class="line">│       │       └── elonsu</span><br><span class="line">│       │           └── cluster</span><br><span class="line">│       │               └── akka</span><br><span class="line">│       │                   ├── Application.java</span><br><span class="line">│       │                   └── spring</span><br><span class="line">│       │                       ├── actor</span><br><span class="line">│       │                       │   ├── Message.java</span><br><span class="line">│       │                       │   ├── RouterActor.java</span><br><span class="line">│       │                       │   └── SimpleActor.java</span><br><span class="line">│       │                       ├── config</span><br><span class="line">│       │                       │   ├── ClientConfig.java</span><br><span class="line">│       │                       │   └── ServerConfig.java</span><br><span class="line">│       │                       ├── controller</span><br><span class="line">│       │                       │   └── AkkaController.java</span><br><span class="line">│       │                       └── support</span><br><span class="line">│       │                           ├── SpringActorProducer.java</span><br><span class="line">│       │                           └── SpringExtension.java</span><br><span class="line">│       └── resources</span><br><span class="line">│           ├── akka-client.conf</span><br><span class="line">│           └── akka-server.conf</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">akka.version</span>&gt;</span>2.5.9<span class="tag">&lt;/<span class="name">akka.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">guava.version</span>&gt;</span>18.0<span class="tag">&lt;/<span class="name">guava.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-cluster_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;akka.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-actor_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;akka.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>akka-remote_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;akka.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;guava.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明"></a>模块说明</h3><p>消息相关</p><ul><li>Message: 示例中客户端和服务端通讯的消息定义</li></ul><p>服务端相关</p><ul><li>SimpleActor: 服务端事件处理类</li><li>ServerConfig : 服务端实例化配置</li><li>akka-server.conf : 服务端配置</li></ul><p>客户端相关</p><ul><li>RouterActor: 消息投递转发类, 用于对于服务端节点进行选取和消息投递</li><li>ClientConfig: 客户端端实例化配置</li><li>akka-client.conf : 客户端配置</li></ul><p>应用启动类</p><ul><li>Application: SpringBoot应用主类</li></ul><p>容器衔接</p><ul><li>SpringActorProducer &amp; SpringExtension: IndirectActorProducer是Akka提供的Actor生成接口, SpringActorProducer实现该接口, 以ApplicationContextAware为代理生成我们需要的Actor的Props</li></ul><h3 id="模块代码"><a href="#模块代码" class="headerlink" title="模块代码"></a>模块代码</h3><h4 id="Spring衔接"><a href="#Spring衔接" class="headerlink" title="Spring衔接"></a>Spring衔接</h4><p><code>SpringActorProducer</code>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringActorProducer</span> <span class="keyword">implements</span> <span class="title">IndirectActorProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> ApplicationContext applicationContext;</span><br><span class="line">    <span class="keyword">final</span> String actorBeanName;</span><br><span class="line">    <span class="keyword">final</span> Object[] args;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringActorProducer</span><span class="params">(ApplicationContext applicationContext, String actorBeanName, Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">        <span class="keyword">this</span>.actorBeanName = actorBeanName;</span><br><span class="line">        <span class="keyword">this</span>.args = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Actor <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Actor) applicationContext.getBean(actorBeanName, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;? extends Actor&gt; actorClass() &#123;</span><br><span class="line">        <span class="keyword">return</span> (Class&lt;? extends Actor&gt;) applicationContext.getType(actorBeanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SpringExtension</code>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringExtension</span> <span class="keyword">extends</span> <span class="title">AbstractExtensionId</span>&lt;<span class="title">SpringExtension</span>.<span class="title">SpringExt</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SpringExtension INSTANCE = <span class="keyword">new</span> SpringExtension();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringExt <span class="title">createExtension</span><span class="params">(ExtendedActorSystem system)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringExt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringExt</span> <span class="keyword">implements</span> <span class="title">Extension</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Props <span class="title">props</span><span class="params">(String actorBeanName, Object... args)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Props.create(SpringActorProducer.class, applicationContext, actorBeanName, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure><h4 id="消息定义"><a href="#消息定义" class="headerlink" title="消息定义"></a>消息定义</h4><p>说明: 消息定义必须实现序列化接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span>  taskId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> taskId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String result;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.toJSONString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>服务端配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">      port = 2555</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"server"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@127.0.0.1:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">      port = 2556</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"router"</span>, <span class="string">"client"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@127.0.0.1:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Actor示例"><a href="#Actor示例" class="headerlink" title="Actor示例"></a>Actor示例</h4><p>服务端消息处理Actor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 集群监听</span></span><br><span class="line">    <span class="keyword">private</span> Cluster cluster = Cluster.get(getContext().system());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//subscribe to cluster changes</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//#subscribe</span></span><br><span class="line">        cluster.subscribe(getSelf(), ClusterEvent.initialStateAsEvents(),</span><br><span class="line">                ClusterEvent.MemberEvent.class, ClusterEvent.UnreachableMember.class);</span><br><span class="line">        <span class="comment">//#subscribe</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//re-subscribe when restart</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cluster.unsubscribe(getSelf());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x-&gt; &#123;</span><br><span class="line">                            log().info(<span class="string">"[接收消息]:&#123;&#125;, Actor:&#123;&#125;, Thread:&#123;&#125;"</span>, x, getSelf().path(), Thread.currentThread().getName());</span><br><span class="line">                            getSender().tell(<span class="keyword">new</span> Message.Result(x.getTaskId(), x.getContent() + <span class="string">"处理完成"</span>), self());</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberUp.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member is Up: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.CurrentClusterState.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Cluster State: &#123;&#125;"</span>, x.getMembers())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.UnreachableMember.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member detected as unreachable: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberRemoved.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"Member is Removed: &#123;&#125;"</span>, x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberEvent.class,</span><br><span class="line">                        x -&gt; log().info(<span class="string">"ignore"</span>)</span><br><span class="line">                )</span><br><span class="line">                .matchAny(</span><br><span class="line">                        x -&gt; unhandled(x)</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端路由分发Actor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouterActor</span> <span class="keyword">extends</span> <span class="title">AbstractLoggingActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务集合</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ActorRef&gt; servers = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 集群监听</span></span><br><span class="line">    <span class="keyword">private</span> Cluster cluster = Cluster.get(context().system());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String actorPath;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RouterActor</span><span class="params">(String actorPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.actorPath = actorPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cluster.subscribe(self(), ClusterEvent.MemberEvent.class, ClusterEvent.ReachabilityEvent.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cluster.unsubscribe(self());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Receive <span class="title">createReceive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> receiveBuilder()</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x -&gt; servers.isEmpty(),</span><br><span class="line">                        x -&gt; sender().tell(<span class="keyword">new</span> Message.Result(-<span class="number">1L</span>, <span class="string">"服务暂不可用"</span>), sender())</span><br><span class="line">                )</span><br><span class="line">                .match(Message.Task.class,</span><br><span class="line">                        x -&gt; &#123;</span><br><span class="line">                            log().info(<span class="string">"[Dispatcher][消息转发] 集群节点数量:&#123;&#125;, 待处理任务:&#123;&#125;"</span>, servers.size(), x.getTaskId());</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">int</span> index = count.incrementAndGet() % servers.size();</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;servers.size(); i++)&#123;</span><br><span class="line">                                log().info(<span class="string">"[Dispatcher][服务选取] 选中["</span> + (i == index) + <span class="string">"] 地址: "</span> + servers.get(i).path());</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">//System.out.println();</span></span><br><span class="line">                            servers.get(index).forward(x, getContext());</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                .match(Terminated.class,</span><br><span class="line">                        x -&gt; unRegister(x.getActor())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.CurrentClusterState.class, state -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 当前节点在刚刚加入集群时，会收到CurrentClusterState消息，从中可以解析出集群中的所有前端节点</span></span><br><span class="line">                    servers.clear();</span><br><span class="line">                    <span class="keyword">for</span> (Member member : state.getMembers()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (member.status().equals(MemberStatus.up())) &#123;</span><br><span class="line">                            register(member);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .match(ClusterEvent.MemberUp.class,</span><br><span class="line">                        x -&gt; register(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.MemberEvent.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.UnreachableMember.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                )</span><br><span class="line">                .match(ClusterEvent.ReachableMember.class,</span><br><span class="line">                        x -&gt; unRegister(x.member())</span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != member &amp;&amp; member.hasRole(<span class="string">"server"</span>))&#123;</span><br><span class="line">            register(getContext().actorFor(member.address() + <span class="string">"/user/"</span> + <span class="keyword">this</span>.actorPath));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != member &amp;&amp; member.hasRole(<span class="string">"server"</span>))&#123;</span><br><span class="line">            unRegister(getContext().actorFor(member.address() + <span class="string">"/user/"</span> + <span class="keyword">this</span>.actorPath));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(ActorRef actorRef)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != actorRef)&#123;</span><br><span class="line">            servers.add(actorRef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(ActorRef actorRef)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != actorRef)&#123;</span><br><span class="line">            servers.remove(actorRef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActorPath</span><span class="params">(String actorPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.actorPath = actorPath;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="集群实例化"><a href="#集群实例化" class="headerlink" title="集群实例化"></a>集群实例化</h4><p>服务端注解实例化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Config config;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        load(<span class="string">"akka-server.conf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(String resource)</span></span>&#123;</span><br><span class="line">        config = ConfigFactory.load(<span class="keyword">this</span>.getClass().getClassLoader(), resource);</span><br><span class="line">        List&lt;String&gt; roles = config.getStringList(<span class="string">"akka.cluster.roles"</span>);</span><br><span class="line">        log.info(<span class="string">"[Cluster Client][Role] :&#123;&#125;"</span>, roles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"serverSystem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActorSystem <span class="title">actorSystem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"simpleAkkaCluster"</span>, config);</span><br><span class="line">        <span class="comment">// initialize the application context in the Akka Spring Extension</span></span><br><span class="line">        SpringExtension.INSTANCE.get(system).initialize(applicationContext);</span><br><span class="line">        log.info(<span class="string">"[Cluster Client] [System] &#123;&#125;"</span>, system.name());</span><br><span class="line">        <span class="keyword">return</span> system;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"serverActor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActorRef <span class="title">actorRef</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ActorSystem system = actorSystem();</span><br><span class="line">        ActorRef ebIndexActor = system.actorOf(</span><br><span class="line">                SpringExtension.INSTANCE.get(system).props(<span class="string">"simpleActor"</span>),</span><br><span class="line">                <span class="string">"SimpleEcho"</span>);</span><br><span class="line">        log.info(<span class="string">"[Cluster Server Node] [Loaded] &#123;&#125; "</span>, ebIndexActor.path());</span><br><span class="line">        <span class="keyword">return</span> ebIndexActor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端注解实例化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Config config;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        load(<span class="string">"akka-client.conf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(String resource)</span></span>&#123;</span><br><span class="line">        config = ConfigFactory.load(<span class="keyword">this</span>.getClass().getClassLoader(), resource);</span><br><span class="line">        List&lt;String&gt; roles = config.getStringList(<span class="string">"akka.cluster.roles"</span>);</span><br><span class="line">        log.info(<span class="string">"[Cluster Client][Role] :&#123;&#125;"</span>, roles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"clientSystem"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActorSystem <span class="title">actorSystem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"simpleAkkaCluster"</span>, config);</span><br><span class="line">        <span class="comment">// initialize the application context in the Akka Spring Extension</span></span><br><span class="line">        SpringExtension.INSTANCE.get(system).initialize(applicationContext);</span><br><span class="line">        log.info(<span class="string">"[Cluster Client] [System] &#123;&#125;"</span>, system.name());</span><br><span class="line">        <span class="keyword">return</span> system;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"clientActor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActorRef <span class="title">actorRef</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ActorSystem system = actorSystem();</span><br><span class="line">        ActorRef clientActor = system.actorOf(SpringExtension.INSTANCE.get(system).props(<span class="string">"routerActor"</span>, <span class="string">"SimpleEcho"</span>), <span class="string">"clientActor"</span>);</span><br><span class="line">        log.info(<span class="string">"[Cluster Client Node] [Loaded] &#123;&#125; "</span>, clientActor.path());</span><br><span class="line">        <span class="keyword">return</span> clientActor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Rest测试类"><a href="#Rest测试类" class="headerlink" title="Rest测试类"></a>Rest测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/akka"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AkkaController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"clientActor"</span>)</span><br><span class="line">    <span class="keyword">private</span> ActorRef clientActor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 和远程端进行数据交互并获取处理结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/cluster/event"</span>, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">clusterEvent</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">"[Client] path:&#123;&#125;"</span>, clientActor.path());</span><br><span class="line"></span><br><span class="line">        List&lt;Future&lt;Object&gt;&gt; futures = Lists.newArrayList();</span><br><span class="line">        Timeout timeout = <span class="keyword">new</span> Timeout(Duration.create(<span class="number">50</span>, TimeUnit.SECONDS));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">            String text = <span class="string">"集群消息"</span> + i + UUID.randomUUID().toString();</span><br><span class="line">            Future&lt;Object&gt; future = Patterns.ask(clientActor, <span class="keyword">new</span> Message.Task(<span class="number">100L</span> +i, text), timeout);</span><br><span class="line">            futures.add(future);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Future&lt;Object&gt; future: futures)&#123;</span><br><span class="line">            Message.Result result = (Message.Result) Await.result(future, timeout.duration());</span><br><span class="line">            System.out.println(<span class="string">"服务端返回:"</span> + result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">"test"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SpringBoot主类"><a href="#SpringBoot主类" class="headerlink" title="SpringBoot主类"></a>SpringBoot主类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">        log.info(<span class="string">"[启动成功] 应用名称: &#123;&#125;"</span>, <span class="string">"Akka Spring Boot"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h3><p>启动SpringBoot应用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2018-02-05 17:54:13.586  INFO 6523 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)</span><br><span class="line">2018-02-05 17:54:13.594  INFO 6523 --- [           main] com.elonsu.cluster.akka.Application      : Started Application <span class="keyword">in</span> 4.948 seconds (JVM running <span class="keyword">for</span> 6.118)</span><br><span class="line">2018-02-05 17:54:13.594  INFO 6523 --- [           main] com.elonsu.cluster.akka.Application      : [启动成功] 应用名称: Akka Spring Boot</span><br><span class="line">[INFO] [02/05/2018 17:54:17.602] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka://simpleAkkaCluster/deadLetters] Message [akka.cluster.InternalClusterAction<span class="variable">$InitJoin</span>$] from Actor[akka://simpleAkkaCluster/system/cluster/core/daemon/joinSeedNodeProcess-1<span class="comment">#-1342745044] to Actor[akka://simpleAkkaCluster/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.</span></span><br><span class="line">[WARN] [02/05/2018 17:54:22.622] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/system/cluster/core/daemon/joinSeedNodeProcess-1] Couldn<span class="string">'t join seed nodes after [2] attempts, will try again. seed-nodes=[akka.tcp://simpleAkkaCluster@127.0.0.1:2555]</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.698] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@127.0.0.1:2555] - Received InitJoin message from [Actor[akka.tcp://simpleAkkaCluster@127.0.0.1:2556/system/cluster/core/daemon/joinSeedNodeProcess-1#-1342745044]] to [akka.tcp://simpleAkkaCluster@127.0.0.1:2555]</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.698] [simpleAkkaCluster-akka.actor.default-dispatcher-3] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@127.0.0.1:2555] - Sending InitJoinAck message from node [akka.tcp://simpleAkkaCluster@127.0.0.1:2555] to [Actor[akka.tcp://simpleAkkaCluster@127.0.0.1:2556/system/cluster/core/daemon/joinSeedNodeProcess-1#-1342745044]]</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.721] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@127.0.0.1:2555] - Node [akka.tcp://simpleAkkaCluster@127.0.0.1:2556] is JOINING, roles [router, client, dc-default]</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.723] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] ignore</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.726] [simpleAkkaCluster-akka.actor.default-dispatcher-19] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@127.0.0.1:2555] - Leader is moving node [akka.tcp://simpleAkkaCluster@127.0.0.1:2556] to [Up]</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.726] [simpleAkkaCluster-akka.actor.default-dispatcher-24] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] Member is Up: Member(address = akka.tcp://simpleAkkaCluster@127.0.0.1:2556, status = Up)</span></span><br><span class="line"><span class="string">[INFO] [02/05/2018 17:54:22.828] [simpleAkkaCluster-akka.actor.default-dispatcher-15] [akka.cluster.Cluster(akka://simpleAkkaCluster)] Cluster Node [akka.tcp://simpleAkkaCluster@127.0.0.1:2556] - Welcome from [akka.tcp://simpleAkkaCluster@127.0.0.1:2555</span></span><br></pre></td></tr></table></figure><p>访问接口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost spring-akka ]$ curl http://localhost:8080/api/akka/cluster/event</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>交互日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">2018-02-05 17:55:37.462  INFO 6523 --- [nio-8080-exec-9] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring FrameworkServlet <span class="string">'dispatcherServlet'</span></span><br><span class="line">2018-02-05 17:55:37.462  INFO 6523 --- [nio-8080-exec-9] o.s.web.servlet.DispatcherServlet        : FrameworkServlet <span class="string">'dispatcherServlet'</span>: initialization started</span><br><span class="line">2018-02-05 17:55:37.490  INFO 6523 --- [nio-8080-exec-9] o.s.web.servlet.DispatcherServlet        : FrameworkServlet <span class="string">'dispatcherServlet'</span>: initialization completed <span class="keyword">in</span> 28 ms</span><br><span class="line">2018-02-05 17:55:37.523  INFO 6523 --- [nio-8080-exec-9] c.e.c.a.s.controller.AkkaController      : [Client] path:akka://simpleAkkaCluster/user/clientActor</span><br><span class="line">[INFO] [02/05/2018 17:55:37.526] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:100</span><br><span class="line">[INFO] [02/05/2018 17:55:37.526] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:101</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:102</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:103</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:104</span><br><span class="line">[INFO] [02/05/2018 17:55:37.527] [simpleAkkaCluster-akka.actor.default-dispatcher-4] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[WARN] [SECURITY][02/05/2018 17:55:37.528] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-18] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer <span class="keyword">for</span> class [com.elonsu.cluster.akka.spring.actor.Message<span class="variable">$Task</span>] <span class="built_in">which</span> is not recommended because of performance implications. Use another serializer or <span class="built_in">disable</span> this warning using the setting <span class="string">'akka.actor.warn-about-java-serializer-usage'</span></span><br><span class="line">[INFO] [02/05/2018 17:55:37.616] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息0526add9d-29ba-409f-ae74-cc7b61606613"</span>,<span class="string">"taskId"</span>:100&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-16</span><br><span class="line">[INFO] [02/05/2018 17:55:37.616] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息16d03f841-67d4-4169-b747-dc0a8f2e02dd"</span>,<span class="string">"taskId"</span>:101&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-16</span><br><span class="line">[INFO] [02/05/2018 17:55:37.616] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息25c2c2579-71c5-45a8-97e6-434a95a186df"</span>,<span class="string">"taskId"</span>:102&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-16</span><br><span class="line">[INFO] [02/05/2018 17:55:37.617] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息3f4ad2fe3-d624-416d-a01a-e346914fcbbb"</span>,<span class="string">"taskId"</span>:103&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-16</span><br><span class="line">[INFO] [02/05/2018 17:55:37.617] [simpleAkkaCluster-akka.actor.default-dispatcher-16] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息421b5b619-345d-4eb0-8682-df8955ea70df"</span>,<span class="string">"taskId"</span>:104&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-16</span><br><span class="line">[WARN] [SECURITY][02/05/2018 17:55:37.617] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-21] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer <span class="keyword">for</span> class [com.elonsu.cluster.akka.spring.actor.Message<span class="variable">$Result</span>] <span class="built_in">which</span> is not recommended because of performance implications. Use another serializer or <span class="built_in">disable</span> this warning using the setting <span class="string">'akka.actor.warn-about-java-serializer-usage'</span></span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息0526add9d-29ba-409f-ae74-cc7b61606613处理完成"</span>,<span class="string">"taskId"</span>:100&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息16d03f841-67d4-4169-b747-dc0a8f2e02dd处理完成"</span>,<span class="string">"taskId"</span>:101&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息25c2c2579-71c5-45a8-97e6-434a95a186df处理完成"</span>,<span class="string">"taskId"</span>:102&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息3f4ad2fe3-d624-416d-a01a-e346914fcbbb处理完成"</span>,<span class="string">"taskId"</span>:103&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息421b5b619-345d-4eb0-8682-df8955ea70df处理完成"</span>,<span class="string">"taskId"</span>:104&#125;</span><br></pre></td></tr></table></figure><h3 id="集群部署"><a href="#集群部署" class="headerlink" title="集群部署"></a>集群部署</h3><p>上面示例演示的在同一台机器上的不同端口进行通讯. 接下来演示在多台机器上的不同配置</p><p>服务端配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      port = 2555</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"server"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@192.168.0.101:2555"</span>,</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@192.168.0.102:2555"</span>,</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@192.168.0.103:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      port = 2556</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"router"</span>, <span class="string">"client"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@192.168.0.101:2555"</span>,</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@192.168.0.102:2555"</span>,</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@192.168.0.103:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相对于单节点配置,不同的是示例中服务节点都配置为不同IP, 同时摘掉了绑定的<code>akka.remote.netty.tcp.hostname</code>, 让Akka自动获取实例的通讯IP进行绑定.</p><h3 id="配置Dispatcher"><a href="#配置Dispatcher" class="headerlink" title="配置Dispatcher"></a>配置Dispatcher</h3><h4 id="客户端配置重定义默认的default-dispatcher"><a href="#客户端配置重定义默认的default-dispatcher" class="headerlink" title="客户端配置重定义默认的default-dispatcher"></a>客户端配置重定义默认的<code>default-dispatcher</code></h4><p>配置thread-pool默认默认</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># default dispatcher</span></span><br><span class="line">    default-dispatcher &#123;</span><br><span class="line">      <span class="built_in">type</span> = <span class="string">"Dispatcher"</span></span><br><span class="line">      <span class="comment"># What kind of ExecutionService to use</span></span><br><span class="line">      executor = <span class="string">"thread-pool-executor"</span></span><br><span class="line">      <span class="comment"># Configuration for the thread pool</span></span><br><span class="line">      thread-pool-executor &#123;</span><br><span class="line">        <span class="comment"># minimum number of threads to cap factor-based core number to</span></span><br><span class="line">        core-pool-size-min = 3</span><br><span class="line">        <span class="comment"># No of core threads ... ceil(available processors * factor)</span></span><br><span class="line">        core-pool-size-factor = 2.0</span><br><span class="line">        <span class="comment"># maximum number of threads to cap factor-based number to</span></span><br><span class="line">        core-pool-size-max = 10</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment"># Throughput defines the maximum number of messages to be</span></span><br><span class="line">      <span class="comment"># processed per actor before the thread jumps to the next actor.</span></span><br><span class="line">      <span class="comment"># Set to 1 for as fair as possible.</span></span><br><span class="line">      throughput = 20</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">      port = 2556</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"router"</span>, <span class="string">"client"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@127.0.0.1:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">2018-02-06 11:49:28.222  INFO 2218 --- [nio-8080-exec-7] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring FrameworkServlet <span class="string">'dispatcherServlet'</span></span><br><span class="line">2018-02-06 11:49:28.223  INFO 2218 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : FrameworkServlet <span class="string">'dispatcherServlet'</span>: initialization started</span><br><span class="line">2018-02-06 11:49:28.238  INFO 2218 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : FrameworkServlet <span class="string">'dispatcherServlet'</span>: initialization completed <span class="keyword">in</span> 15 ms</span><br><span class="line">2018-02-06 11:49:28.260  INFO 2218 --- [nio-8080-exec-7] c.e.c.a.s.controller.AkkaController      : [Client] path:akka://simpleAkkaCluster/user/clientActor</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:100</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:101</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:102</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:103</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:104</span><br><span class="line">[INFO] [02/06/2018 11:49:28.262] [simpleAkkaCluster-akka.actor.default-dispatcher-9] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[WARN] [SECURITY][02/06/2018 11:49:28.263] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-11] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer <span class="keyword">for</span> class [com.elonsu.cluster.akka.spring.actor.Message<span class="variable">$Task</span>] <span class="built_in">which</span> is not recommended because of performance implications. Use another serializer or <span class="built_in">disable</span> this warning using the setting <span class="string">'akka.actor.warn-about-java-serializer-usage'</span></span><br><span class="line">[INFO] [02/06/2018 11:49:28.329] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息06ab614d0-f50d-4c6c-b91d-7b5af1e98187"</span>,<span class="string">"taskId"</span>:100&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-22</span><br><span class="line">[INFO] [02/06/2018 11:49:28.330] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息1057874e5-1219-4bea-81f5-5612707bf83d"</span>,<span class="string">"taskId"</span>:101&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-22</span><br><span class="line">[INFO] [02/06/2018 11:49:28.330] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息2467e56fa-e2dd-493a-a583-cf0496bbb96f"</span>,<span class="string">"taskId"</span>:102&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-22</span><br><span class="line">[INFO] [02/06/2018 11:49:28.330] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息3ccad0171-99b4-4384-b836-72115304f77a"</span>,<span class="string">"taskId"</span>:103&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-22</span><br><span class="line">[INFO] [02/06/2018 11:49:28.330] [simpleAkkaCluster-akka.actor.default-dispatcher-22] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息427786c84-4971-4f4d-9c52-a4975b9548bf"</span>,<span class="string">"taskId"</span>:104&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-22</span><br><span class="line">[WARN] [SECURITY][02/06/2018 11:49:28.330] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer <span class="keyword">for</span> class [com.elonsu.cluster.akka.spring.actor.Message<span class="variable">$Result</span>] <span class="built_in">which</span> is not recommended because of performance implications. Use another serializer or <span class="built_in">disable</span> this warning using the setting <span class="string">'akka.actor.warn-about-java-serializer-usage'</span></span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息06ab614d0-f50d-4c6c-b91d-7b5af1e98187处理完成"</span>,<span class="string">"taskId"</span>:100&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息1057874e5-1219-4bea-81f5-5612707bf83d处理完成"</span>,<span class="string">"taskId"</span>:101&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息2467e56fa-e2dd-493a-a583-cf0496bbb96f处理完成"</span>,<span class="string">"taskId"</span>:102&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息3ccad0171-99b4-4384-b836-72115304f77a处理完成"</span>,<span class="string">"taskId"</span>:103&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息427786c84-4971-4f4d-9c52-a4975b9548bf处理完成"</span>,<span class="string">"taskId"</span>:104&#125;</span><br></pre></td></tr></table></figure><p>配置fork-join默认默认</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self defined dispatcher</span></span><br><span class="line">    default-dispatcher &#123;</span><br><span class="line">      <span class="built_in">type</span> = <span class="string">"Dispatcher"</span></span><br><span class="line">      <span class="comment"># What kind of ExecutionService to use</span></span><br><span class="line">      executor = <span class="string">"fork-join-executor"</span></span><br><span class="line">      <span class="comment"># Configuration for the fork join pool</span></span><br><span class="line">      fork-join-executor &#123;</span><br><span class="line">        <span class="comment"># Min number of threads to cap factor-based parallelism number to</span></span><br><span class="line">        parallelism-min = 2</span><br><span class="line">        <span class="comment"># Parallelism (threads) ... ceil(available processors * factor)</span></span><br><span class="line">        parallelism-factor = 2.0</span><br><span class="line">        <span class="comment"># Max number of threads to cap factor-based parallelism number to</span></span><br><span class="line">        parallelism-max = 10</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment"># Throughput defines the maximum number of messages to be</span></span><br><span class="line">      <span class="comment"># processed per actor before the thread jumps to the next actor.</span></span><br><span class="line">      <span class="comment"># Set to 1 for as fair as possible.</span></span><br><span class="line">      throughput = 20</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">      port = 2556</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"router"</span>, <span class="string">"client"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@127.0.0.1:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="客户端配置自定义Dispatcher"><a href="#客户端配置自定义Dispatcher" class="headerlink" title="客户端配置自定义Dispatcher"></a>客户端配置自定义Dispatcher</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  loglevel = <span class="string">"INFO"</span></span><br><span class="line"></span><br><span class="line">  actor &#123;</span><br><span class="line">    provider = <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># self defined dispatcher</span></span><br><span class="line">    thread-pool-dispatcher &#123;</span><br><span class="line">      <span class="built_in">type</span> = <span class="string">"Dispatcher"</span></span><br><span class="line">      <span class="comment"># What kind of ExecutionService to use</span></span><br><span class="line">      executor = <span class="string">"thread-pool-executor"</span></span><br><span class="line">      <span class="comment"># Configuration for the thread pool</span></span><br><span class="line">      thread-pool-executor &#123;</span><br><span class="line">        <span class="comment"># minimum number of threads to cap factor-based core number to</span></span><br><span class="line">        core-pool-size-min = 3</span><br><span class="line">        <span class="comment"># No of core threads ... ceil(available processors * factor)</span></span><br><span class="line">        core-pool-size-factor = 2.0</span><br><span class="line">        <span class="comment"># maximum number of threads to cap factor-based number to</span></span><br><span class="line">        core-pool-size-max = 10</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment"># Throughput defines the maximum number of messages to be</span></span><br><span class="line">      <span class="comment"># processed per actor before the thread jumps to the next actor.</span></span><br><span class="line">      <span class="comment"># Set to 1 for as fair as possible.</span></span><br><span class="line">      throughput = 20</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    deployment &#123;</span><br><span class="line">      /clientActor &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用自定义的Dispatcher</span></span><br><span class="line">        dispatcher = <span class="string">"akka.actor.thread-pool-dispatcher"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="built_in">log</span>-remote-lifecycle-events = on</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">      port = 2556</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    roles = [<span class="string">"router"</span>, <span class="string">"client"</span>]</span><br><span class="line">    seed-nodes = [</span><br><span class="line">      <span class="string">"akka.tcp://simpleAkkaCluster@127.0.0.1:2555"</span>]</span><br><span class="line"></span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    auto-down-unreachable-after = 1000s</span><br><span class="line">    metrics.enabled = off</span><br><span class="line">    jmx.multi-mbeans-in-same-jvm = on</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">2018-02-06 11:55:59.839  INFO 2301 --- [nio-8080-exec-3] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring FrameworkServlet <span class="string">'dispatcherServlet'</span></span><br><span class="line">2018-02-06 11:55:59.839  INFO 2301 --- [nio-8080-exec-3] o.s.web.servlet.DispatcherServlet        : FrameworkServlet <span class="string">'dispatcherServlet'</span>: initialization started</span><br><span class="line">2018-02-06 11:55:59.852  INFO 2301 --- [nio-8080-exec-3] o.s.web.servlet.DispatcherServlet        : FrameworkServlet <span class="string">'dispatcherServlet'</span>: initialization completed <span class="keyword">in</span> 13 ms</span><br><span class="line">2018-02-06 11:55:59.872  INFO 2301 --- [nio-8080-exec-3] c.e.c.a.s.controller.AkkaController      : [Client] path:akka://simpleAkkaCluster/user/clientActor</span><br><span class="line">[INFO] [02/06/2018 11:55:59.873] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:100</span><br><span class="line">[INFO] [02/06/2018 11:55:59.873] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:101</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:102</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:103</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][消息转发] 集群节点数量:1, 待处理任务:104</span><br><span class="line">[INFO] [02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.actor.thread-pool-dispatcher-26] [akka.tcp://simpleAkkaCluster@127.0.0.1:2556/user/clientActor] [Dispatcher][服务选取] 选中[<span class="literal">true</span>] 地址: akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho</span><br><span class="line">[WARN] [SECURITY][02/06/2018 11:55:59.874] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-5] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer <span class="keyword">for</span> class [com.elonsu.cluster.akka.spring.actor.Message<span class="variable">$Task</span>] <span class="built_in">which</span> is not recommended because of performance implications. Use another serializer or <span class="built_in">disable</span> this warning using the setting <span class="string">'akka.actor.warn-about-java-serializer-usage'</span></span><br><span class="line">[INFO] [02/06/2018 11:55:59.926] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息0a860813a-d7c3-4a2a-b93a-35b034016731"</span>,<span class="string">"taskId"</span>:100&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-2</span><br><span class="line">[INFO] [02/06/2018 11:55:59.926] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息1c3148d4d-de3f-4483-b668-19b608b8d83d"</span>,<span class="string">"taskId"</span>:101&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-2</span><br><span class="line">[INFO] [02/06/2018 11:55:59.926] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息26707b125-a867-484a-9c5c-21a085d31b89"</span>,<span class="string">"taskId"</span>:102&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-2</span><br><span class="line">[INFO] [02/06/2018 11:55:59.926] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息334e7fdd0-c3cc-4192-8ee5-89f28c1dbe28"</span>,<span class="string">"taskId"</span>:103&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-2</span><br><span class="line">[INFO] [02/06/2018 11:55:59.927] [simpleAkkaCluster-akka.actor.default-dispatcher-2] [akka.tcp://simpleAkkaCluster@127.0.0.1:2555/user/SimpleEcho] [接收消息]:&#123;<span class="string">"content"</span>:<span class="string">"集群消息450ee1130-33fb-4f23-9372-34cff2d52488"</span>,<span class="string">"taskId"</span>:104&#125;, Actor:akka://simpleAkkaCluster/user/SimpleEcho, Thread:simpleAkkaCluster-akka.actor.default-dispatcher-2</span><br><span class="line">[WARN] [SECURITY][02/06/2018 11:55:59.926] [simpleAkkaCluster-akka.remote.default-remote-dispatcher-16] [akka.serialization.Serialization(akka://simpleAkkaCluster)] Using the default Java serializer <span class="keyword">for</span> class [com.elonsu.cluster.akka.spring.actor.Message<span class="variable">$Result</span>] <span class="built_in">which</span> is not recommended because of performance implications. Use another serializer or <span class="built_in">disable</span> this warning using the setting <span class="string">'akka.actor.warn-about-java-serializer-usage'</span></span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息0a860813a-d7c3-4a2a-b93a-35b034016731处理完成"</span>,<span class="string">"taskId"</span>:100&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息1c3148d4d-de3f-4483-b668-19b608b8d83d处理完成"</span>,<span class="string">"taskId"</span>:101&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息26707b125-a867-484a-9c5c-21a085d31b89处理完成"</span>,<span class="string">"taskId"</span>:102&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息334e7fdd0-c3cc-4192-8ee5-89f28c1dbe28处理完成"</span>,<span class="string">"taskId"</span>:103&#125;</span><br><span class="line">服务端返回:&#123;<span class="string">"result"</span>:<span class="string">"集群消息450ee1130-33fb-4f23-9372-34cff2d52488处理完成"</span>,<span class="string">"taskId"</span>:104&#125;</span><br></pre></td></tr></table></figure><h3 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h3><ul><li><a href="https://doc.akka.io/docs/akka/current/general/configuration.html" target="_blank" rel="noopener">https://doc.akka.io/docs/akka/current/general/configuration.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本篇集合Akka应用-分布式计算应用展示在Spring项目中做分布式计算.&lt;/p&gt;
&lt;h3 id=&quot;工程结构&quot;&gt;&lt;a href=&quot;#工程结构&quot; class=&quot;headerlink&quot; title=&quot;工程结构&quot;&gt;&lt;/a&gt;工程结构&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost spring-akka ]$ tree akka-task&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;akka-task&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── pom.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── src&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │       └── elonsu&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │           └── cluster&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │               └── akka&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                   ├── Application.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                   └── spring&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       ├── actor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       │   ├── Message.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       │   ├── RouterActor.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       │   └── SimpleActor.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       ├── config&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       │   ├── ClientConfig.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       │   └── ServerConfig.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       ├── controller&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       │   └── AkkaController.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                       └── support&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                           ├── SpringActorProducer.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │                           └── SpringExtension.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       └── resources&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           ├── akka-client.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           └── akka-server.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="入门教程" scheme="http://dennisit.github.io/categories/%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Akka" scheme="http://dennisit.github.io/tags/Akka/"/>
    
  </entry>
  
  <entry>
    <title>Web應用會話管理</title>
    <link href="http://dennisit.github.io/2017/01/21/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/skill-tookit-web-session-manage/"/>
    <id>http://dennisit.github.io/2017/01/21/应用实践/skill-tookit-web-session-manage/</id>
    <published>2017-01-21T08:40:53.000Z</published>
    <updated>2019-01-30T15:28:44.954Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Session和Cookie"><a href="#Session和Cookie" class="headerlink" title="Session和Cookie"></a>Session和Cookie</h3><p>由于HTTP协议是无状态的协议,所以服务端需要记录用户的状态时,就需要用某种机制来识具体的用户,这个机制就是Session。 Session是保存在服务端的,有一个唯一标识。在大型的网站,一般会有专门的Session服务器集群,这个时候 Session 信息都是放在内存的。</p><p>思考一下服务端如何识别特定的客户？这个时候Cookie就登场了。每次HTTP请求的时候,客户端都会发送相应的Cookie信息到服务端。 实际上大多数的应用都是用 Cookie 来实现Session跟踪的,第一次创建Session的时候,服务端会在HTTP协议中告诉客户端, 需要在 Cookie 里面记录一个Session ID,以后每次请求把这个会话ID发送到服务器,我就知道你是谁了。 有人问,如果客户端的浏览器禁用了 Cookie 怎么办？一般这种情况下,会使用一种叫做URL重写的技术来进行会话跟踪, 即每次HTTP交互,URL后面都会被附加上一个诸如 sid=xxxxx 这样的参数,服务端据此来识别用户。</p><p>Cookie其实还可以用在一些方便用户的场景下,设想你某次登陆过一个网站,下次登录的时候不想再次输入账号了,怎么办？ 这个信息可以写到Cookie里面,访问网站的时候,网站页面的脚本可以读取这个信息,就自动帮你把用户名给填了,能够方便一下用户。 这也是Cookie名称的由来,给用户的一点甜头。</p><a id="more"></a><p>所以,总结一下：</p><ol><li>session 在服务器端,cookie 在客户端（浏览器）</li><li>session 默认被存在在服务器的一个文件里（不是内存）</li><li>session 的运行依赖 session id,而 session_id是存在cookie中的,也就是说,如果浏览器禁用了cookie, 同时session也会失效（但是可以通过其它方式实现,比如在 url 中传递 session_id）</li><li>session 可以放在 文件、数据库、或内存中都可以。</li><li>用户验证这种场合一般会用 session 因此,维持一个会话的核心就是客户端的唯一标识,即 session id</li></ol><h3 id="种常见的实现web应用会话管理的方式："><a href="#种常见的实现web应用会话管理的方式：" class="headerlink" title="种常见的实现web应用会话管理的方式："></a>种常见的实现web应用会话管理的方式：</h3><ul><li>基于server端session的管理方式</li><li>基于cookie的管理方式</li><li>基于token的管理方式</li></ul><h4 id="基于Server端session"><a href="#基于Server端session" class="headerlink" title="基于Server端session"></a>基于Server端session</h4><p>在早期web应用中,通常使用服务端session来管理用户的会话。</p><p>1）服务端session是用户第一次访问应用时,服务器就会创建的对象,代表用户的一次会话过程,可以用来存放数据。 服务器为每一个session都分配一个唯一的sessionid,以保证每个用户都有一个不同的session对象。</p><p>2）服务器在创建完session后,会把sessionid通过cookie返回给用户所在的浏览器,这样当用户第二次及以后向服务器发送请求的时候, 就会通过cookie把sessionid传回给服务器,以便服务器能够根据sessionid找到与该用户对应的session对象。</p><p>3）session通常有失效时间的设定,比如2个小时。当失效时间到,服务器会销毁之前的session,并创建新的session返回给用户。 但是只要用户在失效时间内,有发送新的请求给服务器,通常服务器都会把他对应的session的失效时间根据当前的请求时间再延长2个小时。</p><p>4）session在一开始并不具备会话管理的作用。它只有在用户登录认证成功之后,并且往sesssion对象里面放入了用户登录成功的凭证, 才能用来管理会话。管理会话的逻辑也很简单,只要拿到用户的session对象,看它里面有没有登录成功的凭证,就能判断这个用户是否已经登录。 当用户主动退出的时候,会把它的session对象里的登录凭证清掉。 所以在用户登录前或退出后或者session对象失效时,肯定都是拿不到需要的登录凭证的。 </p><p>可简单使用流程图描述如下：</p><p><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15051279532548.jpg" alt></p><p>主流的web开发平台都原生支持这种会话管理的方式,而且开发起来很简单。它还有一个比较大的优点就是安全性好, 因为在浏览器端与服务器端保持会话状态的媒介始终只是一个sessionid串,只要这个串够随机,攻击者就不能轻易冒充他人的sessionid进行操作； 除非通过CSRF或http劫持的方式,才有可能冒充别人进行操作；即使冒充成功,也必须被冒充的用户session里面包含有效的登录凭证才行。</p><p>但是这种方式也有几个问题需要解决：</p><p>1）这种方式将会话信息存储在web服务器里面,所以在用户同时在线量比较多时,这些会话信息会占据比较多的内存；</p><p>2）当应用采用集群部署的时候,会遇到多台web服务器之间如何做session共享的问题。因为session是由单个服务器创建的, 但是处理用户请求的服务器不一定是那个创建session的服务器,这样他就拿不到之前已经放入到session中的登录凭证之类的信息了；</p><p>3）多个应用要共享session时,除了以上问题,还会遇到跨域问题,因为不同的应用可能部署的主机不一样,需要在各个应用做好cookie跨域的处理。</p><p>针对问题1和问题2,我见过的解决方案是采用redis/memcached这种中间服务器来管理session的增删改查, 一来减轻web服务器的负担,二来解决不同web服务器共享session的问题。</p><p>针对问题3,由于服务端的session依赖cookie来传递sessionid,所以在实际项目中,只要解决各个项目里面如何实现sessionid的cookie跨域访问即可, 这个是可以实现的,就是比较麻烦,前后端有可能都要做处理。</p><p>如果在一些小型的web应用中使用,可以不用考虑上面三个问题,所以很适合这种方式。</p><h4 id="基于cookie"><a href="#基于cookie" class="headerlink" title="基于cookie"></a>基于cookie</h4><p>由于前一种方式会增加服务器的负担和架构的复杂性,所以后来就有人想出直接把用户的登录凭证直接存到客户端的方案, 当用户登录成功之后,把登录凭证写到cookie里面,并给cookie设置有效期,后续请求直接验证存有登录凭证的cookie是否存在以及凭证是否有效, 即可判断用户的登录状态。使用它来实现会话管理的整体流程如下：</p><p>1）用户发起登录请求,服务端根据传入的用户密码之类的身份信息,验证用户是否满足登录条件,如果满足,就根据用户信息创建一个登录凭证, 这个登录凭证简单来说就是一个对象,最简单的形式可以只包含用户id,凭证创建时间和过期时间三个值。</p><p>2）服务端把上一步创建好的登录凭证,先对它做数字签名,然后再用对称加密算法做加密处理,将签名、加密后的字串,写入cookie。 cookie的名字必须固定（如ticket）,因为后面再获取的时候,还得根据这个名字来获取cookie值。 这一步添加数字签名的目的是防止登录凭证里的信息被篡改,因为一旦信息被篡改,那么下一步做签名验证的时候肯定会失败。 做加密的目的,是防止cookie被别人截取的时候,无法轻易读到其中的用户信息。</p><p>3）用户登录后发起后续请求,服务端根据上一步存登录凭证的cookie名字,获取到相关的cookie值。然后先做解密处理,再做数字签名的认证, 如果这两步都失败,说明这个登录凭证非法；如果这两步成功,接着就可以拿到原始存入的登录凭证了。然后用这个凭证的过期时间和当前时间做对比, 判断凭证是否过期,如果过期,就需要用户再重新登录；如果未过期,则允许请求继续。</p><p>可简单使用流程图描述如下：<br><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15051282129991.jpg" alt></p><p>它的缺点也比较明显：</p><p>1）cookie有大小限制,存储不了太多数据</p><p>2）每次传送cookie,增加了请求的数量,对访问性能也有影响；</p><p>3）也有跨域问题,毕竟还是要用cookie。</p><p>相比起第一种方式,基于cookie方案明显还是要好一些,目前好多web开发平台或框架都默认使用这种方式来做会话管理。</p><p>跨域的问题可以用CORS（跨域资源共享）的方式来快速解决。</p><h4 id="基于token"><a href="#基于token" class="headerlink" title="基于token"></a>基于token</h4><p>前面两种会话管理方式因为都用到cookie,不适合用在移动端native app里面,native app不好管理cookie,毕竟它不是浏览器。 这两种方案都不适合用来做纯api服务的登录认证,就要考虑第三种会话管理方式,也就是token认证。</p><p>这种方式从流程和实现上来说,跟cookie-based的方式没有太多区别,只不过cookie-based里面写到cookie里面的ticket在这种方式下称为token, 这个token在返回给客户端之后,后续请求都必须通过url参数或者是http header的形式,主动带上token, 这样服务端接收到请求之后就能直接从http header或者url里面取到token进行验证：</p><p>这种方式不通过cookie进行token的传递,而是每次请求的时候,主动把token加到http header里面或者url后面, 所以即使在native app里面也能使用它来调用我们通过web发布的api接口。app里面还要做两件事情：</p><p>1）有效存储token,得保证每次调接口的时候都能从同一个位置拿到同一个token；</p><p>2）每次调接口的的代码里都得把token加到header或者接口地址里面。</p><p>可简单使用流程图描述如下：<br><img src="https://raw.githubusercontent.com/dennisit/static/master/tech/image/15051281648364.jpg" alt></p><p>这种方式同样适用于网页应用,token可以存于localStorage或者sessionStorage里面,然后每发ajax请求的时候, 都把token拿出来放到ajax请求的header里即可。不过如果是非接口的请求,比如直接通过点击链接请求一个页面这种, 是无法自动带上token的。所以这种方式也仅限于走纯接口的web应用。</p><p><strong>基于token的标准实现: JWT</strong></p><p>现在SPA应用,前后端完全分离,基于API接口的应用越来越多,这时候基于token的认证就是最好的选择方式了。 好在这个方式的技术其实早就有很多实现了,而且还有现成的标准可用,这个标准就是JWT(json-web-token)。</p><p>JWT本身并没有做任何技术实现,它只是定义了token-based的管理方式该如何实现, 它规定了token的应该包含的标准内容以及token的生成过程和方法。目前实现了这个标准的技术已经有非常多：</p><p>官方网站：<a href="https://jwt.io/#libraries-io" target="_blank" rel="noopener">https://jwt.io/#libraries-io</a><br>Git主页：<a href="https://github.com/auth0/java-jwt" target="_blank" rel="noopener">https://github.com/auth0/java-jwt</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Session和Cookie&quot;&gt;&lt;a href=&quot;#Session和Cookie&quot; class=&quot;headerlink&quot; title=&quot;Session和Cookie&quot;&gt;&lt;/a&gt;Session和Cookie&lt;/h3&gt;&lt;p&gt;由于HTTP协议是无状态的协议,所以服务端需要记录用户的状态时,就需要用某种机制来识具体的用户,这个机制就是Session。 Session是保存在服务端的,有一个唯一标识。在大型的网站,一般会有专门的Session服务器集群,这个时候 Session 信息都是放在内存的。&lt;/p&gt;
&lt;p&gt;思考一下服务端如何识别特定的客户？这个时候Cookie就登场了。每次HTTP请求的时候,客户端都会发送相应的Cookie信息到服务端。 实际上大多数的应用都是用 Cookie 来实现Session跟踪的,第一次创建Session的时候,服务端会在HTTP协议中告诉客户端, 需要在 Cookie 里面记录一个Session ID,以后每次请求把这个会话ID发送到服务器,我就知道你是谁了。 有人问,如果客户端的浏览器禁用了 Cookie 怎么办？一般这种情况下,会使用一种叫做URL重写的技术来进行会话跟踪, 即每次HTTP交互,URL后面都会被附加上一个诸如 sid=xxxxx 这样的参数,服务端据此来识别用户。&lt;/p&gt;
&lt;p&gt;Cookie其实还可以用在一些方便用户的场景下,设想你某次登陆过一个网站,下次登录的时候不想再次输入账号了,怎么办？ 这个信息可以写到Cookie里面,访问网站的时候,网站页面的脚本可以读取这个信息,就自动帮你把用户名给填了,能够方便一下用户。 这也是Cookie名称的由来,给用户的一点甜头。&lt;/p&gt;
    
    </summary>
    
      <category term="应用实践" scheme="http://dennisit.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/"/>
    
    
      <category term="会话" scheme="http://dennisit.github.io/tags/%E4%BC%9A%E8%AF%9D/"/>
    
      <category term="Session" scheme="http://dennisit.github.io/tags/Session/"/>
    
      <category term="Cookie" scheme="http://dennisit.github.io/tags/Cookie/"/>
    
      <category term="Jwt" scheme="http://dennisit.github.io/tags/Jwt/"/>
    
  </entry>
  
  <entry>
    <title>安装配置 - Weex</title>
    <link href="http://dennisit.github.io/2017/01/10/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-Weex/"/>
    <id>http://dennisit.github.io/2017/01/10/应用实践/安装配置-Weex/</id>
    <published>2017-01-10T07:23:15.000Z</published>
    <updated>2019-02-23T09:34:05.507Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Weex介绍"><a href="#Weex介绍" class="headerlink" title="Weex介绍"></a>Weex介绍</h3><blockquote><p>Weex 是一套简单易用的跨平台开发方案,能以web的开发体验构建高性能、可扩展的native应用,出自阿里团队.</p></blockquote><h3 id="Weex安装"><a href="#Weex安装" class="headerlink" title="Weex安装"></a>Weex安装</h3><p>安装前置条件: Weex安装前需要安装Node环境,<a href="https://nodejs.org/en/" target="_blank" rel="noopener">点此下载</a></p><h4 id="检测Node环境"><a href="#检测Node环境" class="headerlink" title="检测Node环境"></a>检测Node环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ node -v</span><br><span class="line">v7.3.0</span><br><span class="line">[elonsu@localhost Elonsu ]$ npm -v</span><br><span class="line">3.10.10</span><br></pre></td></tr></table></figure><h4 id="Npm安装weex"><a href="#Npm安装weex" class="headerlink" title="Npm安装weex"></a>Npm安装weex</h4><p> npm 是一个 JavaScript 包管理工具,它可以让开发者轻松共享和重用代码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ npm install -g week-toolkit</span><br></pre></td></tr></table></figure><p> 国内开发者可以考虑使用淘宝的npm镜像cnpm安装weex-toolkit</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ sudo npm install -g cnpm</span><br><span class="line">[elonsu@localhost Elonsu ]$ sudo cnpm install -g weex-toolkit</span><br></pre></td></tr></table></figure><p>安装结束后你可以直接使用<code>weex</code>命令验证是否安装成功,它会显示weex命令行工具各参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ weex</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Weex开篇HelloWorld"><a href="#Weex开篇HelloWorld" class="headerlink" title="Weex开篇HelloWorld"></a>Weex开篇HelloWorld</h3><h4 id="示例程序"><a href="#示例程序" class="headerlink" title="示例程序"></a>示例程序</h4><p>在上面安装正常的情况下, 创建我们的示例hello.we文件; 文件内容如下:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"text"</span> <span class="attr">style</span>=<span class="string">"color: #FF0000;"</span>&gt;</span>Hello world<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">   .text&#123;</span></span><br><span class="line"><span class="undefined">     font-size: 50;</span></span><br><span class="line"><span class="undefined">   &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>说明: <code>&lt;template&gt;</code>、<code>&lt;style&gt;</code> 、<code>&lt;script&gt;</code> 分别对应于Web中的 <code>HTML</code>,<code>CSS(&lt;style&gt; 标签)</code>,<code>JavaScript(&lt;script&gt; 标签)</code>。<br>注意: Weex遵循HTML特性命名规范,所以特性命名时请不要使用陀峰格式(CamelCase),采用以“-”分割的 long-name 形式。</p><h4 id="编译运行"><a href="#编译运行" class="headerlink" title="编译运行"></a>编译运行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ weex hello.we</span><br><span class="line">info Sat Jan 07 2017 17:27:24 GMT+0800 (CST)WebSocket  is listening on port 8082</span><br><span class="line">info Sat Jan 07 2017 17:27:24 GMT+0800 (CST)http  is listening on port 8081</span><br></pre></td></tr></table></figure><p>执行结果: 我们会在浏览器页面中看到执行成功后页面,显示红色的”Hello world”效果.</p><h4 id="终端预览"><a href="#终端预览" class="headerlink" title="终端预览"></a>终端预览</h4><p>手机端预览效果需要安装Playground App(<a href="https://weex-project.io/download.html" target="_blank" rel="noopener">https://weex-project.io/download.html</a>)<br>我们在编译运行的命令后面增加<code>--qr</code>参数,表示生成二维码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ weex hello.we --qr</span><br></pre></td></tr></table></figure><p>执行上述命令,会在控制台生成一个二维码, 手机端使用Playground App扫描二维码即可看到效果.</p><h4 id="开发调试"><a href="#开发调试" class="headerlink" title="开发调试"></a>开发调试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ weex debug hello.we</span><br></pre></td></tr></table></figure><h4 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ mkdir wuyu-platform-weex</span><br><span class="line">[elonsu@localhost Elonsu ]$ cd wuyu-platform-weex</span><br><span class="line">[elonsu@localhost wuyu-platform-weex ]$ weex init</span><br><span class="line">prompt: Project Name:  (wuyu-platform-weex)</span><br><span class="line">file: .gitignore created.</span><br><span class="line">file: README.md created.</span><br><span class="line">file: index.html created.</span><br><span class="line">file: package.json created.</span><br><span class="line">file: src/weex-bootstrap.we created.</span><br><span class="line">file: webpack.config.js created.</span><br></pre></td></tr></table></figure><p>上面操作我们创建了一个工程,工程名叫wuyu-platform-weex.<br>接下来执行工程依赖包安装,以及编译并运行.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-platform-weex ]$ npm install</span><br><span class="line">[elonsu@localhost wuyu-platform-weex ]$ npm run dev</span><br><span class="line">[elonsu@localhost wuyu-platform-weex ]$ npm run serve</span><br></pre></td></tr></table></figure><h3 id="Weex开发套件Weexpack"><a href="#Weex开发套件Weexpack" class="headerlink" title="Weex开发套件Weexpack"></a>Weex开发套件Weexpack</h3><p>Weexpack 是 Weex 新一代的工程开发套件,它允许开发者通过简单的命令,创建 weex 工程项目,将项目运行在不同的开发平台上。</p><h4 id="Weexpack安装"><a href="#Weexpack安装" class="headerlink" title="Weexpack安装"></a>Weexpack安装</h4><p>Weexpack安装使用命令<code>npm install weexpack -g</code>或者<code>cnpm install weexpack -g</code>, 这里我们使用淘宝镜像。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ sudo cnpm install weexpack -g</span><br></pre></td></tr></table></figure><h4 id="Weexpack初始化工程"><a href="#Weexpack初始化工程" class="headerlink" title="Weexpack初始化工程"></a>Weexpack初始化工程</h4><p>我们创建一个工程<code>wuyu-weex</code>,使用<code>weexpack init 工程名</code> 会自动创建一个以工程名命名的文件夹,并进行工程初始化.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ weexpack init wuyu-weex</span><br><span class="line">=&gt; Initialize a new Weex app (wuyu-weex)</span><br></pre></td></tr></table></figure><p>进入工程安装依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost Elonsu ]$ <span class="built_in">cd</span> wuyu-weex</span><br><span class="line">[elonsu@localhost wuyu-weex ]$ npm install</span><br></pre></td></tr></table></figure><h4 id="Weexpack初始化工程说明"><a href="#Weexpack初始化工程说明" class="headerlink" title="Weexpack初始化工程说明"></a>Weexpack初始化工程说明</h4><p>Tree形结构展示目录结构, 笔者在Mac环境下.使用如下命令展示tree形目录结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-weex ]$ find . -<span class="built_in">print</span> | sed -e <span class="string">'s;[^/]*/;|____;g;s;____|; |;g'</span></span><br></pre></td></tr></table></figure><p>Weexpack初始化的后面结构大致如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-&gt; /wuyu-weex</span><br><span class="line">.</span><br><span class="line">|—— .gitignore</span><br><span class="line">|—— README.md</span><br><span class="line">|—— package.json</span><br><span class="line">|-- android.config.json</span><br><span class="line">|-- ios.config.json</span><br><span class="line">|—— webpack.config.js</span><br><span class="line">|—— /src</span><br><span class="line">|     |—— index.we</span><br><span class="line">|—— /html5</span><br><span class="line">|     |—— index.html</span><br><span class="line">|—— /ios</span><br><span class="line">|     |—— /playground</span><br><span class="line">|     |—— /sdk</span><br><span class="line">|     |—— /WXDevtool</span><br><span class="line">|—— /android</span><br><span class="line">|     |—— /playground</span><br><span class="line">|     |—— /appframework</span><br></pre></td></tr></table></figure><p>目录结构说明:</p><ul><li>webpack.config.js 是 webpack 配置文件,用于生成 .we 文件的 JSBunlde</li><li>ios.config.json 是 iOS 项目配置文件</li><li>android.config.json 是 Android 项目配置文件</li><li>/src 目录放置 Weex 页面</li><li>/html5 是 H5 端入口文件</li><li>/ios 放置 iOS 项目</li><li>/android 放置 Android 项目</li></ul><h4 id="工程运行与打包"><a href="#工程运行与打包" class="headerlink" title="工程运行与打包"></a>工程运行与打包</h4><p>如果一切运行正常, 便可以使用weexpack打包或模拟器运行了.</p><h5 id="Android平台"><a href="#Android平台" class="headerlink" title="Android平台"></a>Android平台</h5><p>Android下打包和构建是一体的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-weex ]$ weexpack run android</span><br></pre></td></tr></table></figure><h5 id="Ios平台"><a href="#Ios平台" class="headerlink" title="Ios平台"></a>Ios平台</h5><p>Ios下运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-weex ]$ weexpack run ios</span><br></pre></td></tr></table></figure><p>Ios下打包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-weex ]$ weexpack build ios</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Weex介绍&quot;&gt;&lt;a href=&quot;#Weex介绍&quot; class=&quot;headerlink&quot; title=&quot;Weex介绍&quot;&gt;&lt;/a&gt;Weex介绍&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Weex 是一套简单易用的跨平台开发方案,能以web的开发体验构建高性能、可扩展的native应用,出自阿里团队.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;Weex安装&quot;&gt;&lt;a href=&quot;#Weex安装&quot; class=&quot;headerlink&quot; title=&quot;Weex安装&quot;&gt;&lt;/a&gt;Weex安装&lt;/h3&gt;&lt;p&gt;安装前置条件: Weex安装前需要安装Node环境,&lt;a href=&quot;https://nodejs.org/en/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;点此下载&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;检测Node环境&quot;&gt;&lt;a href=&quot;#检测Node环境&quot; class=&quot;headerlink&quot; title=&quot;检测Node环境&quot;&gt;&lt;/a&gt;检测Node环境&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost Elonsu ]$ node -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v7.3.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost Elonsu ]$ npm -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3.10.10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;Npm安装weex&quot;&gt;&lt;a href=&quot;#Npm安装weex&quot; class=&quot;headerlink&quot; title=&quot;Npm安装weex&quot;&gt;&lt;/a&gt;Npm安装weex&lt;/h4&gt;&lt;p&gt; npm 是一个 JavaScript 包管理工具,它可以让开发者轻松共享和重用代码。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost Elonsu ]$ npm install -g week-toolkit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 国内开发者可以考虑使用淘宝的npm镜像cnpm安装weex-toolkit&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost Elonsu ]$ sudo npm install -g cnpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost Elonsu ]$ sudo cnpm install -g weex-toolkit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装结束后你可以直接使用&lt;code&gt;weex&lt;/code&gt;命令验证是否安装成功,它会显示weex命令行工具各参数：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost Elonsu ]$ weex&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="运维部署" scheme="http://dennisit.github.io/categories/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="App" scheme="http://dennisit.github.io/tags/App/"/>
    
      <category term="Weex" scheme="http://dennisit.github.io/tags/Weex/"/>
    
  </entry>
  
  <entry>
    <title>Java日期常用示例</title>
    <link href="http://dennisit.github.io/2016/12/30/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/skill-tutorial-java-date-locale-date-using/"/>
    <id>http://dennisit.github.io/2016/12/30/应用实践/skill-tutorial-java-date-locale-date-using/</id>
    <published>2016-12-30T13:16:15.000Z</published>
    <updated>2019-02-12T01:41:04.187Z</updated>
    
    <content type="html"><![CDATA[<h3 id="日期格式化"><a href="#日期格式化" class="headerlink" title="日期格式化"></a>日期格式化</h3><p>java.util.date和java.time.LocalDateTime格式化</p><h4 id="应用示例"><a href="#应用示例" class="headerlink" title="应用示例"></a>应用示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 格式化日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> date 待格式化的日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pattern 格式化正则</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 格式化结果串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(Date date, String pattern)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(pattern).format(date);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 格式化日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> localDateTime 待格式化的日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pattern 格式化正式</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 格式化结果串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(LocalDateTime localDateTime, String pattern)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> localDateTime.format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 格式化日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> localDate 待格式化的日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pattern 格式化正则, 这里使用的类型 &#123;<span class="doctag">@link</span> LocalDate&#125;, 所以正则只能设定到天</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 格式化结果串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(LocalDate localDate, String pattern)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> localDate.format(DateTimeFormatter.ofPattern(pattern));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="示例测试"><a href="#示例测试" class="headerlink" title="示例测试"></a>示例测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2017-08-28 15:45:02</span></span><br><span class="line">System.out.println(format(<span class="keyword">new</span> Date(), <span class="string">"yyyy-MM-dd HH:mm:ss"</span>));</span><br><span class="line"><span class="comment">// 2017-08-28 15:45:02</span></span><br><span class="line">System.out.println(format((LocalDateTime.now()), <span class="string">"yyyy-MM-dd HH:mm:ss"</span>));</span><br><span class="line"><span class="comment">// 2017-08-28</span></span><br><span class="line">System.out.println(format((LocalDateTime.now().toLocalDate()), <span class="string">"yyyy-MM-dd"</span>));</span><br></pre></td></tr></table></figure><h3 id="日期转换"><a href="#日期转换" class="headerlink" title="日期转换"></a>日期转换</h3><p>java.util.date和java.time.LocalDateTime互相转换</p><h4 id="应用示例-1"><a href="#应用示例-1" class="headerlink" title="应用示例"></a>应用示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 将 &#123;<span class="doctag">@link</span> LocalDateTime&#125; 转换成 &#123;<span class="doctag">@link</span> Date&#125;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> localDateTime &#123;<span class="doctag">@link</span> LocalDateTime&#125; 待转换的日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 转换成Date结果</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">from</span><span class="params">(LocalDateTime localDateTime)</span></span>&#123;</span><br><span class="line">   Instant instant = localDateTime.atZone(ZoneId.systemDefault()).toInstant();</span><br><span class="line">   <span class="keyword">return</span> Date.from(instant);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 将 &#123;<span class="doctag">@link</span> Date&#125; 转换成 &#123;<span class="doctag">@link</span> LocalDateTime&#125;</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> date &#123;<span class="doctag">@link</span> Date&#125; 待转换的日期</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 转换成 &#123;<span class="doctag">@link</span> LocalDateTime&#125; 结果</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title">from</span><span class="params">(Date date)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> LocalDateTime.ofInstant(date.toInstant(), ZoneId.systemDefault());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例测试-1"><a href="#示例测试-1" class="headerlink" title="示例测试"></a>示例测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String patternTime = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>;</span><br><span class="line">Date now = <span class="keyword">new</span> Date();</span><br><span class="line"><span class="comment">// 2017-08-28 14:47:10</span></span><br><span class="line">System.out.println(format(from(now), patternTime));</span><br><span class="line"><span class="comment">// 2017-08-28 14:47:10</span></span><br><span class="line">System.out.println(format(from(LocalDateTime.now()), patternTime));</span><br></pre></td></tr></table></figure><h3 id="区间集合"><a href="#区间集合" class="headerlink" title="区间集合"></a>区间集合</h3><p>计算两端日期之间内的日期天数集合</p><h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取&#123;<span class="doctag">@link</span> Date&#125;在开始时间和结束时间内的日期时间段&#123;<span class="doctag">@link</span> Date&#125;集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> start 开始时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end 结束时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 时间天数集合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Date&gt; <span class="title">dateZones</span><span class="params">(Date start, Date end)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> dateZones(from(start), from(end));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取 &#123;<span class="doctag">@link</span> LocalDate&#125; 在开始时间和结束时间内的日期时间段 &#123;<span class="doctag">@link</span> LocalDate&#125; 集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> start 开始时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end 结束时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 时间集合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Date&gt; <span class="title">dateZones</span><span class="params">(LocalDate start, LocalDate end)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> Stream.iterate(start, x -&gt; x.plusDays(<span class="number">1</span>))</span><br><span class="line">           .limit(ChronoUnit.DAYS.between(start, end) + <span class="number">1</span>)</span><br><span class="line">           .map(e -&gt; Date.from(e.atStartOfDay().atZone(ZoneId.systemDefault()).toInstant()))</span><br><span class="line">           .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取&#123;<span class="doctag">@link</span> LocalDateTime&#125; 在开始时间和结束时间内的日期时间段&#123;<span class="doctag">@link</span> Date&#125;集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> start 开始时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end 结束时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 时间天数集合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Date&gt; <span class="title">dateZones</span><span class="params">(LocalDateTime start, LocalDateTime end)</span></span>&#123;</span><br><span class="line">   <span class="comment">// 用起始时间作为流的源头，按照每次加一天的方式创建一个无限流</span></span><br><span class="line">   <span class="keyword">return</span> Stream.iterate(start.toLocalDate(), x -&gt; x.plusDays(<span class="number">1</span>))</span><br><span class="line">           <span class="comment">// 截断无限流，长度为起始时间和结束时间的差+1个</span></span><br><span class="line">           .limit(ChronoUnit.DAYS.between(start, end) + <span class="number">1</span>)</span><br><span class="line">           <span class="comment">// 由于最后要的是字符串，所以map转换一下</span></span><br><span class="line">           .map(e -&gt; Date.from(e.atStartOfDay().atZone(ZoneId.systemDefault()).toInstant()))</span><br><span class="line">           <span class="comment">// 把流收集为List</span></span><br><span class="line">           .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取&#123;<span class="doctag">@link</span> Date&#125;在开始时间和结束时间内的日期时间段&#123;<span class="doctag">@link</span> LocalDate&#125;集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> start 开始时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end 结束时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 时间集合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;LocalDate&gt; <span class="title">localDateZones</span><span class="params">(Date start, Date end)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> localDateZones(from(start), from(end));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取 &#123;<span class="doctag">@link</span> LocalDate&#125; 在开始时间和结束时间内的日期时间段 &#123;<span class="doctag">@link</span> LocalDate&#125; 集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> start 开始时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end 结束时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 时间集合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;LocalDate&gt; <span class="title">localDateZones</span><span class="params">(LocalDate start, LocalDate end)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> Stream.iterate(start, x -&gt; x.plusDays(<span class="number">1</span>))</span><br><span class="line">           .limit(ChronoUnit.DAYS.between(start, end) + <span class="number">1</span>)</span><br><span class="line">           .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取 &#123;<span class="doctag">@link</span> LocalDateTime&#125; 在开始时间和结束时间内的日期时间段 &#123;<span class="doctag">@link</span> LocalDate&#125; 集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> start 开始时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> end 结束时间</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 时间集合</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;LocalDate&gt; <span class="title">localDateZones</span><span class="params">(LocalDateTime start, LocalDateTime end)</span></span>&#123;</span><br><span class="line">   <span class="comment">// 用起始时间作为流的源头，按照每次加一天的方式创建一个无限流</span></span><br><span class="line">   <span class="keyword">return</span> Stream.iterate(start.toLocalDate(), x -&gt; x.plusDays(<span class="number">1</span>))</span><br><span class="line">           <span class="comment">// 截断无限流，长度为起始时间和结束时间的差+1个</span></span><br><span class="line">           .limit(ChronoUnit.DAYS.between(start, end) + <span class="number">1</span>)</span><br><span class="line">           .map(e -&gt; e.atStartOfDay().toLocalDate())</span><br><span class="line">           <span class="comment">// 把流收集为List</span></span><br><span class="line">           .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例测试-2"><a href="#示例测试-2" class="headerlink" title="示例测试"></a>示例测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">String patternDate = <span class="string">"yyyy-MM-dd"</span>;</span><br><span class="line">List&lt;Date&gt; dateList = Arrays.asList(<span class="keyword">new</span> Date(<span class="number">2017</span>-<span class="number">1900</span>, <span class="number">11</span>, <span class="number">30</span>), <span class="keyword">new</span> Date(<span class="number">2018</span>-<span class="number">1900</span>, <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2017-12-30</span></span><br><span class="line">System.out.println(<span class="string">"开始时间:"</span>  + format(dateList.get(<span class="number">0</span>), patternDate) + <span class="string">", 结束时间:"</span> + format(dateList.get(<span class="number">1</span>), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2017-12-30, 2017-12-31, 2018-01-01, 2018-01-02, 2018-01-03]</span></span><br><span class="line">System.out.println(dateZones(dateList.get(<span class="number">0</span>), dateList.get(<span class="number">1</span>)).stream().map(x -&gt; format(x, patternDate)).collect(Collectors.toList()));</span><br><span class="line"><span class="comment">// [2017-12-30, 2017-12-31, 2018-01-01, 2018-01-02, 2018-01-03]</span></span><br><span class="line">System.out.println(localDateZones(dateList.get(<span class="number">0</span>), dateList.get(<span class="number">1</span>)).stream().map(x -&gt; format(x, patternDate)).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LocalDateTime now = LocalDateTime.of(<span class="number">2017</span>, Month.DECEMBER, <span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2017-12-30</span></span><br><span class="line">System.out.println(format(now, patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2017-12-30, 2017-12-31, 2018-01-01, 2018-01-02, 2018-01-03]</span></span><br><span class="line">System.out.println(dateZones(now, now.plus(<span class="number">4</span>, ChronoUnit.DAYS))</span><br><span class="line">      .stream().map(x -&gt; format(x, patternDate)).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2017-12-30, 2017-12-31, 2018-01-01, 2018-01-02, 2018-01-03]</span></span><br><span class="line">System.out.println(localDateZones(now, now.plus(<span class="number">4</span>, ChronoUnit.DAYS))</span><br><span class="line">      .stream().map(x -&gt; format(x, patternDate)).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2017-12-30, 2017-12-31, 2018-01-01, 2018-01-02, 2018-01-03]</span></span><br><span class="line">System.out.println(localDateZones(now.toLocalDate(), now.toLocalDate().plus(<span class="number">4</span>, ChronoUnit.DAYS))</span><br><span class="line">      .stream().map(x -&gt; format(x, patternDate)).collect(Collectors.toList()));</span><br></pre></td></tr></table></figure><h3 id="日期加减"><a href="#日期加减" class="headerlink" title="日期加减"></a>日期加减</h3><h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">String patternDate = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>;</span><br><span class="line"></span><br><span class="line">LocalDateTime now = LocalDateTime.of(<span class="number">2017</span>, Month.DECEMBER, <span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前时间: 2017-12-30 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"当前时间: "</span> + format(now, patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 30秒前: 2017-12-29 23:59:30</span></span><br><span class="line">System.out.println(<span class="string">"30秒前: "</span> + format(now.plus(-<span class="number">30</span>, ChronoUnit.SECONDS), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5分钟后: 2017-12-30 00:05:00</span></span><br><span class="line">System.out.println(<span class="string">"5分钟后: "</span> + format(now.plus(<span class="number">5</span>, ChronoUnit.MINUTES), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2天前: 2017-12-28 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"2天前: "</span> + format(now.plus(-<span class="number">2</span>, ChronoUnit.DAYS), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2天后: 2018-01-01 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"2天后: "</span> + format(now.plus(<span class="number">2</span>, ChronoUnit.DAYS), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1周后: 2018-01-06 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"1周后: "</span> + format(now.plusWeeks(<span class="number">1</span>), patternDate));</span><br><span class="line">        </span><br><span class="line"><span class="comment">// 1月前: 2017-11-30 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"1月前: "</span> + format(now.plus(-<span class="number">1</span>, ChronoUnit.MONTHS), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1月后: 2018-01-30 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"1月后: "</span> + format(now.plus(<span class="number">1</span>, ChronoUnit.MONTHS), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1年后: 2018-12-30 00:00:00</span></span><br><span class="line">System.out.println(<span class="string">"1年后: "</span> + format(now.plus(<span class="number">1</span>, ChronoUnit.YEARS), patternDate));</span><br></pre></td></tr></table></figure><h3 id="日期推算"><a href="#日期推算" class="headerlink" title="日期推算"></a>日期推算</h3><h4 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">String patternDate = <span class="string">"yyyy-MM-dd"</span>;</span><br><span class="line"></span><br><span class="line">LocalDateTime now = LocalDateTime.of(<span class="number">2017</span>, Month.DECEMBER, <span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前时间: 2017-12-30</span></span><br><span class="line">System.out.println(<span class="string">"当前时间: "</span> + format(now, patternDate) + <span class="string">" ,是否闰年: "</span> + now.toLocalDate().isLeapYear());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前月份: 十二月</span></span><br><span class="line">System.out.println(<span class="string">"当前月份: "</span> + Month.from(now).getDisplayName(TextStyle.FULL, Locale.CHINA));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前星期: 星期六</span></span><br><span class="line">System.out.println(<span class="string">"当前星期: "</span> + DayOfWeek.from(now).getDisplayName(TextStyle.FULL, Locale.CHINA));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要注意:java8提供的获取的本周第一天和本周最后一天是西方的界定方式, 第一天是周末, 最后一天是周六, 和中国的不太一样</span></span><br><span class="line"><span class="comment">// 本周初第一天:2017-12-24</span></span><br><span class="line">System.out.println(<span class="string">"本周初第一天: "</span> + format(now.with(WeekFields.of(Locale.CHINA).dayOfWeek(),<span class="number">1L</span>), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本周最后一天:2017-12-30</span></span><br><span class="line">System.out.println(<span class="string">"本周最后一天: "</span> + format(now.with(WeekFields.of(Locale.CHINA).dayOfWeek(),<span class="number">7L</span>), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本月初第一天:2017-12-01</span></span><br><span class="line">System.out.println(<span class="string">"本月初第一天: "</span> + format(now.with(TemporalAdjusters.firstDayOfMonth()), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本月最后一天:2017-12-31</span></span><br><span class="line">System.out.println(<span class="string">"本月最后一天: "</span> + format(now.with(TemporalAdjusters.lastDayOfMonth()), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本年最后一天:2017-01-01</span></span><br><span class="line">System.out.println(<span class="string">"本年最后一天: "</span> + format(now.with(TemporalAdjusters.firstDayOfYear()), patternDate));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 本年最后一天:2017-12-31</span></span><br><span class="line">System.out.println(<span class="string">"本年最后一天: "</span> + format(now.with(TemporalAdjusters.lastDayOfYear()), patternDate));</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;日期格式化&quot;&gt;&lt;a href=&quot;#日期格式化&quot; class=&quot;headerlink&quot; title=&quot;日期格式化&quot;&gt;&lt;/a&gt;日期格式化&lt;/h3&gt;&lt;p&gt;java.util.date和java.time.LocalDateTime格式化&lt;/p&gt;
&lt;h4 id=&quot;应用示例&quot;&gt;&lt;a href=&quot;#应用示例&quot; class=&quot;headerlink&quot; title=&quot;应用示例&quot;&gt;&lt;/a&gt;应用示例&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* 格式化日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; date 待格式化的日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; pattern 格式化正则&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; 格式化结果串&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Date date, String pattern)&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(pattern).format(date);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* 格式化日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; localDateTime 待格式化的日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; pattern 格式化正式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; 格式化结果串&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LocalDateTime localDateTime, String pattern)&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; localDateTime.format(DateTimeFormatter.ofPattern(pattern));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* 格式化日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; localDate 待格式化的日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; pattern 格式化正则, 这里使用的类型 &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; LocalDate&amp;#125;, 所以正则只能设定到天&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;* &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; 格式化结果串&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LocalDate localDate, String pattern)&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; localDate.format(DateTimeFormatter.ofPattern(pattern));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="应用实践" scheme="http://dennisit.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="Date" scheme="http://dennisit.github.io/tags/Date/"/>
    
  </entry>
  
  <entry>
    <title>安装配置 - ReactNative</title>
    <link href="http://dennisit.github.io/2016/12/11/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-ReactNative/"/>
    <id>http://dennisit.github.io/2016/12/11/应用实践/安装配置-ReactNative/</id>
    <published>2016-12-11T08:49:15.000Z</published>
    <updated>2019-02-23T09:34:05.503Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ReactNative和React的关系"><a href="#ReactNative和React的关系" class="headerlink" title="ReactNative和React的关系"></a>ReactNative和React的关系</h3><blockquote><p>React用于web应用开发,ReactNative采用React方式进行移动应用开发.<br>ReactNative采用React预发,用于进行JavaScript跨终端应用开发,既拥有原生Native的交互体验,又能够保留React的开发效率.使用灵活的Html和Css布局,使用React语法构建组件,然后同时运行在Ios和Android平台上.</p></blockquote><h3 id="ReactNative安装前提"><a href="#ReactNative安装前提" class="headerlink" title="ReactNative安装前提"></a>ReactNative安装前提</h3><p><strong>Mac下安装Homebrew(非必须)</strong><br>安装操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br><span class="line">[elonsu@localhost ~ ]$ brew -v</span><br><span class="line">Homebrew 0.9.5 (git revision a8d6; last commit 2016-03-15)</span><br></pre></td></tr></table></figure><p>建议不定时的更新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~]$ brew update &amp;&amp; brew upgrade</span><br></pre></td></tr></table></figure><p><strong>安装NodeJs</strong><br>安装react前需要保证已经安装了nodeJs,下载地址:<a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~]$ brew install node</span><br></pre></td></tr></table></figure><h3 id="ReactNative安装"><a href="#ReactNative安装" class="headerlink" title="ReactNative安装"></a>ReactNative安装</h3><p>mac系统安装react-native</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~ ]$ node --version</span><br><span class="line">v7.2.0</span><br><span class="line">[elonsu@localhost ~ ]$ sudo npm install -g react-native-cli</span><br></pre></td></tr></table></figure><p>安装Watchman和Flow,监控文件变化和类型检查的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost ~ ]$ brew install watchman</span><br><span class="line">[elonsu@localhost ~ ]$ brew install flow</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="ReactNative创建项目"><a href="#ReactNative创建项目" class="headerlink" title="ReactNative创建项目"></a>ReactNative创建项目</h3><p>初始化项目使用命令<code>react-native init 工程名称</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-platform (master ✗)]$ react-native init wuyuApp</span><br></pre></td></tr></table></figure><p>初始化完会看到如下提示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">To run your app on iOS:</span><br><span class="line">   react-native run-ios</span><br><span class="line">   - or -</span><br><span class="line">   Open ios/wuyuApp.xcodeproj <span class="keyword">in</span> Xcode</span><br><span class="line">   Hit the Run button</span><br><span class="line">To run your app on Android:</span><br><span class="line">   Have an Android emulator running (quickest way to get started), or a device connected</span><br><span class="line">   react-native run-android</span><br></pre></td></tr></table></figure><p>启动调试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[elonsu@localhost wuyu-platform (master ✗)]$ <span class="built_in">cd</span> wuyuApp</span><br><span class="line">[elonsu@localhost wuyuApp (master ✗)]$ ls</span><br><span class="line">__tests__        android          index.android.js index.ios.js     ios              node_modules     package.json</span><br><span class="line">[elonsu@localhost wuyuApp (master ✗)]$ react-native run-ios</span><br><span class="line">[elonsu@localhost wuyuApp (master ✗)]$ react-native run-android</span><br></pre></td></tr></table></figure><h3 id="ReactNative开发工具"><a href="#ReactNative开发工具" class="headerlink" title="ReactNative开发工具"></a>ReactNative开发工具</h3><p>推荐开发工具Atom,下载地址:<a href="https://atom.io/" target="_blank" rel="noopener">https://atom.io/</a><br>Atom常用插件推荐:</p><ul><li>open-in-browser: 浏览器浏览功能</li><li>atom-html-preview: 分屏展示html页面效果</li><li>autocomplete-path: 文件路径补全</li></ul><h3 id="ReactNative资料"><a href="#ReactNative资料" class="headerlink" title="ReactNative资料"></a>ReactNative资料</h3><p>React官网: <a href="https://facebook.github.io/react/" target="_blank" rel="noopener">https://facebook.github.io/react/</a><br>ReactNative中文网: <a href="http://reactnative.cn/" target="_blank" rel="noopener">http://reactnative.cn/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ReactNative和React的关系&quot;&gt;&lt;a href=&quot;#ReactNative和React的关系&quot; class=&quot;headerlink&quot; title=&quot;ReactNative和React的关系&quot;&gt;&lt;/a&gt;ReactNative和React的关系&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;React用于web应用开发,ReactNative采用React方式进行移动应用开发.&lt;br&gt;ReactNative采用React预发,用于进行JavaScript跨终端应用开发,既拥有原生Native的交互体验,又能够保留React的开发效率.使用灵活的Html和Css布局,使用React语法构建组件,然后同时运行在Ios和Android平台上.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;ReactNative安装前提&quot;&gt;&lt;a href=&quot;#ReactNative安装前提&quot; class=&quot;headerlink&quot; title=&quot;ReactNative安装前提&quot;&gt;&lt;/a&gt;ReactNative安装前提&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Mac下安装Homebrew(非必须)&lt;/strong&gt;&lt;br&gt;安装操作&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/usr/bin/ruby -e &lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&lt;/span&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~ ]$ brew -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Homebrew 0.9.5 (git revision a8d6; last commit 2016-03-15)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;建议不定时的更新&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~]$ brew update &amp;amp;&amp;amp; brew upgrade&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;安装NodeJs&lt;/strong&gt;&lt;br&gt;安装react前需要保证已经安装了nodeJs,下载地址:&lt;a href=&quot;https://nodejs.org/en/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://nodejs.org/en/&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~]$ brew install node&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ReactNative安装&quot;&gt;&lt;a href=&quot;#ReactNative安装&quot; class=&quot;headerlink&quot; title=&quot;ReactNative安装&quot;&gt;&lt;/a&gt;ReactNative安装&lt;/h3&gt;&lt;p&gt;mac系统安装react-native&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~ ]$ node --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;v7.2.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~ ]$ sudo npm install -g react-native-cli&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装Watchman和Flow,监控文件变化和类型检查的。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~ ]$ brew install watchman&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[elonsu@localhost ~ ]$ brew install flow&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="运维部署" scheme="http://dennisit.github.io/categories/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="Node" scheme="http://dennisit.github.io/tags/Node/"/>
    
      <category term="React-native" scheme="http://dennisit.github.io/tags/React-native/"/>
    
      <category term="App" scheme="http://dennisit.github.io/tags/App/"/>
    
  </entry>
  
  <entry>
    <title>安装配置 - React</title>
    <link href="http://dennisit.github.io/2016/12/11/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-React/"/>
    <id>http://dennisit.github.io/2016/12/11/应用实践/安装配置-React/</id>
    <published>2016-12-11T08:48:53.000Z</published>
    <updated>2019-02-23T09:34:05.510Z</updated>
    
    <content type="html"><![CDATA[<h3 id="React介绍"><a href="#React介绍" class="headerlink" title="React介绍"></a>React介绍</h3><blockquote><p>React是一个用于构建用户界面的JavaScript库。<br>React主要用于构建UI,其本事不是一个MVC框架,只是是MVC中的V（视图）。<br>React起源于Facebook的开源项目,诞生之初用来架设Instagram网站。</p></blockquote><h3 id="React特点"><a href="#React特点" class="headerlink" title="React特点"></a>React特点</h3><p><strong>声明式设计</strong> − React采用声明范式，可以轻松描述应用。<br><strong>高效</strong> − React通过对DOM的模拟，最大限度地减少与DOM的交互。<br><strong>灵活</strong> − React可以与已知的库或框架很好地配合。<br><strong>JSX</strong> − JSX 是 JavaScript 语法的扩展。React 开发不一定使用 JSX ，但我们建议使用它。<br><strong>组件</strong> − 通过 React 构建组件，使得代码更加容易得到复用，能够很好的应用在大项目的开发中。<br><strong>单向响应的数据流</strong> − React 实现了单向响应的数据流，从而减少了重复代码，这也是它为什么比传统数据绑定更简单。</p><a id="more"></a><h3 id="React入门示例"><a href="#React入门示例" class="headerlink" title="React入门示例"></a>React入门示例</h3><p>示例使用React版本v15.4.1; 库下载地址: <a href="https://github.com/facebook/react/releases" target="_blank" rel="noopener">https://github.com/facebook/react/releases</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react.js是react的核心库--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./build/react.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react-dom.js的作用是提供与Dom相关的功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./build/react-dom.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- browser.min.js的作用是讲JSX语法转换成JavaScript预发 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://static.runoob.com/assets/react/browser.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- React渲染的模板内容会插入到该Dom节点中,作为一个容器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    在React开发中,使用JSX,跟JavaScript不兼容,在使用JSX的地方,要设置type:text/babel</span></span><br><span class="line"><span class="comment">    babel是一个转换编译器,ES6转成可以在浏览器中运行的代码</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>第一个React示例程序<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">  );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>说明:</p><ul><li>build中的js库来自<a href="https://github.com/facebook/react/releases。" target="_blank" rel="noopener">https://github.com/facebook/react/releases。</a></li><li>在React开发中,使用JSX语法,跟JavaScript不兼容,在使用JSX的地方,要设置type:text/babel; babel是一个转换编译器,ES6转成可以在浏览器中运行的代码</li><li>ReactDom.render()是最基本的React语法,支持三个参数:(参数1:模板渲染的内容,为html形式, 参数2:模板需要插入的dom结点, 参数3: 渲染后的回调,一般不用)</li></ul><h3 id="React-JSX"><a href="#React-JSX" class="headerlink" title="React JSX"></a>React JSX</h3><blockquote><p>React使用JSX来替代常规的 avaScript; JSX是一个看起来很像XML的JavaScript语法扩展。</p></blockquote><p>JSX必须借助React环境运行,JSX语法能够让我们更直观的看到组件的Dom结构,不能直接在浏览器上运行,最终会转换成JavaScript。<br>JSX标签其实就是HTML标签,只不过在JavaScript中书写这些标签时,不需要使用””括起来, 可以像xml一样书写</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"> ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="undefined">        第一个React示例程序</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">  );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JSX中运行JavaScript代码,使用{}括起来, 语法格式为:<code>{表达式}</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  var text = "第一个React示例程序";</span></span><br><span class="line"><span class="undefined">  ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">  );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="React定义组件"><a href="#React定义组件" class="headerlink" title="React定义组件"></a>React定义组件</h3><p>React中创建组件类以大写字母开头,驼峰命名法。<br>在React中使用React.createClass方法创建一个组件类。<br>每个组件类都必须实现自己的render方法,输出定义好的组件模板,返回值:null、false、组件模板;</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  // 定义组件类</span></span><br><span class="line"><span class="undefined">  var HellComponent = React.createClass(&#123;</span></span><br><span class="line"><span class="undefined">      render: function()&#123;</span></span><br><span class="line"><span class="xml">        return <span class="tag">&lt;<span class="name">h1</span>&gt;</span>第一个自定义组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined">  // 渲染dom</span></span><br><span class="line"><span class="undefined">  ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">HellComponent</span>/&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">  );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="React定义样式"><a href="#React定义样式" class="headerlink" title="React定义样式"></a>React定义样式</h3><p>React组件样式样式,有三种: <code>内连样式</code>(示例div元素)、<code>对象样式</code>(示例h1元素)、<code>选择器样式</code>(示例h2元素)。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react.js是react的核心库--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./build/react.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- react-dom.js的作用是提供与Dom相关的功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./build/react-dom.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- browser.min.js的作用是讲JSX语法转换成JavaScript预发 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://static.runoob.com/assets/react/browser.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      .ft&#123; color: blue;&#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- React渲染的模板内容会插入到该Dom节点中,作为一个容器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在React开发中,使用JSX,跟JavaScript不兼容,在使用JSX的地方,要设置type:text/babel</span></span><br><span class="line"><span class="comment">     babel是一个转换编译器,ES6转成可以在浏览器中运行的代码</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  // react中定义对象样式</span></span><br><span class="line"><span class="undefined">  var hellStyle = &#123;</span></span><br><span class="line"><span class="undefined">    backgroundColor: "green",</span></span><br><span class="line"><span class="undefined">    color: "red",</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  // 定义组件类, this.props定义组件属性</span></span><br><span class="line"><span class="undefined">  var HellComponent = React.createClass(&#123;</span></span><br><span class="line"><span class="undefined">      render: function()&#123;</span></span><br><span class="line"><span class="undefined">        return (</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;backgroudColor:</span>"<span class="attr">yellow</span>", <span class="attr">borderWidth:5</span>&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;hellStyle&#125;</span>&gt;</span>第一个自定义组件,动态参数&#123;this.props.param1&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">"ft"</span>&gt;</span>第一个自定义组件-动态参数:&#123;this.props.param2&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined">        );</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  // 渲染dom</span></span><br><span class="line"><span class="undefined">  ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">HellComponent</span> <span class="attr">param1</span>=<span class="string">"参数1"</span> <span class="attr">param2</span>=<span class="string">"参数2"</span>/&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">  );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在React和Html5中设置样式时书写格式是有区别的</p><ul><li>html5样式以<code>;</code>结尾,React以<code>,</code>结尾</li><li>Html5中key,value都不需要加引号, React中属于JavaScript对象, key的名字不能出现“-”, 需要使用驼峰命名法, 如果value为字符串需要加<code>&quot;&quot;</code></li><li>Html5中value如果是数字,需要带单位,React中不需要带单位.</li><li>Html5中选择器样式使用class, React中class是关键字,使用选择器样式时, 属性名使用<code>className</code>, 类似的也有使用htmlFor替换for.</li></ul><h3 id="React事件操作"><a href="#React事件操作" class="headerlink" title="React事件操作"></a>React事件操作</h3><p>React事件示例</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    var BtnAction = React.createClass(&#123;</span></span><br><span class="line"><span class="undefined">      // react中事件命名规范: 首字母小写, 驼峰命名法</span></span><br><span class="line"><span class="undefined">      handleClick: function()&#123;</span></span><br><span class="line"><span class="undefined">          alert("点击按钮触发事件");</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">      render: function()&#123;</span></span><br><span class="line"><span class="undefined">        return (</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>&#123;this.props.buttonTitle&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="undefined">        );</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">    // 渲染dom</span></span><br><span class="line"><span class="undefined">    ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">BtnAction</span> <span class="attr">buttonTitle</span>=<span class="string">"React事件按钮"</span>/&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">    );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="React状态操作"><a href="#React状态操作" class="headerlink" title="React状态操作"></a>React状态操作</h3><p>React状态示例</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    var CheckButton = React.createClass(&#123;</span></span><br><span class="line"><span class="undefined">        // 定义初始状态</span></span><br><span class="line"><span class="undefined">        getInitialState: function()&#123;</span></span><br><span class="line"><span class="undefined">          return &#123;</span></span><br><span class="line"><span class="undefined">            // 在这个对象中设置的属性值,将会存储在stage中,</span></span><br><span class="line"><span class="undefined">            isCheck: false</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        // 定义事件绑定方法</span></span><br><span class="line"><span class="undefined">        HandleChange: function()&#123;</span></span><br><span class="line"><span class="undefined">          // 修改状态值,通过this.stage读取设置的状态</span></span><br><span class="line"><span class="undefined">          this.setState(&#123;</span></span><br><span class="line"><span class="undefined">            isCheck: !this.state.isCheck</span></span><br><span class="line"><span class="undefined">          &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        render: function()&#123;</span></span><br><span class="line"><span class="undefined">          // 根据状态设置显示的文字</span></span><br><span class="line"><span class="undefined">          // 在JSX语法中,不能直接使用if,需要使用三目运算符</span></span><br><span class="line"><span class="undefined">          var text = this.state.isCheck? "已选中": "未选中";</span></span><br><span class="line"><span class="undefined">          return (</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">onChange</span>=<span class="string">&#123;this.HandleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="undefined">              &#123;text&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined">          );</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    // 渲染dom</span></span><br><span class="line"><span class="undefined">    ReactDOM.render(</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">CheckButton</span>/&gt;</span>,</span></span><br><span class="line"><span class="undefined">    document.getElementById("container")</span></span><br><span class="line"><span class="undefined">    );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当state发生变化时,会调用组件内部的render方法。</p><h3 id="React资料"><a href="#React资料" class="headerlink" title="React资料"></a>React资料</h3><ul><li>React教程: <a href="http://www.runoob.com/react/react-components.html" target="_blank" rel="noopener">http://www.runoob.com/react/react-components.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;React介绍&quot;&gt;&lt;a href=&quot;#React介绍&quot; class=&quot;headerlink&quot; title=&quot;React介绍&quot;&gt;&lt;/a&gt;React介绍&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;React是一个用于构建用户界面的JavaScript库。&lt;br&gt;React主要用于构建UI,其本事不是一个MVC框架,只是是MVC中的V（视图）。&lt;br&gt;React起源于Facebook的开源项目,诞生之初用来架设Instagram网站。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;React特点&quot;&gt;&lt;a href=&quot;#React特点&quot; class=&quot;headerlink&quot; title=&quot;React特点&quot;&gt;&lt;/a&gt;React特点&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;声明式设计&lt;/strong&gt; − React采用声明范式，可以轻松描述应用。&lt;br&gt;&lt;strong&gt;高效&lt;/strong&gt; − React通过对DOM的模拟，最大限度地减少与DOM的交互。&lt;br&gt;&lt;strong&gt;灵活&lt;/strong&gt; − React可以与已知的库或框架很好地配合。&lt;br&gt;&lt;strong&gt;JSX&lt;/strong&gt; − JSX 是 JavaScript 语法的扩展。React 开发不一定使用 JSX ，但我们建议使用它。&lt;br&gt;&lt;strong&gt;组件&lt;/strong&gt; − 通过 React 构建组件，使得代码更加容易得到复用，能够很好的应用在大项目的开发中。&lt;br&gt;&lt;strong&gt;单向响应的数据流&lt;/strong&gt; − React 实现了单向响应的数据流，从而减少了重复代码，这也是它为什么比传统数据绑定更简单。&lt;/p&gt;
    
    </summary>
    
      <category term="运维部署" scheme="http://dennisit.github.io/categories/%E8%BF%90%E7%BB%B4%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="React" scheme="http://dennisit.github.io/tags/React/"/>
    
      <category term="Node" scheme="http://dennisit.github.io/tags/Node/"/>
    
      <category term="Web" scheme="http://dennisit.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>理解Java-CountDownLatch应用</title>
    <link href="http://dennisit.github.io/2016/10/27/%E8%AF%AD%E8%A8%80%E8%AF%AD%E6%B3%95/%E7%90%86%E8%A7%A3Java-CountDownLatch/"/>
    <id>http://dennisit.github.io/2016/10/27/语言语法/理解Java-CountDownLatch/</id>
    <published>2016-10-27T14:08:49.000Z</published>
    <updated>2019-02-12T01:40:59.409Z</updated>
    
    <content type="html"><![CDATA[<h3 id="CountDownLatch说明"><a href="#CountDownLatch说明" class="headerlink" title="CountDownLatch说明"></a>CountDownLatch说明</h3><p>CountDownLatch是一个同步辅助类,这个类能够使一个线程等待其他线程完成各自的工作后再执行。例如，应用程序的主线程希望在负责启动框架服务的线程已经启动所有的框架服务之后再执行。</p><h3 id="CountDownLatch实现概要"><a href="#CountDownLatch实现概要" class="headerlink" title="CountDownLatch实现概要"></a>CountDownLatch实现概要</h3><p>CountDownLatch是通过一个计数器来实现的，计数器的初始值为线程的数量。每当一个线程完成了自己的任务后，计数器的值就会减1。当计数器值到达0时，它表示所有的线程已经完成了任务，然后在闭锁上等待的线程就可以恢复执行任务。</p><h3 id="CountDownLatch多线程应用"><a href="#CountDownLatch多线程应用" class="headerlink" title="CountDownLatch多线程应用"></a>CountDownLatch多线程应用</h3><h4 id="列表循环遍历-耗时8697ms"><a href="#列表循环遍历-耗时8697ms" class="headerlink" title="列表循环遍历(耗时8697ms)"></a>列表循环遍历(耗时8697ms)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">optimizeListV1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; lists = Arrays.asList(<span class="string">"aa"</span>, <span class="string">"bb"</span>, <span class="string">"cc"</span>, <span class="string">"dd"</span>, <span class="string">"ee"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;lists.size(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">2</span>)&#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"聚合完成"</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        MockTimeUtil.mockInvokeTime(<span class="string">"循环列表场景模拟:"</span>, start);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="多线程聚合列表-耗时4671ms"><a href="#多线程聚合列表-耗时4671ms" class="headerlink" title="多线程聚合列表(耗时4671ms)"></a>多线程聚合列表(耗时4671ms)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">optimizeList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">       ExecutorService ex = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">       <span class="keyword">final</span> List&lt;String&gt; lists = Arrays.asList(<span class="string">"aa"</span>, <span class="string">"bb"</span>, <span class="string">"cc"</span>, <span class="string">"dd"</span>, <span class="string">"ee"</span>);</span><br><span class="line">       <span class="keyword">final</span> CountDownLatch latch =  <span class="keyword">new</span> CountDownLatch(lists.size());</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;lists.size(); i++)&#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">int</span> tmp = i;</span><br><span class="line">           ex.submit(<span class="keyword">new</span> Callable&lt;Object&gt;() &#123;</span><br><span class="line">               <span class="meta">@Override</span></span><br><span class="line">               <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                   <span class="keyword">if</span>(tmp == <span class="number">2</span>)&#123;</span><br><span class="line">                       Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">                   Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                   latch.countDown();</span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//latch.await();</span></span><br><span class="line">       latch.await(<span class="number">3500</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">       System.out.println(<span class="string">"聚合完成"</span>);</span><br><span class="line">   &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">   &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">       MockTimeUtil.mockInvokeTime(<span class="string">"线程列表场景模拟:"</span>, start);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CountDownLatch方法说明"><a href="#CountDownLatch方法说明" class="headerlink" title="CountDownLatch方法说明"></a>CountDownLatch方法说明</h3><p>CountDownLatch源码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatch</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Synchronization control For CountDownLatch.</span></span><br><span class="line"><span class="comment">     * Uses AQS state to represent count.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4982264981922014374L</span>;</span><br><span class="line"></span><br><span class="line">        Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">            setState(count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getState();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="keyword">int</span> c = getState();</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">                    <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountDownLatch</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"count &lt; 0"</span>);</span><br><span class="line">        <span class="keyword">this</span>.sync = <span class="keyword">new</span> Sync(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        sync.acquireSharedInterruptibly(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquireSharedNanos(<span class="number">1</span>, unit.toNanos(timeout));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sync.releaseShared(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.getCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString() + <span class="string">"[Count = "</span> + sync.getCount() + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方法说明:</p><ul><li>countDown()：当前线程调用此方法，则计数减一</li><li>await(): 调用此方法会一直阻塞当前线程，直到计时器的值为0</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;CountDownLatch说明&quot;&gt;&lt;a href=&quot;#CountDownLatch说明&quot; class=&quot;headerlink&quot; title=&quot;CountDownLatch说明&quot;&gt;&lt;/a&gt;CountDownLatch说明&lt;/h3&gt;&lt;p&gt;CountDownLatch是一个同步辅助类,这个类能够使一个线程等待其他线程完成各自的工作后再执行。例如，应用程序的主线程希望在负责启动框架服务的线程已经启动所有的框架服务之后再执行。&lt;/p&gt;
&lt;h3 id=&quot;CountDownLatch实现概要&quot;&gt;&lt;a href=&quot;#CountDownLatch实现概要&quot; class=&quot;headerlink&quot; title=&quot;CountDownLatch实现概要&quot;&gt;&lt;/a&gt;CountDownLatch实现概要&lt;/h3&gt;&lt;p&gt;CountDownLatch是通过一个计数器来实现的，计数器的初始值为线程的数量。每当一个线程完成了自己的任务后，计数器的值就会减1。当计数器值到达0时，它表示所有的线程已经完成了任务，然后在闭锁上等待的线程就可以恢复执行任务。&lt;/p&gt;
&lt;h3 id=&quot;CountDownLatch多线程应用&quot;&gt;&lt;a href=&quot;#CountDownLatch多线程应用&quot; class=&quot;headerlink&quot; title=&quot;CountDownLatch多线程应用&quot;&gt;&lt;/a&gt;CountDownLatch多线程应用&lt;/h3&gt;&lt;h4 id=&quot;列表循环遍历-耗时8697ms&quot;&gt;&lt;a href=&quot;#列表循环遍历-耗时8697ms&quot; class=&quot;headerlink&quot; title=&quot;列表循环遍历(耗时8697ms)&quot;&gt;&lt;/a&gt;列表循环遍历(耗时8697ms)&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Test&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;optimizeListV1&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; start = System.currentTimeMillis();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;String&amp;gt; lists = Arrays.asList(&lt;span class=&quot;string&quot;&gt;&quot;aa&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;bb&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;cc&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;dd&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;ee&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i&amp;lt;lists.size(); i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(i == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Thread.sleep(&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Thread.sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(&lt;span class=&quot;string&quot;&gt;&quot;聚合完成&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MockTimeUtil.mockInvokeTime(&lt;span class=&quot;string&quot;&gt;&quot;循环列表场景模拟:&quot;&lt;/span&gt;, start);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="语言语法" scheme="http://dennisit.github.io/categories/%E8%AF%AD%E8%A8%80%E8%AF%AD%E6%B3%95/"/>
    
    
      <category term="Java" scheme="http://dennisit.github.io/tags/Java/"/>
    
      <category term="CountDownLatch" scheme="http://dennisit.github.io/tags/CountDownLatch/"/>
    
  </entry>
  
</feed>
